<HTML><HEAD><META CONTENT="text/html; charset=ISO-8859-1" HTTP-EQUIV="Content-Type"/><TITLE>EMMA Coverage Report</TITLE><STYLE TYPE="text/css"> TABLE,TD,TH {border-style:solid; border-color:black;} TD,TH {background:white;margin:0;line-height:100%;padding-left:0.5em;padding-right:0.5em;} TD {border-width:0 1px 0 0;} TH {border-width:1px 1px 1px 0;} TR TD.h {color:red;} TABLE {border-spacing:0; border-collapse:collapse;border-width:0 0 1px 1px;} P,H1,H2,H3,TH {font-family:verdana,arial,sans-serif;font-size:10pt;} TD {font-family:courier,monospace;font-size:10pt;} TABLE.hdft {border-spacing:0;border-collapse:collapse;border-style:none;} TABLE.hdft TH,TABLE.hdft TD {border-style:none;line-height:normal;} TABLE.hdft TH.tl,TABLE.hdft TD.tl {background:#6699CC;color:white;} TABLE.hdft TD.nv {background:#6633DD;color:white;} .nv A:link {color:white;} .nv A:visited {color:white;} .nv A:active {color:yellow;} TABLE.hdft A:link {color:white;} TABLE.hdft A:visited {color:white;} TABLE.hdft A:active {color:yellow;} .in {color:#356085;} TABLE.s TD {padding-left:0.25em;padding-right:0.25em;} TABLE.s TD.l {padding-left:0.25em;padding-right:0.25em;text-align:right;background:#F0F0F0;} TABLE.s TR.z TD {background:#FF9999;} TABLE.s TR.p TD {background:#FFFF88;} TABLE.s TR.c TD {background:#CCFFCC;} A:link {color:#0000EE;text-decoration:none;} A:visited {color:#0000EE;text-decoration:none;} A:hover {color:#0000EE;text-decoration:underline;} TABLE.cn {border-width:0 0 1px 0;} TABLE.s {border-width:1px 0 1px 1px;} TD.h {color:red;border-width:0 1px 0 0;} TD.f {border-width:0 1px 0 1px;} TD.hf {color:red;border-width:0 1px 0 1px;} TH.f {border-width:1px 1px 1px 1px;} TR.cis TD {background:#F0F0F0;} TR.cis TD {border-width:1px 1px 1px 0;} TR.cis TD.h {color:red;border-width:1px 1px 1px 0;} TR.cis TD.f {border-width:1px 1px 1px 1px;} TR.cis TD.hf {color:red;border-width:1px 1px 1px 1px;} TD.b {border-style:none;background:transparent;line-height:50%;}  TD.bt {border-width:1px 0 0 0;background:transparent;line-height:50%;} TR.o TD {background:#F0F0F0;}TABLE.it {border-style:none;}TABLE.it TD,TABLE.it TH {border-style:none;}</STYLE></HEAD><BODY><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="tl"><A HREF="http://emma.sourceforge.net/">EMMA</A> Coverage Report (generated Wed Dec 19 16:00:41 PST 2012)</TH></TR><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="11.html">org.h2.expression</A>]</TD></TR></TABLE><H2>COVERAGE SUMMARY FOR SOURCE FILE [<SPAN CLASS="in">Function.java</SPAN>]</H2><TABLE CELLSPACING="0" WIDTH="100%"><TR><TH>name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD>Function.java</TD><TD>100% (1/1)</TD><TD>98%  (59/60)</TD><TD>89%  (5029/5661)</TD><TD>89%  (1126/1260)</TD></TR></TABLE><H3>COVERAGE BREAKDOWN BY CLASS AND METHOD</H3><TABLE CLASS="cn" CELLSPACING="0" WIDTH="100%"><TR><TH CLASS="f">name</TH><TH>class, %</TH><TH>method, %</TH><TH>block, %</TH><TH>line, %</TH></TR><TR><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD><TD CLASS="b"> </TD></TR><TR CLASS="cis"><TD CLASS="f">class <A HREF="#0">Function</A></TD><TD>100% (1/1)</TD><TD>98%  (59/60)</TD><TD>89%  (5029/5661)</TD><TD>89%  (1126/1260)</TD></TR><TR><TD CLASS="f"><A HREF="#1">cancelStatement (Session, int): boolean</A></TD><TD> </TD><TD CLASS="h">0%   (0/1)</TD><TD CLASS="h">0%   (0/41)</TD><TD CLASS="h">0%   (0/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2">calculatePrecisionAndDisplaySize (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">10%  (17/168)</TD><TD CLASS="h">14%  (5/37)</TD></TR><TR><TD CLASS="f"><A HREF="#3">setParameter (int, Expression): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">45%  (20/44)</TD><TD>83%  (5/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#4">locate (String, String, int): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">59%  (17/29)</TD><TD CLASS="h">60%  (3/5)</TD></TR><TR><TD CLASS="f"><A HREF="#5">doneWithParameters (): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">65%  (40/62)</TD><TD>91%  (10/11)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#6">getDatePart (String): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">73%  (11/15)</TD><TD CLASS="h">75%  (3/4)</TD></TR><TR><TD CLASS="f"><A HREF="#7">isEverything (ExpressionVisitor): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">76%  (34/45)</TD><TD>86%  (6/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#8">getSQL (): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD CLASS="h">79%  (93/118)</TD><TD>86%  (12/14)</TD></TR><TR><TD CLASS="f"><A HREF="#9">getDisplaySize (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>80%  (8/10)</TD><TD CLASS="h">67%  (2/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#a">getSequence (Session, Value, Value): Sequence</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>80%  (61/76)</TD><TD>84%  (21/25)</TD></TR><TR><TD CLASS="f"><A HREF="#b">getHash (String, byte [], int): byte []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>81%  (17/21)</TD><TD>80%  (4/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#c">hexToRaw (String): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>81%  (39/48)</TD><TD CLASS="h">73%  (8/11)</TD></TR><TR><TD CLASS="f"><A HREF="#d">roundmagic (double): double</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (110/127)</TD><TD>88%  (22.8/26)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#e">getValueForColumnList (Session, Expression []): ValueResultSet</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (127/146)</TD><TD>84%  (21.8/26)</TD></TR><TR><TD CLASS="f"><A HREF="#f">checkParameterCount (int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>87%  (82/94)</TD><TD>97%  (29/30)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#10">getSimpleValue (Session, Value, Expression [], Value []): Value</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>88%  (912/1033)</TD><TD>87%  (250.8/288)</TD></TR><TR><TD CLASS="f"><A HREF="#11">substring (String, int, int): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>89%  (31/35)</TD><TD>88%  (8.8/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#12">insert (String, int, int, String): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>89%  (47/53)</TD><TD>83%  (10/12)</TD></TR><TR><TD CLASS="f"><A HREF="#13">getValueWithArgs (Session, Expression []): Value</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>89%  (923/1038)</TD><TD>89%  (190/213)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#14">replace (String, String, String): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>93%  (52/56)</TD><TD>87%  (13/15)</TD></TR><TR><TD CLASS="f"><A HREF="#15">datediff (String, Timestamp, Timestamp): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>95%  (176/186)</TD><TD>97%  (29/30)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#16">setCsvDelimiterEscape (Csv, String, String, String): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>95%  (42/44)</TD><TD>99%  (11.8/12)</TD></TR><TR><TD CLASS="f"><A HREF="#17">getSoundex (String): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>98%  (84/86)</TD><TD>99%  (16.9/17)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#0">&lt;static initializer&gt;</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (1099/1099)</TD><TD>100% (214/214)</TD></TR><TR><TD CLASS="f"><A HREF="#19">Function (Database, FunctionInfo): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (25/25)</TD><TD>100% (8/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1a">addFunction (String, int, int, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (9/9)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1b">addFunction (String, int, int, int, boolean, boolean, boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (31/31)</TD><TD>100% (10/10)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1c">addFunctionNotDeterministic (String, int, int, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (9/9)</TD><TD>100% (2/2)</TD></TR><TR><TD CLASS="f"><A HREF="#1d">addFunctionWithNull (String, int, int, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (9/9)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#1e">dateadd (String, int, Timestamp): Timestamp</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (34/34)</TD><TD>100% (9/9)</TD></TR><TR><TD CLASS="f"><A HREF="#1f">decrypt (String, byte [], byte []): byte []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (23/23)</TD><TD>100% (6/6)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#20">encrypt (String, byte [], byte []): byte []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (23/23)</TD><TD>100% (6/6)</TD></TR><TR><TD CLASS="f"><A HREF="#21">getArgs (): Expression []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#22">getCost (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (26/26)</TD><TD>100% (4/4)</TD></TR><TR><TD CLASS="f"><A HREF="#23">getDifference (String, String): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (25/25)</TD><TD>100% (7/7)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#24">getFunction (Database, String): Function</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (30/30)</TD><TD>100% (8/8)</TD></TR><TR><TD CLASS="f"><A HREF="#25">getFunctionInfo (String): FunctionInfo</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (5/5)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#26">getFunctionType (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#27">getName (): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#28">getNullOrValue (Session, Expression [], Value [], int): Value</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (24/24)</TD><TD>100% (6/6)</TD></TR><TR><TD CLASS="f"><A HREF="#29">getPaddedArrayCopy (byte [], int): byte []</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2a">getParameterCount (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2b">getPrecision (): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (10/10)</TD><TD>100% (3/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2c">getScale (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2d">getType (): int</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (3/3)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#2e">getValue (Session): Value</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (6/6)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#2f">isDatePart (String): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (12/12)</TD><TD>100% (2/2)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#30">isDeterministic (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#31">isFast (): boolean</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (4/4)</TD><TD>100% (1/1)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#32">left (String, int): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (5/5)</TD></TR><TR><TD CLASS="f"><A HREF="#33">length (Value): long</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (11/11)</TD><TD>100% (3/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#34">log10 (double): double</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (7/7)</TD><TD>100% (1/1)</TD></TR><TR><TD CLASS="f"><A HREF="#35">mapColumns (ColumnResolver, int): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (22/22)</TD><TD>100% (3/3)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#36">optimize (Session): Expression</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (438/438)</TD><TD>100% (98/98)</TD></TR><TR><TD CLASS="f"><A HREF="#37">rawToHex (String): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (43/43)</TD><TD>100% (8/8)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#38">repeat (String, int): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (19/19)</TD><TD>100% (4/4)</TD></TR><TR><TD CLASS="f"><A HREF="#39">right (String, int): String</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (19/19)</TD><TD>100% (5/5)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3a">setDataType (Column): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (17/17)</TD><TD>100% (5/5)</TD></TR><TR><TD CLASS="f"><A HREF="#3b">setEvaluatable (TableFilter, boolean): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (24/24)</TD><TD>100% (4/4)</TD></TR><TR CLASS="o"><TD CLASS="f"><A HREF="#3c">updateAggregate (Session): void</A></TD><TD> </TD><TD>100% (1/1)</TD><TD>100% (23/23)</TD><TD>100% (4/4)</TD></TR></TABLE><P></P><TABLE CLASS="s" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="l">1</TD><TD>/*</TD></TR><TR><TD CLASS="l">2</TD><TD> * Copyright 2004-2011 H2 Group. Multiple-Licensed under the H2 License,</TD></TR><TR><TD CLASS="l">3</TD><TD> * Version 1.0, and under the Eclipse Public License, Version 1.0</TD></TR><TR><TD CLASS="l">4</TD><TD> * (http://h2database.com/html/license.html).</TD></TR><TR><TD CLASS="l">5</TD><TD> * Initial Developer: H2 Group</TD></TR><TR><TD CLASS="l">6</TD><TD> */</TD></TR><TR><TD CLASS="l">7</TD><TD>package org.h2.expression;</TD></TR><TR><TD CLASS="l">8</TD><TD> </TD></TR><TR><TD CLASS="l">9</TD><TD>import java.io.IOException;</TD></TR><TR><TD CLASS="l">10</TD><TD>import java.io.InputStream;</TD></TR><TR><TD CLASS="l">11</TD><TD>import java.io.InputStreamReader;</TD></TR><TR><TD CLASS="l">12</TD><TD>import java.io.Reader;</TD></TR><TR><TD CLASS="l">13</TD><TD>import java.sql.Connection;</TD></TR><TR><TD CLASS="l">14</TD><TD>import java.sql.Date;</TD></TR><TR><TD CLASS="l">15</TD><TD>import java.sql.ResultSet;</TD></TR><TR><TD CLASS="l">16</TD><TD>import java.sql.SQLException;</TD></TR><TR><TD CLASS="l">17</TD><TD>import java.sql.Time;</TD></TR><TR><TD CLASS="l">18</TD><TD>import java.sql.Timestamp;</TD></TR><TR><TD CLASS="l">19</TD><TD>import java.text.SimpleDateFormat;</TD></TR><TR><TD CLASS="l">20</TD><TD>import java.util.ArrayList;</TD></TR><TR><TD CLASS="l">21</TD><TD>import java.util.Calendar;</TD></TR><TR><TD CLASS="l">22</TD><TD>import java.util.HashMap;</TD></TR><TR><TD CLASS="l">23</TD><TD>import java.util.Locale;</TD></TR><TR><TD CLASS="l">24</TD><TD>import java.util.TimeZone;</TD></TR><TR><TD CLASS="l">25</TD><TD>import java.util.regex.PatternSyntaxException;</TD></TR><TR><TD CLASS="l">26</TD><TD>import org.h2.command.Command;</TD></TR><TR><TD CLASS="l">27</TD><TD>import org.h2.command.Parser;</TD></TR><TR><TD CLASS="l">28</TD><TD>import org.h2.constant.ErrorCode;</TD></TR><TR><TD CLASS="l">29</TD><TD>import org.h2.engine.Database;</TD></TR><TR><TD CLASS="l">30</TD><TD>import org.h2.engine.Mode;</TD></TR><TR><TD CLASS="l">31</TD><TD>import org.h2.engine.Session;</TD></TR><TR><TD CLASS="l">32</TD><TD>import org.h2.message.DbException;</TD></TR><TR><TD CLASS="l">33</TD><TD>import org.h2.schema.Schema;</TD></TR><TR><TD CLASS="l">34</TD><TD>import org.h2.schema.Sequence;</TD></TR><TR><TD CLASS="l">35</TD><TD>import org.h2.security.BlockCipher;</TD></TR><TR><TD CLASS="l">36</TD><TD>import org.h2.security.CipherFactory;</TD></TR><TR><TD CLASS="l">37</TD><TD>import org.h2.security.SHA256;</TD></TR><TR><TD CLASS="l">38</TD><TD>import org.h2.store.fs.FileUtils;</TD></TR><TR><TD CLASS="l">39</TD><TD>import org.h2.table.Column;</TD></TR><TR><TD CLASS="l">40</TD><TD>import org.h2.table.ColumnResolver;</TD></TR><TR><TD CLASS="l">41</TD><TD>import org.h2.table.LinkSchema;</TD></TR><TR><TD CLASS="l">42</TD><TD>import org.h2.table.TableFilter;</TD></TR><TR><TD CLASS="l">43</TD><TD>import org.h2.tools.CompressTool;</TD></TR><TR><TD CLASS="l">44</TD><TD>import org.h2.tools.Csv;</TD></TR><TR><TD CLASS="l">45</TD><TD>import org.h2.util.AutoCloseInputStream;</TD></TR><TR><TD CLASS="l">46</TD><TD>import org.h2.util.DateTimeUtils;</TD></TR><TR><TD CLASS="l">47</TD><TD>import org.h2.util.JdbcUtils;</TD></TR><TR><TD CLASS="l">48</TD><TD>import org.h2.util.MathUtils;</TD></TR><TR><TD CLASS="l">49</TD><TD>import org.h2.util.New;</TD></TR><TR><TD CLASS="l">50</TD><TD>import org.h2.util.StatementBuilder;</TD></TR><TR><TD CLASS="l">51</TD><TD>import org.h2.util.StringUtils;</TD></TR><TR><TD CLASS="l">52</TD><TD>import org.h2.util.Utils;</TD></TR><TR><TD CLASS="l">53</TD><TD>import org.h2.value.DataType;</TD></TR><TR><TD CLASS="l">54</TD><TD>import org.h2.value.Value;</TD></TR><TR><TD CLASS="l">55</TD><TD>import org.h2.value.ValueArray;</TD></TR><TR><TD CLASS="l">56</TD><TD>import org.h2.value.ValueBoolean;</TD></TR><TR><TD CLASS="l">57</TD><TD>import org.h2.value.ValueBytes;</TD></TR><TR><TD CLASS="l">58</TD><TD>import org.h2.value.ValueDate;</TD></TR><TR><TD CLASS="l">59</TD><TD>import org.h2.value.ValueDouble;</TD></TR><TR><TD CLASS="l">60</TD><TD>import org.h2.value.ValueInt;</TD></TR><TR><TD CLASS="l">61</TD><TD>import org.h2.value.ValueLong;</TD></TR><TR><TD CLASS="l">62</TD><TD>import org.h2.value.ValueNull;</TD></TR><TR><TD CLASS="l">63</TD><TD>import org.h2.value.ValueResultSet;</TD></TR><TR><TD CLASS="l">64</TD><TD>import org.h2.value.ValueString;</TD></TR><TR><TD CLASS="l">65</TD><TD>import org.h2.value.ValueTime;</TD></TR><TR><TD CLASS="l">66</TD><TD>import org.h2.value.ValueTimestamp;</TD></TR><TR><TD CLASS="l">67</TD><TD>import org.h2.value.ValueUuid;</TD></TR><TR><TD CLASS="l">68</TD><TD> </TD></TR><TR><TD CLASS="l">69</TD><TD>/**</TD></TR><TR><TD CLASS="l">70</TD><TD> * This class implements most built-in functions of this database.</TD></TR><TR><TD CLASS="l">71</TD><TD> */</TD></TR><TR><TD CLASS="l">72</TD><TD>public class Function extends Expression implements FunctionCall {</TD></TR><TR><TD CLASS="l">73</TD><TD>    public static final int ABS = 0, ACOS = 1, ASIN = 2, ATAN = 3, ATAN2 = 4, BITAND = 5, BITOR = 6, BITXOR = 7,</TD></TR><TR><TD CLASS="l">74</TD><TD>            CEILING = 8, COS = 9, COT = 10, DEGREES = 11, EXP = 12, FLOOR = 13, LOG = 14, LOG10 = 15, MOD = 16,</TD></TR><TR><TD CLASS="l">75</TD><TD>            PI = 17, POWER = 18, RADIANS = 19, RAND = 20, ROUND = 21, ROUNDMAGIC = 22, SIGN = 23, SIN = 24, SQRT = 25,</TD></TR><TR><TD CLASS="l">76</TD><TD>            TAN = 26, TRUNCATE = 27, SECURE_RAND = 28, HASH = 29, ENCRYPT = 30, DECRYPT = 31, COMPRESS = 32,</TD></TR><TR><TD CLASS="l">77</TD><TD>            EXPAND = 33, ZERO = 34, RANDOM_UUID = 35, COSH = 36, SINH = 37, TANH = 38, LN = 39;</TD></TR><TR><TD CLASS="l">78</TD><TD> </TD></TR><TR><TD CLASS="l">79</TD><TD>    public static final int ASCII = 50, BIT_LENGTH = 51, CHAR = 52, CHAR_LENGTH = 53, CONCAT = 54, DIFFERENCE = 55,</TD></TR><TR><TD CLASS="l">80</TD><TD>            HEXTORAW = 56, INSERT = 57, INSTR = 58, LCASE = 59, LEFT = 60, LENGTH = 61, LOCATE = 62, LTRIM = 63,</TD></TR><TR><TD CLASS="l">81</TD><TD>            OCTET_LENGTH = 64, RAWTOHEX = 65, REPEAT = 66, REPLACE = 67, RIGHT = 68, RTRIM = 69, SOUNDEX = 70,</TD></TR><TR><TD CLASS="l">82</TD><TD>            SPACE = 71, SUBSTR = 72, SUBSTRING = 73, UCASE = 74, LOWER = 75, UPPER = 76, POSITION = 77, TRIM = 78,</TD></TR><TR><TD CLASS="l">83</TD><TD>            STRINGENCODE = 79, STRINGDECODE = 80, STRINGTOUTF8 = 81, UTF8TOSTRING = 82, XMLATTR = 83, XMLNODE = 84,</TD></TR><TR><TD CLASS="l">84</TD><TD>            XMLCOMMENT = 85, XMLCDATA = 86, XMLSTARTDOC = 87, XMLTEXT = 88, REGEXP_REPLACE = 89, RPAD = 90, LPAD = 91,</TD></TR><TR><TD CLASS="l">85</TD><TD>            CONCAT_WS = 92;</TD></TR><TR><TD CLASS="l">86</TD><TD> </TD></TR><TR><TD CLASS="l">87</TD><TD>    public static final int CURDATE = 100, CURTIME = 101, DATE_ADD = 102, DATE_DIFF = 103, DAY_NAME = 104,</TD></TR><TR><TD CLASS="l">88</TD><TD>            DAY_OF_MONTH = 105, DAY_OF_WEEK = 106, DAY_OF_YEAR = 107, HOUR = 108, MINUTE = 109, MONTH = 110, MONTH_NAME = 111,</TD></TR><TR><TD CLASS="l">89</TD><TD>            NOW = 112, QUARTER = 113, SECOND = 114, WEEK = 115, YEAR = 116, CURRENT_DATE = 117, CURRENT_TIME = 118,</TD></TR><TR><TD CLASS="l">90</TD><TD>            CURRENT_TIMESTAMP = 119, EXTRACT = 120, FORMATDATETIME = 121, PARSEDATETIME = 122,</TD></TR><TR><TD CLASS="l">91</TD><TD>            ISO_YEAR = 123, ISO_WEEK = 124, ISO_DAY_OF_WEEK = 125;</TD></TR><TR><TD CLASS="l">92</TD><TD> </TD></TR><TR><TD CLASS="l">93</TD><TD>    public static final int DATABASE = 150, USER = 151, CURRENT_USER = 152, IDENTITY = 153, SCOPE_IDENTITY = 154,</TD></TR><TR><TD CLASS="l">94</TD><TD>            AUTOCOMMIT = 155, READONLY = 156, DATABASE_PATH = 157, LOCK_TIMEOUT = 158;</TD></TR><TR><TD CLASS="l">95</TD><TD> </TD></TR><TR><TD CLASS="l">96</TD><TD>    public static final int IFNULL = 200, CASEWHEN = 201, CONVERT = 202, CAST = 203, COALESCE = 204, NULLIF = 205,</TD></TR><TR><TD CLASS="l">97</TD><TD>            CASE = 206, NEXTVAL = 207, CURRVAL = 208, ARRAY_GET = 209, CSVREAD = 210, CSVWRITE = 211,</TD></TR><TR><TD CLASS="l">98</TD><TD>            MEMORY_FREE = 212, MEMORY_USED = 213, LOCK_MODE = 214, SCHEMA = 215, SESSION_ID = 216, ARRAY_LENGTH = 217,</TD></TR><TR><TD CLASS="l">99</TD><TD>            LINK_SCHEMA = 218, GREATEST = 219, LEAST = 220, CANCEL_SESSION = 221, SET = 222, TABLE = 223, TABLE_DISTINCT = 224,</TD></TR><TR><TD CLASS="l">100</TD><TD>            FILE_READ = 225, TRANSACTION_ID = 226, TRUNCATE_VALUE = 227, NVL2 = 228, DECODE = 229, ARRAY_CONTAINS = 230;</TD></TR><TR><TD CLASS="l">101</TD><TD> </TD></TR><TR><TD CLASS="l">102</TD><TD>    public static final int ROW_NUMBER = 300;</TD></TR><TR><TD CLASS="l"><A NAME="0">103</A></TD><TD> </TD></TR><TR><TD CLASS="l">104</TD><TD>    private static final int VAR_ARGS = -1;</TD></TR><TR><TD CLASS="l">105</TD><TD>    private static final long PRECISION_UNKNOWN = -1;</TD></TR><TR><TD CLASS="l">106</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">107</TD><TD>    private static final HashMap&lt;String, FunctionInfo&gt; FUNCTIONS = New.hashMap();</TD></TR><TR CLASS="c"><TD CLASS="l">108</TD><TD>    private static final HashMap&lt;String, Integer&gt; DATE_PART = New.hashMap();</TD></TR><TR CLASS="c"><TD CLASS="l">109</TD><TD>    private static final char[] SOUNDEX_INDEX = new char[128];</TD></TR><TR><TD CLASS="l">110</TD><TD> </TD></TR><TR><TD CLASS="l">111</TD><TD>    protected Expression[] args;</TD></TR><TR><TD CLASS="l">112</TD><TD> </TD></TR><TR><TD CLASS="l">113</TD><TD>    private FunctionInfo info;</TD></TR><TR><TD CLASS="l">114</TD><TD>    private ArrayList&lt;Expression&gt; varArgs;</TD></TR><TR><TD CLASS="l">115</TD><TD>    private int dataType, scale;</TD></TR><TR CLASS="c"><TD CLASS="l">116</TD><TD>    private long precision = PRECISION_UNKNOWN;</TD></TR><TR><TD CLASS="l">117</TD><TD>    private int displaySize;</TD></TR><TR><TD CLASS="l">118</TD><TD>    private Database database;</TD></TR><TR><TD CLASS="l">119</TD><TD> </TD></TR><TR><TD CLASS="l">120</TD><TD>    static {</TD></TR><TR><TD CLASS="l">121</TD><TD>        // DATE_PART</TD></TR><TR CLASS="c"><TD CLASS="l">122</TD><TD>        DATE_PART.put(&#34;SQL_TSI_YEAR&#34;, Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">123</TD><TD>        DATE_PART.put(&#34;YEAR&#34;, Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">124</TD><TD>        DATE_PART.put(&#34;YYYY&#34;, Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">125</TD><TD>        DATE_PART.put(&#34;YY&#34;, Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">126</TD><TD>        DATE_PART.put(&#34;SQL_TSI_MONTH&#34;, Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">127</TD><TD>        DATE_PART.put(&#34;MONTH&#34;, Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">128</TD><TD>        DATE_PART.put(&#34;MM&#34;, Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">129</TD><TD>        DATE_PART.put(&#34;M&#34;, Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">130</TD><TD>        DATE_PART.put(&#34;SQL_TSI_WEEK&#34;, Calendar.WEEK_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">131</TD><TD>        DATE_PART.put(&#34;WW&#34;, Calendar.WEEK_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">132</TD><TD>        DATE_PART.put(&#34;WK&#34;, Calendar.WEEK_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">133</TD><TD>        DATE_PART.put(&#34;WEEK&#34;, Calendar.WEEK_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">134</TD><TD>        DATE_PART.put(&#34;DAY&#34;, Calendar.DAY_OF_MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">135</TD><TD>        DATE_PART.put(&#34;DD&#34;, Calendar.DAY_OF_MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">136</TD><TD>        DATE_PART.put(&#34;D&#34;, Calendar.DAY_OF_MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">137</TD><TD>        DATE_PART.put(&#34;SQL_TSI_DAY&#34;, Calendar.DAY_OF_MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">138</TD><TD>        DATE_PART.put(&#34;DAYOFYEAR&#34;, Calendar.DAY_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">139</TD><TD>        DATE_PART.put(&#34;DAY_OF_YEAR&#34;, Calendar.DAY_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">140</TD><TD>        DATE_PART.put(&#34;DY&#34;, Calendar.DAY_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">141</TD><TD>        DATE_PART.put(&#34;DOY&#34;, Calendar.DAY_OF_YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">142</TD><TD>        DATE_PART.put(&#34;SQL_TSI_HOUR&#34;, Calendar.HOUR_OF_DAY);</TD></TR><TR CLASS="c"><TD CLASS="l">143</TD><TD>        DATE_PART.put(&#34;HOUR&#34;, Calendar.HOUR_OF_DAY);</TD></TR><TR CLASS="c"><TD CLASS="l">144</TD><TD>        DATE_PART.put(&#34;HH&#34;, Calendar.HOUR_OF_DAY);</TD></TR><TR CLASS="c"><TD CLASS="l">145</TD><TD>        DATE_PART.put(&#34;SQL_TSI_MINUTE&#34;, Calendar.MINUTE);</TD></TR><TR CLASS="c"><TD CLASS="l">146</TD><TD>        DATE_PART.put(&#34;MINUTE&#34;, Calendar.MINUTE);</TD></TR><TR CLASS="c"><TD CLASS="l">147</TD><TD>        DATE_PART.put(&#34;MI&#34;, Calendar.MINUTE);</TD></TR><TR CLASS="c"><TD CLASS="l">148</TD><TD>        DATE_PART.put(&#34;N&#34;, Calendar.MINUTE);</TD></TR><TR CLASS="c"><TD CLASS="l">149</TD><TD>        DATE_PART.put(&#34;SQL_TSI_SECOND&#34;, Calendar.SECOND);</TD></TR><TR CLASS="c"><TD CLASS="l">150</TD><TD>        DATE_PART.put(&#34;SECOND&#34;, Calendar.SECOND);</TD></TR><TR CLASS="c"><TD CLASS="l">151</TD><TD>        DATE_PART.put(&#34;SS&#34;, Calendar.SECOND);</TD></TR><TR CLASS="c"><TD CLASS="l">152</TD><TD>        DATE_PART.put(&#34;S&#34;, Calendar.SECOND);</TD></TR><TR CLASS="c"><TD CLASS="l">153</TD><TD>        DATE_PART.put(&#34;MILLISECOND&#34;, Calendar.MILLISECOND);</TD></TR><TR CLASS="c"><TD CLASS="l">154</TD><TD>        DATE_PART.put(&#34;MS&#34;, Calendar.MILLISECOND);</TD></TR><TR><TD CLASS="l">155</TD><TD> </TD></TR><TR><TD CLASS="l">156</TD><TD>        // SOUNDEX_INDEX</TD></TR><TR CLASS="c"><TD CLASS="l">157</TD><TD>        String index = &#34;7AEIOUY8HW1BFPV2CGJKQSXZ3DT4L5MN6R&#34;;</TD></TR><TR CLASS="c"><TD CLASS="l">158</TD><TD>        char number = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">159</TD><TD>        for (int i = 0, length = index.length(); i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">160</TD><TD>            char c = index.charAt(i);</TD></TR><TR CLASS="c"><TD CLASS="l">161</TD><TD>            if (c &lt; '9') {</TD></TR><TR CLASS="c"><TD CLASS="l">162</TD><TD>                number = c;</TD></TR><TR><TD CLASS="l">163</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">164</TD><TD>                SOUNDEX_INDEX[c] = number;</TD></TR><TR CLASS="c"><TD CLASS="l">165</TD><TD>                SOUNDEX_INDEX[Character.toLowerCase(c)] = number;</TD></TR><TR><TD CLASS="l">166</TD><TD>            }</TD></TR><TR><TD CLASS="l">167</TD><TD>        }</TD></TR><TR><TD CLASS="l">168</TD><TD> </TD></TR><TR><TD CLASS="l">169</TD><TD>        // FUNCTIONS</TD></TR><TR CLASS="c"><TD CLASS="l">170</TD><TD>        addFunction(&#34;ABS&#34;, ABS, 1, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">171</TD><TD>        addFunction(&#34;ACOS&#34;, ACOS, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">172</TD><TD>        addFunction(&#34;ASIN&#34;, ASIN, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">173</TD><TD>        addFunction(&#34;ATAN&#34;, ATAN, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">174</TD><TD>        addFunction(&#34;ATAN2&#34;, ATAN2, 2, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">175</TD><TD>        addFunction(&#34;BITAND&#34;, BITAND, 2, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">176</TD><TD>        addFunction(&#34;BITOR&#34;, BITOR, 2, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">177</TD><TD>        addFunction(&#34;BITXOR&#34;, BITXOR, 2, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">178</TD><TD>        addFunction(&#34;CEILING&#34;, CEILING, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">179</TD><TD>        addFunction(&#34;CEIL&#34;, CEILING, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">180</TD><TD>        addFunction(&#34;COS&#34;, COS, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">181</TD><TD>        addFunction(&#34;COSH&#34;, COSH, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">182</TD><TD>        addFunction(&#34;COT&#34;, COT, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">183</TD><TD>        addFunction(&#34;DEGREES&#34;, DEGREES, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">184</TD><TD>        addFunction(&#34;EXP&#34;, EXP, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">185</TD><TD>        addFunction(&#34;FLOOR&#34;, FLOOR, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">186</TD><TD>        addFunction(&#34;LOG&#34;, LOG, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">187</TD><TD>        addFunction(&#34;LN&#34;, LN, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">188</TD><TD>        addFunction(&#34;LOG10&#34;, LOG10, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">189</TD><TD>        addFunction(&#34;MOD&#34;, MOD, 2, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">190</TD><TD>        addFunction(&#34;PI&#34;, PI, 0, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">191</TD><TD>        addFunction(&#34;POWER&#34;, POWER, 2, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">192</TD><TD>        addFunction(&#34;RADIANS&#34;, RADIANS, 1, Value.DOUBLE);</TD></TR><TR><TD CLASS="l">193</TD><TD>        // RAND without argument: get the next value</TD></TR><TR><TD CLASS="l">194</TD><TD>        // RAND with one argument: seed the random generator</TD></TR><TR CLASS="c"><TD CLASS="l">195</TD><TD>        addFunctionNotDeterministic(&#34;RAND&#34;, RAND, VAR_ARGS, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">196</TD><TD>        addFunctionNotDeterministic(&#34;RANDOM&#34;, RAND, VAR_ARGS, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">197</TD><TD>        addFunction(&#34;ROUND&#34;, ROUND, VAR_ARGS, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">198</TD><TD>        addFunction(&#34;ROUNDMAGIC&#34;, ROUNDMAGIC, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">199</TD><TD>        addFunction(&#34;SIGN&#34;, SIGN, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">200</TD><TD>        addFunction(&#34;SIN&#34;, SIN, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">201</TD><TD>        addFunction(&#34;SINH&#34;, SINH, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">202</TD><TD>        addFunction(&#34;SQRT&#34;, SQRT, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">203</TD><TD>        addFunction(&#34;TAN&#34;, TAN, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">204</TD><TD>        addFunction(&#34;TANH&#34;, TANH, 1, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">205</TD><TD>        addFunction(&#34;TRUNCATE&#34;, TRUNCATE, 2, Value.DOUBLE);</TD></TR><TR><TD CLASS="l">206</TD><TD>        // same as TRUNCATE</TD></TR><TR CLASS="c"><TD CLASS="l">207</TD><TD>        addFunction(&#34;TRUNC&#34;, TRUNCATE, 2, Value.DOUBLE);</TD></TR><TR CLASS="c"><TD CLASS="l">208</TD><TD>        addFunction(&#34;HASH&#34;, HASH, 3, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">209</TD><TD>        addFunction(&#34;ENCRYPT&#34;, ENCRYPT, 3, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">210</TD><TD>        addFunction(&#34;DECRYPT&#34;, DECRYPT, 3, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">211</TD><TD>        addFunctionNotDeterministic(&#34;SECURE_RAND&#34;, SECURE_RAND, 1, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">212</TD><TD>        addFunction(&#34;COMPRESS&#34;, COMPRESS, VAR_ARGS, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">213</TD><TD>        addFunction(&#34;EXPAND&#34;, EXPAND, 1, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">214</TD><TD>        addFunction(&#34;ZERO&#34;, ZERO, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">215</TD><TD>        addFunctionNotDeterministic(&#34;RANDOM_UUID&#34;, RANDOM_UUID, 0, Value.UUID);</TD></TR><TR CLASS="c"><TD CLASS="l">216</TD><TD>        addFunctionNotDeterministic(&#34;SYS_GUID&#34;, RANDOM_UUID, 0, Value.UUID);</TD></TR><TR><TD CLASS="l">217</TD><TD>        // string</TD></TR><TR CLASS="c"><TD CLASS="l">218</TD><TD>        addFunction(&#34;ASCII&#34;, ASCII, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">219</TD><TD>        addFunction(&#34;BIT_LENGTH&#34;, BIT_LENGTH, 1, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">220</TD><TD>        addFunction(&#34;CHAR&#34;, CHAR, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">221</TD><TD>        addFunction(&#34;CHR&#34;, CHAR, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">222</TD><TD>        addFunction(&#34;CHAR_LENGTH&#34;, CHAR_LENGTH, 1, Value.INT);</TD></TR><TR><TD CLASS="l">223</TD><TD>        // same as CHAR_LENGTH</TD></TR><TR CLASS="c"><TD CLASS="l">224</TD><TD>        addFunction(&#34;CHARACTER_LENGTH&#34;, CHAR_LENGTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">225</TD><TD>        addFunctionWithNull(&#34;CONCAT&#34;, CONCAT, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">226</TD><TD>        addFunctionWithNull(&#34;CONCAT_WS&#34;, CONCAT_WS, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">227</TD><TD>        addFunction(&#34;DIFFERENCE&#34;, DIFFERENCE, 2, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">228</TD><TD>        addFunction(&#34;HEXTORAW&#34;, HEXTORAW, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">229</TD><TD>        addFunctionWithNull(&#34;INSERT&#34;, INSERT, 4, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">230</TD><TD>        addFunction(&#34;LCASE&#34;, LCASE, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">231</TD><TD>        addFunction(&#34;LEFT&#34;, LEFT, 2, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">232</TD><TD>        addFunction(&#34;LENGTH&#34;, LENGTH, 1, Value.LONG);</TD></TR><TR><TD CLASS="l">233</TD><TD>        // 2 or 3 arguments</TD></TR><TR CLASS="c"><TD CLASS="l">234</TD><TD>        addFunction(&#34;LOCATE&#34;, LOCATE, VAR_ARGS, Value.INT);</TD></TR><TR><TD CLASS="l">235</TD><TD>        // same as LOCATE with 2 arguments</TD></TR><TR CLASS="c"><TD CLASS="l">236</TD><TD>        addFunction(&#34;POSITION&#34;, LOCATE, 2, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">237</TD><TD>        addFunction(&#34;INSTR&#34;, INSTR, VAR_ARGS, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">238</TD><TD>        addFunction(&#34;LTRIM&#34;, LTRIM, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">239</TD><TD>        addFunction(&#34;OCTET_LENGTH&#34;, OCTET_LENGTH, 1, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">240</TD><TD>        addFunction(&#34;RAWTOHEX&#34;, RAWTOHEX, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">241</TD><TD>        addFunction(&#34;REPEAT&#34;, REPEAT, 2, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">242</TD><TD>        addFunction(&#34;REPLACE&#34;, REPLACE, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">243</TD><TD>        addFunction(&#34;RIGHT&#34;, RIGHT, 2, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">244</TD><TD>        addFunction(&#34;RTRIM&#34;, RTRIM, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">245</TD><TD>        addFunction(&#34;SOUNDEX&#34;, SOUNDEX, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">246</TD><TD>        addFunction(&#34;SPACE&#34;, SPACE, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">247</TD><TD>        addFunction(&#34;SUBSTR&#34;, SUBSTR, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">248</TD><TD>        addFunction(&#34;SUBSTRING&#34;, SUBSTRING, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">249</TD><TD>        addFunction(&#34;UCASE&#34;, UCASE, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">250</TD><TD>        addFunction(&#34;LOWER&#34;, LOWER, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">251</TD><TD>        addFunction(&#34;UPPER&#34;, UPPER, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">252</TD><TD>        addFunction(&#34;POSITION&#34;, POSITION, 2, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">253</TD><TD>        addFunction(&#34;TRIM&#34;, TRIM, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">254</TD><TD>        addFunction(&#34;STRINGENCODE&#34;, STRINGENCODE, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">255</TD><TD>        addFunction(&#34;STRINGDECODE&#34;, STRINGDECODE, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">256</TD><TD>        addFunction(&#34;STRINGTOUTF8&#34;, STRINGTOUTF8, 1, Value.BYTES);</TD></TR><TR CLASS="c"><TD CLASS="l">257</TD><TD>        addFunction(&#34;UTF8TOSTRING&#34;, UTF8TOSTRING, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">258</TD><TD>        addFunction(&#34;XMLATTR&#34;, XMLATTR, 2, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">259</TD><TD>        addFunctionWithNull(&#34;XMLNODE&#34;, XMLNODE, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">260</TD><TD>        addFunction(&#34;XMLCOMMENT&#34;, XMLCOMMENT, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">261</TD><TD>        addFunction(&#34;XMLCDATA&#34;, XMLCDATA, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">262</TD><TD>        addFunction(&#34;XMLSTARTDOC&#34;, XMLSTARTDOC, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">263</TD><TD>        addFunction(&#34;XMLTEXT&#34;, XMLTEXT, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">264</TD><TD>        addFunction(&#34;REGEXP_REPLACE&#34;, REGEXP_REPLACE, 3, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">265</TD><TD>        addFunction(&#34;RPAD&#34;, RPAD, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">266</TD><TD>        addFunction(&#34;LPAD&#34;, LPAD, VAR_ARGS, Value.STRING);</TD></TR><TR><TD CLASS="l">267</TD><TD> </TD></TR><TR><TD CLASS="l">268</TD><TD>        // date</TD></TR><TR CLASS="c"><TD CLASS="l">269</TD><TD>        addFunctionNotDeterministic(&#34;CURRENT_DATE&#34;, CURRENT_DATE, 0, Value.DATE);</TD></TR><TR CLASS="c"><TD CLASS="l">270</TD><TD>        addFunctionNotDeterministic(&#34;CURDATE&#34;, CURDATE, 0, Value.DATE);</TD></TR><TR CLASS="c"><TD CLASS="l">271</TD><TD>        addFunctionNotDeterministic(&#34;CURRENT_TIME&#34;, CURRENT_TIME, 0, Value.TIME);</TD></TR><TR CLASS="c"><TD CLASS="l">272</TD><TD>        addFunctionNotDeterministic(&#34;CURTIME&#34;, CURTIME, 0, Value.TIME);</TD></TR><TR CLASS="c"><TD CLASS="l">273</TD><TD>        addFunctionNotDeterministic(&#34;CURRENT_TIMESTAMP&#34;, CURRENT_TIMESTAMP, VAR_ARGS, Value.TIMESTAMP);</TD></TR><TR CLASS="c"><TD CLASS="l">274</TD><TD>        addFunctionNotDeterministic(&#34;NOW&#34;, NOW, VAR_ARGS, Value.TIMESTAMP);</TD></TR><TR CLASS="c"><TD CLASS="l">275</TD><TD>        addFunction(&#34;DATEADD&#34;, DATE_ADD, 3, Value.TIMESTAMP);</TD></TR><TR CLASS="c"><TD CLASS="l">276</TD><TD>        addFunction(&#34;TIMESTAMPADD&#34;, DATE_ADD, 3, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">277</TD><TD>        addFunction(&#34;DATEDIFF&#34;, DATE_DIFF, 3, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">278</TD><TD>        addFunction(&#34;TIMESTAMPDIFF&#34;, DATE_DIFF, 3, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">279</TD><TD>        addFunction(&#34;DAYNAME&#34;, DAY_NAME, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">280</TD><TD>        addFunction(&#34;DAYNAME&#34;, DAY_NAME, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">281</TD><TD>        addFunction(&#34;DAY&#34;, DAY_OF_MONTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">282</TD><TD>        addFunction(&#34;DAY_OF_MONTH&#34;, DAY_OF_MONTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">283</TD><TD>        addFunction(&#34;DAY_OF_WEEK&#34;, DAY_OF_WEEK, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">284</TD><TD>        addFunction(&#34;DAY_OF_YEAR&#34;, DAY_OF_YEAR, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">285</TD><TD>        addFunction(&#34;DAYOFMONTH&#34;, DAY_OF_MONTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">286</TD><TD>        addFunction(&#34;DAYOFWEEK&#34;, DAY_OF_WEEK, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">287</TD><TD>        addFunction(&#34;DAYOFYEAR&#34;, DAY_OF_YEAR, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">288</TD><TD>        addFunction(&#34;HOUR&#34;, HOUR, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">289</TD><TD>        addFunction(&#34;MINUTE&#34;, MINUTE, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">290</TD><TD>        addFunction(&#34;MONTH&#34;, MONTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">291</TD><TD>        addFunction(&#34;MONTHNAME&#34;, MONTH_NAME, 1, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">292</TD><TD>        addFunction(&#34;QUARTER&#34;, QUARTER, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">293</TD><TD>        addFunction(&#34;SECOND&#34;, SECOND, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">294</TD><TD>        addFunction(&#34;WEEK&#34;, WEEK, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">295</TD><TD>        addFunction(&#34;YEAR&#34;, YEAR, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">296</TD><TD>        addFunction(&#34;EXTRACT&#34;, EXTRACT, 2, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">297</TD><TD>        addFunctionWithNull(&#34;FORMATDATETIME&#34;, FORMATDATETIME, VAR_ARGS, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">298</TD><TD>        addFunctionWithNull(&#34;PARSEDATETIME&#34;, PARSEDATETIME, VAR_ARGS, Value.TIMESTAMP);</TD></TR><TR CLASS="c"><TD CLASS="l">299</TD><TD>        addFunction(&#34;ISO_YEAR&#34;, ISO_YEAR, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">300</TD><TD>        addFunction(&#34;ISO_WEEK&#34;, ISO_WEEK, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">301</TD><TD>        addFunction(&#34;ISO_DAY_OF_WEEK&#34;, ISO_DAY_OF_WEEK, 1, Value.INT);</TD></TR><TR><TD CLASS="l">302</TD><TD>        // system</TD></TR><TR CLASS="c"><TD CLASS="l">303</TD><TD>        addFunctionNotDeterministic(&#34;DATABASE&#34;, DATABASE, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">304</TD><TD>        addFunctionNotDeterministic(&#34;USER&#34;, USER, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">305</TD><TD>        addFunctionNotDeterministic(&#34;CURRENT_USER&#34;, CURRENT_USER, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">306</TD><TD>        addFunctionNotDeterministic(&#34;IDENTITY&#34;, IDENTITY, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">307</TD><TD>        addFunctionNotDeterministic(&#34;SCOPE_IDENTITY&#34;, SCOPE_IDENTITY, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">308</TD><TD>        addFunctionNotDeterministic(&#34;IDENTITY_VAL_LOCAL&#34;, IDENTITY, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">309</TD><TD>        addFunctionNotDeterministic(&#34;LAST_INSERT_ID&#34;, IDENTITY, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">310</TD><TD>        addFunctionNotDeterministic(&#34;LASTVAL&#34;, IDENTITY, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">311</TD><TD>        addFunctionNotDeterministic(&#34;AUTOCOMMIT&#34;, AUTOCOMMIT, 0, Value.BOOLEAN);</TD></TR><TR CLASS="c"><TD CLASS="l">312</TD><TD>        addFunctionNotDeterministic(&#34;READONLY&#34;, READONLY, 0, Value.BOOLEAN);</TD></TR><TR CLASS="c"><TD CLASS="l">313</TD><TD>        addFunction(&#34;DATABASE_PATH&#34;, DATABASE_PATH, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">314</TD><TD>        addFunctionNotDeterministic(&#34;LOCK_TIMEOUT&#34;, LOCK_TIMEOUT, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">315</TD><TD>        addFunctionWithNull(&#34;IFNULL&#34;, IFNULL, 2, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">316</TD><TD>        addFunctionWithNull(&#34;ISNULL&#34;, IFNULL, 2, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">317</TD><TD>        addFunctionWithNull(&#34;CASEWHEN&#34;, CASEWHEN, 3, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">318</TD><TD>        addFunctionWithNull(&#34;CONVERT&#34;, CONVERT, 1, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">319</TD><TD>        addFunctionWithNull(&#34;CAST&#34;, CAST, 1, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">320</TD><TD>        addFunctionWithNull(&#34;TRUNCATE_VALUE&#34;, TRUNCATE_VALUE, 3, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">321</TD><TD>        addFunctionWithNull(&#34;COALESCE&#34;, COALESCE, VAR_ARGS, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">322</TD><TD>        addFunctionWithNull(&#34;NVL&#34;, COALESCE, VAR_ARGS, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">323</TD><TD>        addFunctionWithNull(&#34;NVL2&#34;, NVL2, 3, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">324</TD><TD>        addFunctionWithNull(&#34;NULLIF&#34;, NULLIF, 2, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">325</TD><TD>        addFunctionWithNull(&#34;CASE&#34;, CASE, VAR_ARGS, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">326</TD><TD>        addFunctionNotDeterministic(&#34;NEXTVAL&#34;, NEXTVAL, VAR_ARGS, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">327</TD><TD>        addFunctionNotDeterministic(&#34;CURRVAL&#34;, CURRVAL, VAR_ARGS, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">328</TD><TD>        addFunction(&#34;ARRAY_GET&#34;, ARRAY_GET, 2, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">329</TD><TD>        addFunction(&#34;ARRAY_CONTAINS&#34;, ARRAY_CONTAINS, 2, Value.BOOLEAN, false, true, false);</TD></TR><TR CLASS="c"><TD CLASS="l">330</TD><TD>        addFunction(&#34;CSVREAD&#34;, CSVREAD, VAR_ARGS, Value.RESULT_SET, false, false, true);</TD></TR><TR CLASS="c"><TD CLASS="l">331</TD><TD>        addFunction(&#34;CSVWRITE&#34;, CSVWRITE, VAR_ARGS, Value.INT, false, false, false);</TD></TR><TR CLASS="c"><TD CLASS="l">332</TD><TD>        addFunctionNotDeterministic(&#34;MEMORY_FREE&#34;, MEMORY_FREE, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">333</TD><TD>        addFunctionNotDeterministic(&#34;MEMORY_USED&#34;, MEMORY_USED, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">334</TD><TD>        addFunctionNotDeterministic(&#34;LOCK_MODE&#34;, LOCK_MODE, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">335</TD><TD>        addFunctionNotDeterministic(&#34;SCHEMA&#34;, SCHEMA, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">336</TD><TD>        addFunctionNotDeterministic(&#34;SESSION_ID&#34;, SESSION_ID, 0, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">337</TD><TD>        addFunction(&#34;ARRAY_LENGTH&#34;, ARRAY_LENGTH, 1, Value.INT);</TD></TR><TR CLASS="c"><TD CLASS="l">338</TD><TD>        addFunctionNotDeterministic(&#34;LINK_SCHEMA&#34;, LINK_SCHEMA, 6, Value.RESULT_SET);</TD></TR><TR CLASS="c"><TD CLASS="l">339</TD><TD>        addFunctionWithNull(&#34;LEAST&#34;, LEAST, VAR_ARGS, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">340</TD><TD>        addFunctionWithNull(&#34;GREATEST&#34;, GREATEST, VAR_ARGS, Value.NULL);</TD></TR><TR CLASS="c"><TD CLASS="l">341</TD><TD>        addFunctionNotDeterministic(&#34;CANCEL_SESSION&#34;, CANCEL_SESSION, 1, Value.BOOLEAN);</TD></TR><TR CLASS="c"><TD CLASS="l">342</TD><TD>        addFunction(&#34;SET&#34;, SET, 2, Value.NULL, false, false, false);</TD></TR><TR CLASS="c"><TD CLASS="l">343</TD><TD>        addFunction(&#34;FILE_READ&#34;, FILE_READ, VAR_ARGS, Value.NULL, false, false, false);</TD></TR><TR CLASS="c"><TD CLASS="l">344</TD><TD>        addFunctionNotDeterministic(&#34;TRANSACTION_ID&#34;, TRANSACTION_ID, 0, Value.STRING);</TD></TR><TR CLASS="c"><TD CLASS="l">345</TD><TD>        addFunctionWithNull(&#34;DECODE&#34;, DECODE, VAR_ARGS, Value.NULL);</TD></TR><TR><TD CLASS="l">346</TD><TD> </TD></TR><TR><TD CLASS="l">347</TD><TD>        // TableFunction</TD></TR><TR CLASS="c"><TD CLASS="l">348</TD><TD>        addFunctionWithNull(&#34;TABLE&#34;, TABLE, VAR_ARGS, Value.RESULT_SET);</TD></TR><TR CLASS="c"><TD CLASS="l">349</TD><TD>        addFunctionWithNull(&#34;TABLE_DISTINCT&#34;, TABLE_DISTINCT, VAR_ARGS, Value.RESULT_SET);</TD></TR><TR><TD CLASS="l">350</TD><TD> </TD></TR><TR><TD CLASS="l"><A NAME="19">351</A></TD><TD>        // pseudo function</TD></TR><TR CLASS="c"><TD CLASS="l">352</TD><TD>        addFunctionWithNull(&#34;ROW_NUMBER&#34;, ROW_NUMBER, 0, Value.LONG);</TD></TR><TR CLASS="c"><TD CLASS="l">353</TD><TD>    }</TD></TR><TR><TD CLASS="l">354</TD><TD> </TD></TR><TR CLASS="c"><TD CLASS="l">355</TD><TD>    protected Function(Database database, FunctionInfo info) {</TD></TR><TR CLASS="c"><TD CLASS="l">356</TD><TD>        this.database = database;</TD></TR><TR CLASS="c"><TD CLASS="l">357</TD><TD>        this.info = info;</TD></TR><TR CLASS="c"><TD CLASS="l">358</TD><TD>        if (info.parameterCount == VAR_ARGS) {</TD></TR><TR CLASS="c"><TD CLASS="l">359</TD><TD>            varArgs = New.arrayList();</TD></TR><TR><TD CLASS="l">360</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">361</TD><TD>            args = new Expression[info.parameterCount];</TD></TR><TR><TD CLASS="l">362</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1b">363</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">364</TD><TD> </TD></TR><TR><TD CLASS="l">365</TD><TD>    private static void addFunction(String name, int type, int parameterCount, int dataType,</TD></TR><TR><TD CLASS="l">366</TD><TD>            boolean nullIfParameterIsNull, boolean deterministic, boolean fast) {</TD></TR><TR CLASS="c"><TD CLASS="l">367</TD><TD>        FunctionInfo info = new FunctionInfo();</TD></TR><TR CLASS="c"><TD CLASS="l">368</TD><TD>        info.name = name;</TD></TR><TR CLASS="c"><TD CLASS="l">369</TD><TD>        info.type = type;</TD></TR><TR CLASS="c"><TD CLASS="l">370</TD><TD>        info.parameterCount = parameterCount;</TD></TR><TR CLASS="c"><TD CLASS="l">371</TD><TD>        info.dataType = dataType;</TD></TR><TR CLASS="c"><TD CLASS="l">372</TD><TD>        info.nullIfParameterIsNull = nullIfParameterIsNull;</TD></TR><TR CLASS="c"><TD CLASS="l">373</TD><TD>        info.deterministic = deterministic;</TD></TR><TR CLASS="c"><TD CLASS="l">374</TD><TD>        info.fast = fast;</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1c">375</A></TD><TD>        FUNCTIONS.put(name, info);</TD></TR><TR CLASS="c"><TD CLASS="l">376</TD><TD>    }</TD></TR><TR><TD CLASS="l">377</TD><TD> </TD></TR><TR><TD CLASS="l">378</TD><TD>    private static void addFunctionNotDeterministic(String name, int type, int parameterCount, int dataType) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1a">379</A></TD><TD>        addFunction(name, type, parameterCount, dataType, true, false, false);</TD></TR><TR CLASS="c"><TD CLASS="l">380</TD><TD>    }</TD></TR><TR><TD CLASS="l">381</TD><TD> </TD></TR><TR><TD CLASS="l">382</TD><TD>    private static void addFunction(String name, int type, int parameterCount, int dataType) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1d">383</A></TD><TD>        addFunction(name, type, parameterCount, dataType, true, true, false);</TD></TR><TR CLASS="c"><TD CLASS="l">384</TD><TD>    }</TD></TR><TR><TD CLASS="l">385</TD><TD> </TD></TR><TR><TD CLASS="l">386</TD><TD>    private static void addFunctionWithNull(String name, int type, int parameterCount, int dataType) {</TD></TR><TR CLASS="c"><TD CLASS="l">387</TD><TD>        addFunction(name, type, parameterCount, dataType, false, true, false);</TD></TR><TR CLASS="c"><TD CLASS="l">388</TD><TD>    }</TD></TR><TR><TD CLASS="l">389</TD><TD> </TD></TR><TR><TD CLASS="l">390</TD><TD>    /**</TD></TR><TR><TD CLASS="l">391</TD><TD>     * Get the function info object for this function, or null if there is no</TD></TR><TR><TD CLASS="l">392</TD><TD>     * such function.</TD></TR><TR><TD CLASS="l">393</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="25">394</A></TD><TD>     * @param name the function name</TD></TR><TR><TD CLASS="l">395</TD><TD>     * @return the function info</TD></TR><TR><TD CLASS="l">396</TD><TD>     */</TD></TR><TR><TD CLASS="l">397</TD><TD>    private static FunctionInfo getFunctionInfo(String name) {</TD></TR><TR CLASS="c"><TD CLASS="l">398</TD><TD>        return FUNCTIONS.get(name);</TD></TR><TR><TD CLASS="l">399</TD><TD>    }</TD></TR><TR><TD CLASS="l">400</TD><TD> </TD></TR><TR><TD CLASS="l">401</TD><TD>    /**</TD></TR><TR><TD CLASS="l">402</TD><TD>     * Get an instance of the given function for this database.</TD></TR><TR><TD CLASS="l">403</TD><TD>     * If no function with this name is found, null is returned.</TD></TR><TR><TD CLASS="l">404</TD><TD>     *</TD></TR><TR><TD CLASS="l">405</TD><TD>     * @param database the database</TD></TR><TR><TD CLASS="l"><A NAME="24">406</A></TD><TD>     * @param name the function name</TD></TR><TR><TD CLASS="l">407</TD><TD>     * @return the function object or null</TD></TR><TR><TD CLASS="l">408</TD><TD>     */</TD></TR><TR><TD CLASS="l">409</TD><TD>    public static Function getFunction(Database database, String name) {</TD></TR><TR CLASS="c"><TD CLASS="l">410</TD><TD>        if (!database.getSettings().databaseToUpper) {</TD></TR><TR><TD CLASS="l">411</TD><TD>            // if not yet converted to uppercase, do it now</TD></TR><TR CLASS="c"><TD CLASS="l">412</TD><TD>            name = StringUtils.toUpperEnglish(name);</TD></TR><TR><TD CLASS="l">413</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">414</TD><TD>        FunctionInfo info = getFunctionInfo(name);</TD></TR><TR CLASS="c"><TD CLASS="l">415</TD><TD>        if (info == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">416</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">417</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">418</TD><TD>        switch(info.type) {</TD></TR><TR><TD CLASS="l">419</TD><TD>        case TABLE:</TD></TR><TR><TD CLASS="l">420</TD><TD>        case TABLE_DISTINCT:</TD></TR><TR CLASS="c"><TD CLASS="l">421</TD><TD>            return new TableFunction(database, info, Long.MAX_VALUE);</TD></TR><TR><TD CLASS="l">422</TD><TD>        default:</TD></TR><TR CLASS="c"><TD CLASS="l">423</TD><TD>            return new Function(database, info);</TD></TR><TR><TD CLASS="l">424</TD><TD>        }</TD></TR><TR><TD CLASS="l">425</TD><TD>    }</TD></TR><TR><TD CLASS="l">426</TD><TD> </TD></TR><TR><TD CLASS="l">427</TD><TD>    /**</TD></TR><TR><TD CLASS="l">428</TD><TD>     * Set the parameter expression at the given index.</TD></TR><TR><TD CLASS="l">429</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="3">430</A></TD><TD>     * @param index the index (0, 1,...)</TD></TR><TR><TD CLASS="l">431</TD><TD>     * @param param the expression</TD></TR><TR><TD CLASS="l">432</TD><TD>     */</TD></TR><TR><TD CLASS="l">433</TD><TD>    public void setParameter(int index, Expression param) {</TD></TR><TR CLASS="c"><TD CLASS="l">434</TD><TD>        if (varArgs != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">435</TD><TD>            varArgs.add(param);</TD></TR><TR><TD CLASS="l">436</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">437</TD><TD>            if (index &gt;= args.length) {</TD></TR><TR CLASS="z"><TD CLASS="l">438</TD><TD>                throw DbException.get(ErrorCode.INVALID_PARAMETER_COUNT_2, info.name,</TD></TR><TR><TD CLASS="l">439</TD><TD>                        &#34;&#34; + args.length);</TD></TR><TR><TD CLASS="l">440</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">441</TD><TD>            args[index] = param;</TD></TR><TR><TD CLASS="l"><A NAME="34">442</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">443</TD><TD>    }</TD></TR><TR><TD CLASS="l">444</TD><TD> </TD></TR><TR><TD CLASS="l">445</TD><TD>    private static strictfp double log10(double value) {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2e">446</A></TD><TD>        return roundmagic(StrictMath.log(value) / StrictMath.log(10));</TD></TR><TR><TD CLASS="l">447</TD><TD>    }</TD></TR><TR><TD CLASS="l">448</TD><TD> </TD></TR><TR><TD CLASS="l">449</TD><TD>    public Value getValue(Session session) {</TD></TR><TR CLASS="c"><TD CLASS="l">450</TD><TD>        return getValueWithArgs(session, args);</TD></TR><TR><TD CLASS="l"><A NAME="10">451</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">452</TD><TD> </TD></TR><TR><TD CLASS="l">453</TD><TD>    private Value getSimpleValue(Session session, Value v0, Expression[] args, Value[] values) {</TD></TR><TR><TD CLASS="l">454</TD><TD>        Value result;</TD></TR><TR CLASS="c"><TD CLASS="l">455</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">456</TD><TD>        case ABS:</TD></TR><TR CLASS="c"><TD CLASS="l">457</TD><TD>            result = v0.getSignum() &gt; 0 ? v0 : v0.negate();</TD></TR><TR CLASS="c"><TD CLASS="l">458</TD><TD>            break;</TD></TR><TR><TD CLASS="l">459</TD><TD>        case ACOS:</TD></TR><TR CLASS="c"><TD CLASS="l">460</TD><TD>            result = ValueDouble.get(Math.acos(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">461</TD><TD>            break;</TD></TR><TR><TD CLASS="l">462</TD><TD>        case ASIN:</TD></TR><TR CLASS="c"><TD CLASS="l">463</TD><TD>            result = ValueDouble.get(Math.asin(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">464</TD><TD>            break;</TD></TR><TR><TD CLASS="l">465</TD><TD>        case ATAN:</TD></TR><TR CLASS="c"><TD CLASS="l">466</TD><TD>            result = ValueDouble.get(Math.atan(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">467</TD><TD>            break;</TD></TR><TR><TD CLASS="l">468</TD><TD>        case CEILING:</TD></TR><TR CLASS="c"><TD CLASS="l">469</TD><TD>            result = ValueDouble.get(Math.ceil(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">470</TD><TD>            break;</TD></TR><TR><TD CLASS="l">471</TD><TD>        case COS:</TD></TR><TR CLASS="c"><TD CLASS="l">472</TD><TD>            result = ValueDouble.get(Math.cos(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">473</TD><TD>            break;</TD></TR><TR><TD CLASS="l">474</TD><TD>        case COSH:</TD></TR><TR CLASS="c"><TD CLASS="l">475</TD><TD>            result = ValueDouble.get(Math.cosh(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">476</TD><TD>            break;</TD></TR><TR><TD CLASS="l">477</TD><TD>        case COT: {</TD></TR><TR CLASS="c"><TD CLASS="l">478</TD><TD>            double d = Math.tan(v0.getDouble());</TD></TR><TR CLASS="c"><TD CLASS="l">479</TD><TD>            if (d == 0.0) {</TD></TR><TR CLASS="z"><TD CLASS="l">480</TD><TD>                throw DbException.get(ErrorCode.DIVISION_BY_ZERO_1, getSQL());</TD></TR><TR><TD CLASS="l">481</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">482</TD><TD>            result = ValueDouble.get(1. / d);</TD></TR><TR CLASS="c"><TD CLASS="l">483</TD><TD>            break;</TD></TR><TR><TD CLASS="l">484</TD><TD>        }</TD></TR><TR><TD CLASS="l">485</TD><TD>        case DEGREES:</TD></TR><TR CLASS="c"><TD CLASS="l">486</TD><TD>            result = ValueDouble.get(Math.toDegrees(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">487</TD><TD>            break;</TD></TR><TR><TD CLASS="l">488</TD><TD>        case EXP:</TD></TR><TR CLASS="c"><TD CLASS="l">489</TD><TD>            result = ValueDouble.get(Math.exp(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">490</TD><TD>            break;</TD></TR><TR><TD CLASS="l">491</TD><TD>        case FLOOR:</TD></TR><TR CLASS="c"><TD CLASS="l">492</TD><TD>            result = ValueDouble.get(Math.floor(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">493</TD><TD>            break;</TD></TR><TR><TD CLASS="l">494</TD><TD>        case LN:</TD></TR><TR CLASS="c"><TD CLASS="l">495</TD><TD>            result = ValueDouble.get(Math.log(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">496</TD><TD>            break;</TD></TR><TR><TD CLASS="l">497</TD><TD>        case LOG:</TD></TR><TR CLASS="c"><TD CLASS="l">498</TD><TD>            if (database.getMode().logIsLogBase10) {</TD></TR><TR CLASS="c"><TD CLASS="l">499</TD><TD>                result = ValueDouble.get(Math.log10(v0.getDouble()));</TD></TR><TR><TD CLASS="l">500</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">501</TD><TD>                result = ValueDouble.get(Math.log(v0.getDouble()));</TD></TR><TR><TD CLASS="l">502</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">503</TD><TD>            break;</TD></TR><TR><TD CLASS="l">504</TD><TD>        case LOG10:</TD></TR><TR CLASS="c"><TD CLASS="l">505</TD><TD>            result = ValueDouble.get(log10(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">506</TD><TD>            break;</TD></TR><TR><TD CLASS="l">507</TD><TD>        case PI:</TD></TR><TR CLASS="c"><TD CLASS="l">508</TD><TD>            result = ValueDouble.get(Math.PI);</TD></TR><TR CLASS="c"><TD CLASS="l">509</TD><TD>            break;</TD></TR><TR><TD CLASS="l">510</TD><TD>        case RADIANS:</TD></TR><TR CLASS="c"><TD CLASS="l">511</TD><TD>            result = ValueDouble.get(Math.toRadians(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">512</TD><TD>            break;</TD></TR><TR><TD CLASS="l">513</TD><TD>        case RAND: {</TD></TR><TR CLASS="c"><TD CLASS="l">514</TD><TD>            if (v0 != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">515</TD><TD>                session.getRandom().setSeed(v0.getInt());</TD></TR><TR><TD CLASS="l">516</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">517</TD><TD>            result = ValueDouble.get(session.getRandom().nextDouble());</TD></TR><TR CLASS="c"><TD CLASS="l">518</TD><TD>            break;</TD></TR><TR><TD CLASS="l">519</TD><TD>        }</TD></TR><TR><TD CLASS="l">520</TD><TD>        case ROUNDMAGIC:</TD></TR><TR CLASS="c"><TD CLASS="l">521</TD><TD>            result = ValueDouble.get(roundmagic(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">522</TD><TD>            break;</TD></TR><TR><TD CLASS="l">523</TD><TD>        case SIGN:</TD></TR><TR CLASS="c"><TD CLASS="l">524</TD><TD>            result = ValueInt.get(v0.getSignum());</TD></TR><TR CLASS="c"><TD CLASS="l">525</TD><TD>            break;</TD></TR><TR><TD CLASS="l">526</TD><TD>        case SIN:</TD></TR><TR CLASS="c"><TD CLASS="l">527</TD><TD>            result = ValueDouble.get(Math.sin(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">528</TD><TD>            break;</TD></TR><TR><TD CLASS="l">529</TD><TD>        case SINH:</TD></TR><TR CLASS="c"><TD CLASS="l">530</TD><TD>            result = ValueDouble.get(Math.sinh(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">531</TD><TD>            break;</TD></TR><TR><TD CLASS="l">532</TD><TD>        case SQRT:</TD></TR><TR CLASS="c"><TD CLASS="l">533</TD><TD>            result = ValueDouble.get(Math.sqrt(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">534</TD><TD>            break;</TD></TR><TR><TD CLASS="l">535</TD><TD>        case TAN:</TD></TR><TR CLASS="c"><TD CLASS="l">536</TD><TD>            result = ValueDouble.get(Math.tan(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">537</TD><TD>            break;</TD></TR><TR><TD CLASS="l">538</TD><TD>        case TANH:</TD></TR><TR CLASS="c"><TD CLASS="l">539</TD><TD>            result = ValueDouble.get(Math.tanh(v0.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">540</TD><TD>            break;</TD></TR><TR><TD CLASS="l">541</TD><TD>        case SECURE_RAND:</TD></TR><TR CLASS="c"><TD CLASS="l">542</TD><TD>            result = ValueBytes.getNoCopy(MathUtils.secureRandomBytes(v0.getInt()));</TD></TR><TR CLASS="c"><TD CLASS="l">543</TD><TD>            break;</TD></TR><TR><TD CLASS="l">544</TD><TD>        case EXPAND:</TD></TR><TR CLASS="z"><TD CLASS="l">545</TD><TD>            result = ValueBytes.getNoCopy(CompressTool.getInstance().expand(v0.getBytesNoCopy()));</TD></TR><TR CLASS="z"><TD CLASS="l">546</TD><TD>            break;</TD></TR><TR><TD CLASS="l">547</TD><TD>        case ZERO:</TD></TR><TR CLASS="c"><TD CLASS="l">548</TD><TD>            result = ValueInt.get(0);</TD></TR><TR CLASS="c"><TD CLASS="l">549</TD><TD>            break;</TD></TR><TR><TD CLASS="l">550</TD><TD>        case RANDOM_UUID:</TD></TR><TR CLASS="c"><TD CLASS="l">551</TD><TD>            result = ValueUuid.getNewRandom();</TD></TR><TR CLASS="c"><TD CLASS="l">552</TD><TD>            break;</TD></TR><TR><TD CLASS="l">553</TD><TD>            // string</TD></TR><TR><TD CLASS="l">554</TD><TD>        case ASCII: {</TD></TR><TR CLASS="c"><TD CLASS="l">555</TD><TD>            String s = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">556</TD><TD>            if (s.length() == 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">557</TD><TD>                result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">558</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">559</TD><TD>                result = ValueInt.get(s.charAt(0));</TD></TR><TR><TD CLASS="l">560</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">561</TD><TD>            break;</TD></TR><TR><TD CLASS="l">562</TD><TD>        }</TD></TR><TR><TD CLASS="l">563</TD><TD>        case BIT_LENGTH:</TD></TR><TR CLASS="c"><TD CLASS="l">564</TD><TD>            result = ValueLong.get(16 * length(v0));</TD></TR><TR CLASS="c"><TD CLASS="l">565</TD><TD>            break;</TD></TR><TR><TD CLASS="l">566</TD><TD>        case CHAR:</TD></TR><TR CLASS="c"><TD CLASS="l">567</TD><TD>            result = ValueString.get(String.valueOf((char) v0.getInt()));</TD></TR><TR CLASS="c"><TD CLASS="l">568</TD><TD>            break;</TD></TR><TR><TD CLASS="l">569</TD><TD>        case CHAR_LENGTH:</TD></TR><TR><TD CLASS="l">570</TD><TD>        case LENGTH:</TD></TR><TR CLASS="c"><TD CLASS="l">571</TD><TD>            result = ValueLong.get(length(v0));</TD></TR><TR CLASS="c"><TD CLASS="l">572</TD><TD>            break;</TD></TR><TR><TD CLASS="l">573</TD><TD>        case OCTET_LENGTH:</TD></TR><TR CLASS="c"><TD CLASS="l">574</TD><TD>            result = ValueLong.get(2 * length(v0));</TD></TR><TR CLASS="c"><TD CLASS="l">575</TD><TD>            break;</TD></TR><TR><TD CLASS="l">576</TD><TD>        case CONCAT_WS:</TD></TR><TR><TD CLASS="l">577</TD><TD>        case CONCAT: {</TD></TR><TR CLASS="c"><TD CLASS="l">578</TD><TD>            result = ValueNull.INSTANCE;</TD></TR><TR CLASS="c"><TD CLASS="l">579</TD><TD>            int start = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">580</TD><TD>            String separator = &#34;&#34;;</TD></TR><TR CLASS="c"><TD CLASS="l">581</TD><TD>            if (info.type == CONCAT_WS) {</TD></TR><TR CLASS="c"><TD CLASS="l">582</TD><TD>                start = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">583</TD><TD>                separator = getNullOrValue(session, args, values, 0).getString();</TD></TR><TR><TD CLASS="l">584</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">585</TD><TD>            for (int i = start; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">586</TD><TD>                Value v = getNullOrValue(session, args, values, i);</TD></TR><TR CLASS="c"><TD CLASS="l">587</TD><TD>                if (v == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">588</TD><TD>                    continue;</TD></TR><TR><TD CLASS="l">589</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">590</TD><TD>                if (result == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">591</TD><TD>                    result = v;</TD></TR><TR><TD CLASS="l">592</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">593</TD><TD>                    String tmp = v.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">594</TD><TD>                    if (!StringUtils.isNullOrEmpty(separator)</TD></TR><TR><TD CLASS="l">595</TD><TD>                            &amp;&amp; !StringUtils.isNullOrEmpty(tmp)) {</TD></TR><TR CLASS="c"><TD CLASS="l">596</TD><TD>                        tmp = separator.concat(tmp);</TD></TR><TR><TD CLASS="l">597</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">598</TD><TD>                    result = ValueString.get(result.getString().concat(tmp));</TD></TR><TR><TD CLASS="l">599</TD><TD>                }</TD></TR><TR><TD CLASS="l">600</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">601</TD><TD>            if (info.type == CONCAT_WS) {</TD></TR><TR CLASS="c"><TD CLASS="l">602</TD><TD>                if (separator != null &amp;&amp; result == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">603</TD><TD>                    result = ValueString.get(&#34;&#34;);</TD></TR><TR><TD CLASS="l">604</TD><TD>                }</TD></TR><TR><TD CLASS="l">605</TD><TD>            }</TD></TR><TR><TD CLASS="l">606</TD><TD>            break;</TD></TR><TR><TD CLASS="l">607</TD><TD>        }</TD></TR><TR><TD CLASS="l">608</TD><TD>        case HEXTORAW:</TD></TR><TR CLASS="c"><TD CLASS="l">609</TD><TD>            result = ValueString.get(hexToRaw(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">610</TD><TD>            break;</TD></TR><TR><TD CLASS="l">611</TD><TD>        case LOWER:</TD></TR><TR><TD CLASS="l">612</TD><TD>        case LCASE:</TD></TR><TR><TD CLASS="l">613</TD><TD>            // TODO this is locale specific, need to document or provide a way</TD></TR><TR><TD CLASS="l">614</TD><TD>            // to set the locale</TD></TR><TR CLASS="c"><TD CLASS="l">615</TD><TD>            result = ValueString.get(v0.getString().toLowerCase());</TD></TR><TR CLASS="c"><TD CLASS="l">616</TD><TD>            break;</TD></TR><TR><TD CLASS="l">617</TD><TD>        case RAWTOHEX:</TD></TR><TR CLASS="c"><TD CLASS="l">618</TD><TD>            result = ValueString.get(rawToHex(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">619</TD><TD>            break;</TD></TR><TR><TD CLASS="l">620</TD><TD>        case SOUNDEX:</TD></TR><TR CLASS="c"><TD CLASS="l">621</TD><TD>            result = ValueString.get(getSoundex(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">622</TD><TD>            break;</TD></TR><TR><TD CLASS="l">623</TD><TD>        case SPACE: {</TD></TR><TR CLASS="c"><TD CLASS="l">624</TD><TD>            int len = Math.max(0, v0.getInt());</TD></TR><TR CLASS="c"><TD CLASS="l">625</TD><TD>            char[] chars = new char[len];</TD></TR><TR CLASS="c"><TD CLASS="l">626</TD><TD>            for (int i = len - 1; i &gt;= 0; i--) {</TD></TR><TR CLASS="c"><TD CLASS="l">627</TD><TD>                chars[i] = ' ';</TD></TR><TR><TD CLASS="l">628</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">629</TD><TD>            result = ValueString.get(new String(chars));</TD></TR><TR CLASS="c"><TD CLASS="l">630</TD><TD>            break;</TD></TR><TR><TD CLASS="l">631</TD><TD>        }</TD></TR><TR><TD CLASS="l">632</TD><TD>        case UPPER:</TD></TR><TR><TD CLASS="l">633</TD><TD>        case UCASE:</TD></TR><TR><TD CLASS="l">634</TD><TD>            // TODO this is locale specific, need to document or provide a way</TD></TR><TR><TD CLASS="l">635</TD><TD>            // to set the locale</TD></TR><TR CLASS="c"><TD CLASS="l">636</TD><TD>            result = ValueString.get(v0.getString().toUpperCase());</TD></TR><TR CLASS="c"><TD CLASS="l">637</TD><TD>            break;</TD></TR><TR><TD CLASS="l">638</TD><TD>        case STRINGENCODE:</TD></TR><TR CLASS="c"><TD CLASS="l">639</TD><TD>            result = ValueString.get(StringUtils.javaEncode(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">640</TD><TD>            break;</TD></TR><TR><TD CLASS="l">641</TD><TD>        case STRINGDECODE:</TD></TR><TR CLASS="c"><TD CLASS="l">642</TD><TD>            result = ValueString.get(StringUtils.javaDecode(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">643</TD><TD>            break;</TD></TR><TR><TD CLASS="l">644</TD><TD>        case STRINGTOUTF8:</TD></TR><TR CLASS="c"><TD CLASS="l">645</TD><TD>            result = ValueBytes.getNoCopy(StringUtils.utf8Encode(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">646</TD><TD>            break;</TD></TR><TR><TD CLASS="l">647</TD><TD>        case UTF8TOSTRING:</TD></TR><TR CLASS="c"><TD CLASS="l">648</TD><TD>            result = ValueString.get(StringUtils.utf8Decode(v0.getBytesNoCopy()));</TD></TR><TR CLASS="c"><TD CLASS="l">649</TD><TD>            break;</TD></TR><TR><TD CLASS="l">650</TD><TD>        case XMLCOMMENT:</TD></TR><TR CLASS="c"><TD CLASS="l">651</TD><TD>            result = ValueString.get(StringUtils.xmlComment(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">652</TD><TD>            break;</TD></TR><TR><TD CLASS="l">653</TD><TD>        case XMLCDATA:</TD></TR><TR CLASS="c"><TD CLASS="l">654</TD><TD>            result = ValueString.get(StringUtils.xmlCData(v0.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">655</TD><TD>            break;</TD></TR><TR><TD CLASS="l">656</TD><TD>        case XMLSTARTDOC:</TD></TR><TR CLASS="c"><TD CLASS="l">657</TD><TD>            result = ValueString.get(StringUtils.xmlStartDoc());</TD></TR><TR CLASS="c"><TD CLASS="l">658</TD><TD>            break;</TD></TR><TR><TD CLASS="l">659</TD><TD>        case DAY_NAME: {</TD></TR><TR CLASS="c"><TD CLASS="l">660</TD><TD>            SimpleDateFormat dayName = new SimpleDateFormat(&#34;EEEE&#34;, Locale.ENGLISH);</TD></TR><TR CLASS="c"><TD CLASS="l">661</TD><TD>            result = ValueString.get(dayName.format(v0.getDate()));</TD></TR><TR CLASS="c"><TD CLASS="l">662</TD><TD>            break;</TD></TR><TR><TD CLASS="l">663</TD><TD>        }</TD></TR><TR><TD CLASS="l">664</TD><TD>        case DAY_OF_MONTH:</TD></TR><TR CLASS="c"><TD CLASS="l">665</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.DAY_OF_MONTH));</TD></TR><TR CLASS="c"><TD CLASS="l">666</TD><TD>            break;</TD></TR><TR><TD CLASS="l">667</TD><TD>        case DAY_OF_WEEK:</TD></TR><TR CLASS="c"><TD CLASS="l">668</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.DAY_OF_WEEK));</TD></TR><TR CLASS="c"><TD CLASS="l">669</TD><TD>            break;</TD></TR><TR><TD CLASS="l">670</TD><TD>        case DAY_OF_YEAR:</TD></TR><TR CLASS="c"><TD CLASS="l">671</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.DAY_OF_YEAR));</TD></TR><TR CLASS="c"><TD CLASS="l">672</TD><TD>            break;</TD></TR><TR><TD CLASS="l">673</TD><TD>        case HOUR:</TD></TR><TR CLASS="c"><TD CLASS="l">674</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getTimestamp(), Calendar.HOUR_OF_DAY));</TD></TR><TR CLASS="c"><TD CLASS="l">675</TD><TD>            break;</TD></TR><TR><TD CLASS="l">676</TD><TD>        case MINUTE:</TD></TR><TR CLASS="c"><TD CLASS="l">677</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getTimestamp(), Calendar.MINUTE));</TD></TR><TR CLASS="c"><TD CLASS="l">678</TD><TD>            break;</TD></TR><TR><TD CLASS="l">679</TD><TD>        case MONTH:</TD></TR><TR CLASS="c"><TD CLASS="l">680</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.MONTH));</TD></TR><TR CLASS="c"><TD CLASS="l">681</TD><TD>            break;</TD></TR><TR><TD CLASS="l">682</TD><TD>        case MONTH_NAME: {</TD></TR><TR CLASS="c"><TD CLASS="l">683</TD><TD>            SimpleDateFormat monthName = new SimpleDateFormat(&#34;MMMM&#34;, Locale.ENGLISH);</TD></TR><TR CLASS="c"><TD CLASS="l">684</TD><TD>            result = ValueString.get(monthName.format(v0.getDate()));</TD></TR><TR CLASS="c"><TD CLASS="l">685</TD><TD>            break;</TD></TR><TR><TD CLASS="l">686</TD><TD>        }</TD></TR><TR><TD CLASS="l">687</TD><TD>        case QUARTER:</TD></TR><TR CLASS="c"><TD CLASS="l">688</TD><TD>            result = ValueInt.get((DateTimeUtils.getDatePart(v0.getDate(), Calendar.MONTH) - 1) / 3 + 1);</TD></TR><TR CLASS="c"><TD CLASS="l">689</TD><TD>            break;</TD></TR><TR><TD CLASS="l">690</TD><TD>        case SECOND:</TD></TR><TR CLASS="c"><TD CLASS="l">691</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getTimestamp(), Calendar.SECOND));</TD></TR><TR CLASS="c"><TD CLASS="l">692</TD><TD>            break;</TD></TR><TR><TD CLASS="l">693</TD><TD>        case WEEK:</TD></TR><TR CLASS="c"><TD CLASS="l">694</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.WEEK_OF_YEAR));</TD></TR><TR CLASS="c"><TD CLASS="l">695</TD><TD>            break;</TD></TR><TR><TD CLASS="l">696</TD><TD>        case YEAR:</TD></TR><TR CLASS="c"><TD CLASS="l">697</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v0.getDate(), Calendar.YEAR));</TD></TR><TR CLASS="c"><TD CLASS="l">698</TD><TD>            break;</TD></TR><TR><TD CLASS="l">699</TD><TD>        case ISO_YEAR:</TD></TR><TR CLASS="c"><TD CLASS="l">700</TD><TD>            result = ValueInt.get(DateTimeUtils.getIsoYear(v0.getDate()));</TD></TR><TR CLASS="c"><TD CLASS="l">701</TD><TD>            break;</TD></TR><TR><TD CLASS="l">702</TD><TD>        case ISO_WEEK:</TD></TR><TR CLASS="c"><TD CLASS="l">703</TD><TD>            result = ValueInt.get(DateTimeUtils.getIsoWeek(v0.getDate()));</TD></TR><TR CLASS="c"><TD CLASS="l">704</TD><TD>            break;</TD></TR><TR><TD CLASS="l">705</TD><TD>        case ISO_DAY_OF_WEEK:</TD></TR><TR CLASS="c"><TD CLASS="l">706</TD><TD>            result = ValueInt.get(DateTimeUtils.getIsoDayOfWeek(v0.getDate()));</TD></TR><TR CLASS="c"><TD CLASS="l">707</TD><TD>            break;</TD></TR><TR><TD CLASS="l">708</TD><TD>        case CURDATE:</TD></TR><TR><TD CLASS="l">709</TD><TD>        case CURRENT_DATE: {</TD></TR><TR CLASS="c"><TD CLASS="l">710</TD><TD>            long now = session.getTransactionStart();</TD></TR><TR><TD CLASS="l">711</TD><TD>            // need to normalize</TD></TR><TR CLASS="c"><TD CLASS="l">712</TD><TD>            result = ValueDate.get(new Date(now));</TD></TR><TR CLASS="c"><TD CLASS="l">713</TD><TD>            break;</TD></TR><TR><TD CLASS="l">714</TD><TD>        }</TD></TR><TR><TD CLASS="l">715</TD><TD>        case CURTIME:</TD></TR><TR><TD CLASS="l">716</TD><TD>        case CURRENT_TIME: {</TD></TR><TR CLASS="c"><TD CLASS="l">717</TD><TD>            long now = session.getTransactionStart();</TD></TR><TR><TD CLASS="l">718</TD><TD>            // need to normalize</TD></TR><TR CLASS="c"><TD CLASS="l">719</TD><TD>            result = ValueTime.get(new Time(now));</TD></TR><TR CLASS="c"><TD CLASS="l">720</TD><TD>            break;</TD></TR><TR><TD CLASS="l">721</TD><TD>        }</TD></TR><TR><TD CLASS="l">722</TD><TD>        case NOW:</TD></TR><TR><TD CLASS="l">723</TD><TD>        case CURRENT_TIMESTAMP: {</TD></TR><TR CLASS="c"><TD CLASS="l">724</TD><TD>            long now = session.getTransactionStart();</TD></TR><TR CLASS="c"><TD CLASS="l">725</TD><TD>            ValueTimestamp vt = ValueTimestamp.get(new Timestamp(now));</TD></TR><TR CLASS="c"><TD CLASS="l">726</TD><TD>            if (v0 != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">727</TD><TD>                Mode mode = database.getMode();</TD></TR><TR CLASS="c"><TD CLASS="l">728</TD><TD>                vt = (ValueTimestamp) vt.convertScale(mode.convertOnlyToSmallerScale, v0.getInt());</TD></TR><TR><TD CLASS="l">729</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">730</TD><TD>            result = vt;</TD></TR><TR CLASS="c"><TD CLASS="l">731</TD><TD>            break;</TD></TR><TR><TD CLASS="l">732</TD><TD>        }</TD></TR><TR><TD CLASS="l">733</TD><TD>        case DATABASE:</TD></TR><TR CLASS="c"><TD CLASS="l">734</TD><TD>            result = ValueString.get(database.getShortName());</TD></TR><TR CLASS="c"><TD CLASS="l">735</TD><TD>            break;</TD></TR><TR><TD CLASS="l">736</TD><TD>        case USER:</TD></TR><TR><TD CLASS="l">737</TD><TD>        case CURRENT_USER:</TD></TR><TR CLASS="c"><TD CLASS="l">738</TD><TD>            result = ValueString.get(session.getUser().getName());</TD></TR><TR CLASS="c"><TD CLASS="l">739</TD><TD>            break;</TD></TR><TR><TD CLASS="l">740</TD><TD>        case IDENTITY:</TD></TR><TR CLASS="c"><TD CLASS="l">741</TD><TD>            result = session.getLastIdentity();</TD></TR><TR CLASS="c"><TD CLASS="l">742</TD><TD>            break;</TD></TR><TR><TD CLASS="l">743</TD><TD>        case SCOPE_IDENTITY:</TD></TR><TR CLASS="c"><TD CLASS="l">744</TD><TD>            result = session.getLastScopeIdentity();</TD></TR><TR CLASS="c"><TD CLASS="l">745</TD><TD>            break;</TD></TR><TR><TD CLASS="l">746</TD><TD>        case AUTOCOMMIT:</TD></TR><TR CLASS="c"><TD CLASS="l">747</TD><TD>            result = ValueBoolean.get(session.getAutoCommit());</TD></TR><TR CLASS="c"><TD CLASS="l">748</TD><TD>            break;</TD></TR><TR><TD CLASS="l">749</TD><TD>        case READONLY:</TD></TR><TR CLASS="c"><TD CLASS="l">750</TD><TD>            result = ValueBoolean.get(database.isReadOnly());</TD></TR><TR CLASS="c"><TD CLASS="l">751</TD><TD>            break;</TD></TR><TR><TD CLASS="l">752</TD><TD>        case DATABASE_PATH: {</TD></TR><TR CLASS="c"><TD CLASS="l">753</TD><TD>            String path = database.getDatabasePath();</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="83% line coverage (10 out of 12 instructions)">754</TD><TD TITLE="83% line coverage (10 out of 12 instructions)">            result = path == null ? (Value) ValueNull.INSTANCE : ValueString.get(path);</TD></TR><TR CLASS="c"><TD CLASS="l">755</TD><TD>            break;</TD></TR><TR><TD CLASS="l">756</TD><TD>        }</TD></TR><TR><TD CLASS="l">757</TD><TD>        case LOCK_TIMEOUT:</TD></TR><TR CLASS="z"><TD CLASS="l">758</TD><TD>            result = ValueInt.get(session.getLockTimeout());</TD></TR><TR CLASS="z"><TD CLASS="l">759</TD><TD>            break;</TD></TR><TR><TD CLASS="l">760</TD><TD>        case CAST:</TD></TR><TR><TD CLASS="l">761</TD><TD>        case CONVERT: {</TD></TR><TR CLASS="c"><TD CLASS="l">762</TD><TD>            v0 = v0.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">763</TD><TD>            Mode mode = database.getMode();</TD></TR><TR CLASS="c"><TD CLASS="l">764</TD><TD>            v0 = v0.convertScale(mode.convertOnlyToSmallerScale, scale);</TD></TR><TR CLASS="c"><TD CLASS="l">765</TD><TD>            v0 = v0.convertPrecision(getPrecision(), false);</TD></TR><TR CLASS="c"><TD CLASS="l">766</TD><TD>            result = v0;</TD></TR><TR CLASS="c"><TD CLASS="l">767</TD><TD>            break;</TD></TR><TR><TD CLASS="l">768</TD><TD>        }</TD></TR><TR><TD CLASS="l">769</TD><TD>        case MEMORY_FREE:</TD></TR><TR CLASS="z"><TD CLASS="l">770</TD><TD>            session.getUser().checkAdmin();</TD></TR><TR CLASS="z"><TD CLASS="l">771</TD><TD>            result = ValueInt.get(Utils.getMemoryFree());</TD></TR><TR CLASS="z"><TD CLASS="l">772</TD><TD>            break;</TD></TR><TR><TD CLASS="l">773</TD><TD>        case MEMORY_USED:</TD></TR><TR CLASS="z"><TD CLASS="l">774</TD><TD>            session.getUser().checkAdmin();</TD></TR><TR CLASS="z"><TD CLASS="l">775</TD><TD>            result = ValueInt.get(Utils.getMemoryUsed());</TD></TR><TR CLASS="z"><TD CLASS="l">776</TD><TD>            break;</TD></TR><TR><TD CLASS="l">777</TD><TD>        case LOCK_MODE:</TD></TR><TR CLASS="z"><TD CLASS="l">778</TD><TD>            result = ValueInt.get(database.getLockMode());</TD></TR><TR CLASS="z"><TD CLASS="l">779</TD><TD>            break;</TD></TR><TR><TD CLASS="l">780</TD><TD>        case SCHEMA:</TD></TR><TR CLASS="z"><TD CLASS="l">781</TD><TD>            result = ValueString.get(session.getCurrentSchemaName());</TD></TR><TR CLASS="z"><TD CLASS="l">782</TD><TD>            break;</TD></TR><TR><TD CLASS="l">783</TD><TD>        case SESSION_ID:</TD></TR><TR CLASS="z"><TD CLASS="l">784</TD><TD>            result = ValueInt.get(session.getId());</TD></TR><TR CLASS="z"><TD CLASS="l">785</TD><TD>            break;</TD></TR><TR><TD CLASS="l">786</TD><TD>        case IFNULL: {</TD></TR><TR CLASS="c"><TD CLASS="l">787</TD><TD>            result = v0;</TD></TR><TR CLASS="c"><TD CLASS="l">788</TD><TD>            if (v0 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">789</TD><TD>                result = getNullOrValue(session, args, values, 1);</TD></TR><TR><TD CLASS="l">790</TD><TD>            }</TD></TR><TR><TD CLASS="l">791</TD><TD>            break;</TD></TR><TR><TD CLASS="l">792</TD><TD>        }</TD></TR><TR><TD CLASS="l">793</TD><TD>        case CASEWHEN: {</TD></TR><TR><TD CLASS="l">794</TD><TD>            Value v;</TD></TR><TR CLASS="c"><TD CLASS="l">795</TD><TD>            if (v0 == ValueNull.INSTANCE || !v0.getBoolean().booleanValue()) {</TD></TR><TR CLASS="c"><TD CLASS="l">796</TD><TD>                v = getNullOrValue(session, args, values, 2);</TD></TR><TR><TD CLASS="l">797</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">798</TD><TD>                v = getNullOrValue(session, args, values, 1);</TD></TR><TR><TD CLASS="l">799</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">800</TD><TD>            result = v.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">801</TD><TD>            break;</TD></TR><TR><TD CLASS="l">802</TD><TD>        }</TD></TR><TR><TD CLASS="l">803</TD><TD>        case DECODE: {</TD></TR><TR CLASS="c"><TD CLASS="l">804</TD><TD>            int index = -1;</TD></TR><TR CLASS="c"><TD CLASS="l">805</TD><TD>            for (int i = 1; i &lt; args.length - 1; i += 2) {</TD></TR><TR CLASS="c"><TD CLASS="l">806</TD><TD>                if (database.areEqual(v0, getNullOrValue(session, args, values, i))) {</TD></TR><TR CLASS="c"><TD CLASS="l">807</TD><TD>                    index = i + 1;</TD></TR><TR><TD CLASS="l">808</TD><TD>                }</TD></TR><TR><TD CLASS="l">809</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">810</TD><TD>            if (index &lt; 0 &amp;&amp; args.length % 2 == 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">811</TD><TD>                index = args.length - 1;</TD></TR><TR><TD CLASS="l">812</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">813</TD><TD>            Value v = index &lt; 0 ? ValueNull.INSTANCE : getNullOrValue(session, args, values, index);</TD></TR><TR CLASS="c"><TD CLASS="l">814</TD><TD>            result = v.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">815</TD><TD>            break;</TD></TR><TR><TD CLASS="l">816</TD><TD>        }</TD></TR><TR><TD CLASS="l">817</TD><TD>        case NVL2: {</TD></TR><TR><TD CLASS="l">818</TD><TD>            Value v;</TD></TR><TR CLASS="c"><TD CLASS="l">819</TD><TD>            if (v0 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">820</TD><TD>                v = getNullOrValue(session, args, values, 2);</TD></TR><TR><TD CLASS="l">821</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">822</TD><TD>                v = getNullOrValue(session, args, values, 1);</TD></TR><TR><TD CLASS="l">823</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">824</TD><TD>            result = v.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">825</TD><TD>            break;</TD></TR><TR><TD CLASS="l">826</TD><TD>        }</TD></TR><TR><TD CLASS="l">827</TD><TD>        case COALESCE: {</TD></TR><TR CLASS="c"><TD CLASS="l">828</TD><TD>            result = v0;</TD></TR><TR CLASS="c"><TD CLASS="l">829</TD><TD>            for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">830</TD><TD>                Value v = getNullOrValue(session, args, values, i);</TD></TR><TR CLASS="c"><TD CLASS="l">831</TD><TD>                if (!(v == ValueNull.INSTANCE)) {</TD></TR><TR CLASS="c"><TD CLASS="l">832</TD><TD>                    result = v.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">833</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">834</TD><TD>                }</TD></TR><TR><TD CLASS="l">835</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">836</TD><TD>            break;</TD></TR><TR><TD CLASS="l">837</TD><TD>        }</TD></TR><TR><TD CLASS="l">838</TD><TD>        case GREATEST:</TD></TR><TR><TD CLASS="l">839</TD><TD>        case LEAST: {</TD></TR><TR CLASS="c"><TD CLASS="l">840</TD><TD>            result = ValueNull.INSTANCE;</TD></TR><TR CLASS="c"><TD CLASS="l">841</TD><TD>            for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">842</TD><TD>                Value v = getNullOrValue(session, args, values, i);</TD></TR><TR CLASS="c"><TD CLASS="l">843</TD><TD>                if (!(v == ValueNull.INSTANCE)) {</TD></TR><TR CLASS="c"><TD CLASS="l">844</TD><TD>                    v = v.convertTo(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">845</TD><TD>                    if (result == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">846</TD><TD>                        result = v;</TD></TR><TR><TD CLASS="l">847</TD><TD>                    } else {</TD></TR><TR CLASS="c"><TD CLASS="l">848</TD><TD>                        int comp = database.compareTypeSave(result, v);</TD></TR><TR CLASS="c"><TD CLASS="l">849</TD><TD>                        if (info.type == GREATEST &amp;&amp; comp &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">850</TD><TD>                            result = v;</TD></TR><TR CLASS="c"><TD CLASS="l">851</TD><TD>                        } else if (info.type == LEAST &amp;&amp; comp &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">852</TD><TD>                            result = v;</TD></TR><TR><TD CLASS="l">853</TD><TD>                        }</TD></TR><TR><TD CLASS="l">854</TD><TD>                    }</TD></TR><TR><TD CLASS="l">855</TD><TD>                }</TD></TR><TR><TD CLASS="l">856</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">857</TD><TD>            break;</TD></TR><TR><TD CLASS="l">858</TD><TD>        }</TD></TR><TR><TD CLASS="l">859</TD><TD>        case CASE: {</TD></TR><TR CLASS="z"><TD CLASS="l">860</TD><TD>            result = null;</TD></TR><TR CLASS="z"><TD CLASS="l">861</TD><TD>            int i = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">862</TD><TD>            for (; i &lt; args.length; i++) {</TD></TR><TR CLASS="z"><TD CLASS="l">863</TD><TD>                Value when = getNullOrValue(session, args, values, i++);</TD></TR><TR CLASS="z"><TD CLASS="l">864</TD><TD>                if (Boolean.TRUE.equals(when)) {</TD></TR><TR CLASS="z"><TD CLASS="l">865</TD><TD>                    result = getNullOrValue(session, args, values, i);</TD></TR><TR CLASS="z"><TD CLASS="l">866</TD><TD>                    break;</TD></TR><TR><TD CLASS="l">867</TD><TD>                }</TD></TR><TR><TD CLASS="l">868</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">869</TD><TD>            if (result == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">870</TD><TD>                result = i &lt; args.length ? getNullOrValue(session, args, values, i) : ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">871</TD><TD>            }</TD></TR><TR><TD CLASS="l">872</TD><TD>            break;</TD></TR><TR><TD CLASS="l">873</TD><TD>        }</TD></TR><TR><TD CLASS="l">874</TD><TD>        case ARRAY_GET: {</TD></TR><TR CLASS="c"><TD CLASS="l">875</TD><TD>            if (v0.getType() == Value.ARRAY) {</TD></TR><TR CLASS="c"><TD CLASS="l">876</TD><TD>                Value v1 = getNullOrValue(session, args, values, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">877</TD><TD>                int element = v1.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">878</TD><TD>                Value[] list = ((ValueArray) v0).getList();</TD></TR><TR CLASS="c"><TD CLASS="l">879</TD><TD>                if (element &lt; 1 || element &gt; list.length) {</TD></TR><TR CLASS="z"><TD CLASS="l">880</TD><TD>                    result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">881</TD><TD>                } else {</TD></TR><TR CLASS="c"><TD CLASS="l">882</TD><TD>                    result = list[element - 1];</TD></TR><TR><TD CLASS="l">883</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">884</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">885</TD><TD>                result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">886</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">887</TD><TD>            break;</TD></TR><TR><TD CLASS="l">888</TD><TD>        }</TD></TR><TR><TD CLASS="l">889</TD><TD>        case ARRAY_LENGTH: {</TD></TR><TR CLASS="z"><TD CLASS="l">890</TD><TD>            if (v0.getType() == Value.ARRAY) {</TD></TR><TR CLASS="z"><TD CLASS="l">891</TD><TD>                Value[] list = ((ValueArray) v0).getList();</TD></TR><TR CLASS="z"><TD CLASS="l">892</TD><TD>                result = ValueInt.get(list.length);</TD></TR><TR CLASS="z"><TD CLASS="l">893</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">894</TD><TD>                result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">895</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">896</TD><TD>            break;</TD></TR><TR><TD CLASS="l">897</TD><TD>        }</TD></TR><TR><TD CLASS="l">898</TD><TD>        case ARRAY_CONTAINS: {</TD></TR><TR CLASS="c"><TD CLASS="l">899</TD><TD>            result = ValueBoolean.get(false);</TD></TR><TR CLASS="c"><TD CLASS="l">900</TD><TD>            if (v0.getType() == Value.ARRAY) {</TD></TR><TR CLASS="c"><TD CLASS="l">901</TD><TD>                Value v1 = getNullOrValue(session, args, values, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">902</TD><TD>                Value[] list = ((ValueArray) v0).getList();</TD></TR><TR CLASS="c"><TD CLASS="l">903</TD><TD>                for (Value v : list) {</TD></TR><TR CLASS="c"><TD CLASS="l">904</TD><TD>                    if (v.equals(v1)) {</TD></TR><TR CLASS="c"><TD CLASS="l">905</TD><TD>                        result = ValueBoolean.get(true);</TD></TR><TR CLASS="c"><TD CLASS="l">906</TD><TD>                        break;</TD></TR><TR><TD CLASS="l">907</TD><TD>                    }</TD></TR><TR><TD CLASS="l">908</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">909</TD><TD>            }</TD></TR><TR><TD CLASS="l">910</TD><TD>            break;</TD></TR><TR><TD CLASS="l">911</TD><TD>        }</TD></TR><TR><TD CLASS="l">912</TD><TD>        case CANCEL_SESSION: {</TD></TR><TR CLASS="z"><TD CLASS="l">913</TD><TD>            result = ValueBoolean.get(cancelStatement(session, v0.getInt()));</TD></TR><TR CLASS="z"><TD CLASS="l">914</TD><TD>            break;</TD></TR><TR><TD CLASS="l">915</TD><TD>        }</TD></TR><TR><TD CLASS="l">916</TD><TD>        case TRANSACTION_ID: {</TD></TR><TR CLASS="c"><TD CLASS="l">917</TD><TD>            result = session.getTransactionId();</TD></TR><TR CLASS="c"><TD CLASS="l">918</TD><TD>            break;</TD></TR><TR><TD CLASS="l">919</TD><TD>        }</TD></TR><TR><TD CLASS="l">920</TD><TD>        default:</TD></TR><TR CLASS="c"><TD CLASS="l">921</TD><TD>            result = null;</TD></TR><TR><TD CLASS="l">922</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1">923</A></TD><TD>        return result;</TD></TR><TR><TD CLASS="l">924</TD><TD>    }</TD></TR><TR><TD CLASS="l">925</TD><TD> </TD></TR><TR><TD CLASS="l">926</TD><TD>    private static boolean cancelStatement(Session session, int targetSessionId) {</TD></TR><TR CLASS="z"><TD CLASS="l">927</TD><TD>        session.getUser().checkAdmin();</TD></TR><TR CLASS="z"><TD CLASS="l">928</TD><TD>        Session[] sessions = session.getDatabase().getSessions(false);</TD></TR><TR CLASS="z"><TD CLASS="l">929</TD><TD>        for (Session s : sessions) {</TD></TR><TR CLASS="z"><TD CLASS="l">930</TD><TD>            if (s.getId() == targetSessionId) {</TD></TR><TR CLASS="z"><TD CLASS="l">931</TD><TD>                Command c = s.getCurrentCommand();</TD></TR><TR CLASS="z"><TD CLASS="l">932</TD><TD>                if (c == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">933</TD><TD>                    return false;</TD></TR><TR><TD CLASS="l">934</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">935</TD><TD>                c.cancel();</TD></TR><TR CLASS="z"><TD CLASS="l">936</TD><TD>                return true;</TD></TR><TR><TD CLASS="l">937</TD><TD>            }</TD></TR><TR><TD CLASS="l">938</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l"><A NAME="28">939</A></TD><TD>        return false;</TD></TR><TR><TD CLASS="l">940</TD><TD>    }</TD></TR><TR><TD CLASS="l">941</TD><TD> </TD></TR><TR><TD CLASS="l">942</TD><TD>    private static Value getNullOrValue(Session session, Expression[] args, Value[] values, int i) {</TD></TR><TR CLASS="c"><TD CLASS="l">943</TD><TD>        if (i &gt;= args.length) {</TD></TR><TR CLASS="c"><TD CLASS="l">944</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">945</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">946</TD><TD>        Value v = values[i];</TD></TR><TR CLASS="c"><TD CLASS="l">947</TD><TD>        if (v == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">948</TD><TD>            v = values[i] = args[i].getValue(session);</TD></TR><TR><TD CLASS="l">949</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="13">950</A></TD><TD>        return v;</TD></TR><TR><TD CLASS="l">951</TD><TD>    }</TD></TR><TR><TD CLASS="l">952</TD><TD> </TD></TR><TR><TD CLASS="l">953</TD><TD>    private Value getValueWithArgs(Session session, Expression[] args) {</TD></TR><TR CLASS="c"><TD CLASS="l">954</TD><TD>        Value[] values = new Value[args.length];</TD></TR><TR CLASS="c"><TD CLASS="l">955</TD><TD>        if (info.nullIfParameterIsNull) {</TD></TR><TR CLASS="c"><TD CLASS="l">956</TD><TD>            for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">957</TD><TD>                Expression e = args[i];</TD></TR><TR CLASS="c"><TD CLASS="l">958</TD><TD>                Value v = e.getValue(session);</TD></TR><TR CLASS="c"><TD CLASS="l">959</TD><TD>                if (v == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">960</TD><TD>                    return ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">961</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">962</TD><TD>                values[i] = v;</TD></TR><TR><TD CLASS="l">963</TD><TD>            }</TD></TR><TR><TD CLASS="l">964</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">965</TD><TD>        Value v0 = getNullOrValue(session, args, values, 0);</TD></TR><TR CLASS="c"><TD CLASS="l">966</TD><TD>        Value resultSimple = getSimpleValue(session, v0, args, values);</TD></TR><TR CLASS="c"><TD CLASS="l">967</TD><TD>        if (resultSimple != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">968</TD><TD>            return resultSimple;</TD></TR><TR><TD CLASS="l">969</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">970</TD><TD>        Value v1 = getNullOrValue(session, args, values, 1);</TD></TR><TR CLASS="c"><TD CLASS="l">971</TD><TD>        Value v2 = getNullOrValue(session, args, values, 2);</TD></TR><TR CLASS="c"><TD CLASS="l">972</TD><TD>        Value v3 = getNullOrValue(session, args, values, 3);</TD></TR><TR CLASS="c"><TD CLASS="l">973</TD><TD>        Value v4 = getNullOrValue(session, args, values, 4);</TD></TR><TR CLASS="c"><TD CLASS="l">974</TD><TD>        Value v5 = getNullOrValue(session, args, values, 5);</TD></TR><TR><TD CLASS="l">975</TD><TD>        Value result;</TD></TR><TR CLASS="c"><TD CLASS="l">976</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">977</TD><TD>        case ATAN2:</TD></TR><TR CLASS="c"><TD CLASS="l">978</TD><TD>            result = ValueDouble.get(Math.atan2(v0.getDouble(), v1.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">979</TD><TD>            break;</TD></TR><TR><TD CLASS="l">980</TD><TD>        case BITAND:</TD></TR><TR CLASS="c"><TD CLASS="l">981</TD><TD>            result = ValueLong.get(v0.getLong() &amp; v1.getLong());</TD></TR><TR CLASS="c"><TD CLASS="l">982</TD><TD>            break;</TD></TR><TR><TD CLASS="l">983</TD><TD>        case BITOR:</TD></TR><TR CLASS="c"><TD CLASS="l">984</TD><TD>            result = ValueLong.get(v0.getLong() | v1.getLong());</TD></TR><TR CLASS="c"><TD CLASS="l">985</TD><TD>            break;</TD></TR><TR><TD CLASS="l">986</TD><TD>        case BITXOR:</TD></TR><TR CLASS="c"><TD CLASS="l">987</TD><TD>            result = ValueLong.get(v0.getLong() ^ v1.getLong());</TD></TR><TR CLASS="c"><TD CLASS="l">988</TD><TD>            break;</TD></TR><TR><TD CLASS="l">989</TD><TD>        case MOD: {</TD></TR><TR CLASS="c"><TD CLASS="l">990</TD><TD>            long x = v1.getLong();</TD></TR><TR CLASS="c"><TD CLASS="l">991</TD><TD>            if (x == 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">992</TD><TD>                throw DbException.get(ErrorCode.DIVISION_BY_ZERO_1, getSQL());</TD></TR><TR><TD CLASS="l">993</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">994</TD><TD>            result = ValueLong.get(v0.getLong() % x);</TD></TR><TR CLASS="c"><TD CLASS="l">995</TD><TD>            break;</TD></TR><TR><TD CLASS="l">996</TD><TD>        }</TD></TR><TR><TD CLASS="l">997</TD><TD>        case POWER:</TD></TR><TR CLASS="c"><TD CLASS="l">998</TD><TD>            result = ValueDouble.get(Math.pow(v0.getDouble(), v1.getDouble()));</TD></TR><TR CLASS="c"><TD CLASS="l">999</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1000</TD><TD>        case ROUND: {</TD></TR><TR CLASS="c"><TD CLASS="l">1001</TD><TD>            double f = v1 == null ? 1. : Math.pow(10., v1.getDouble());</TD></TR><TR CLASS="c"><TD CLASS="l">1002</TD><TD>            result = ValueDouble.get(Math.round(v0.getDouble() * f) / f);</TD></TR><TR CLASS="c"><TD CLASS="l">1003</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1004</TD><TD>        }</TD></TR><TR><TD CLASS="l">1005</TD><TD>        case TRUNCATE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1006</TD><TD>            double d = v0.getDouble();</TD></TR><TR CLASS="c"><TD CLASS="l">1007</TD><TD>            int p = v1.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">1008</TD><TD>            double f = Math.pow(10., p);</TD></TR><TR CLASS="c"><TD CLASS="l">1009</TD><TD>            double g = d * f;</TD></TR><TR CLASS="c"><TD CLASS="l">1010</TD><TD>            result = ValueDouble.get(((d &lt; 0) ? Math.ceil(g) : Math.floor(g)) / f);</TD></TR><TR CLASS="c"><TD CLASS="l">1011</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1012</TD><TD>        }</TD></TR><TR><TD CLASS="l">1013</TD><TD>        case HASH:</TD></TR><TR CLASS="c"><TD CLASS="l">1014</TD><TD>            result = ValueBytes.getNoCopy(getHash(v0.getString(), v1.getBytesNoCopy(), v2.getInt()));</TD></TR><TR CLASS="c"><TD CLASS="l">1015</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1016</TD><TD>        case ENCRYPT:</TD></TR><TR CLASS="c"><TD CLASS="l">1017</TD><TD>            result = ValueBytes.getNoCopy(encrypt(v0.getString(), v1.getBytesNoCopy(), v2.getBytesNoCopy()));</TD></TR><TR CLASS="c"><TD CLASS="l">1018</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1019</TD><TD>        case DECRYPT:</TD></TR><TR CLASS="c"><TD CLASS="l">1020</TD><TD>            result = ValueBytes.getNoCopy(decrypt(v0.getString(), v1.getBytesNoCopy(), v2.getBytesNoCopy()));</TD></TR><TR CLASS="c"><TD CLASS="l">1021</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1022</TD><TD>        case COMPRESS: {</TD></TR><TR CLASS="z"><TD CLASS="l">1023</TD><TD>            String algorithm = null;</TD></TR><TR CLASS="z"><TD CLASS="l">1024</TD><TD>            if (v1 != null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1025</TD><TD>                algorithm = v1.getString();</TD></TR><TR><TD CLASS="l">1026</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1027</TD><TD>            result = ValueBytes.getNoCopy(CompressTool.getInstance().compress(v0.getBytesNoCopy(), algorithm));</TD></TR><TR CLASS="z"><TD CLASS="l">1028</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1029</TD><TD>        }</TD></TR><TR><TD CLASS="l">1030</TD><TD>        case DIFFERENCE:</TD></TR><TR CLASS="c"><TD CLASS="l">1031</TD><TD>            result = ValueInt.get(getDifference(v0.getString(), v1.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">1032</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1033</TD><TD>        case INSERT: {</TD></TR><TR CLASS="c"><TD CLASS="l">1034</TD><TD>            if (v1 == ValueNull.INSTANCE || v2 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">1035</TD><TD>                result = v1;</TD></TR><TR><TD CLASS="l">1036</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1037</TD><TD>                result = ValueString.get(insert(v0.getString(), v1.getInt(), v2.getInt(), v3.getString()));</TD></TR><TR><TD CLASS="l">1038</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1039</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1040</TD><TD>        }</TD></TR><TR><TD CLASS="l">1041</TD><TD>        case LEFT:</TD></TR><TR CLASS="c"><TD CLASS="l">1042</TD><TD>            result = ValueString.get(left(v0.getString(), v1.getInt()));</TD></TR><TR CLASS="c"><TD CLASS="l">1043</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1044</TD><TD>        case LOCATE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1045</TD><TD>            int start = v2 == null ? 0 : v2.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">1046</TD><TD>            result = ValueInt.get(locate(v0.getString(), v1.getString(), start));</TD></TR><TR CLASS="c"><TD CLASS="l">1047</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1048</TD><TD>        }</TD></TR><TR><TD CLASS="l">1049</TD><TD>        case INSTR: {</TD></TR><TR CLASS="c"><TD CLASS="l">1050</TD><TD>            int start = v2 == null ? 0 : v2.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">1051</TD><TD>            result = ValueInt.get(locate(v1.getString(), v0.getString(), start));</TD></TR><TR CLASS="c"><TD CLASS="l">1052</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1053</TD><TD>        }</TD></TR><TR><TD CLASS="l">1054</TD><TD>        case REPEAT: {</TD></TR><TR CLASS="c"><TD CLASS="l">1055</TD><TD>            int count = Math.max(0, v1.getInt());</TD></TR><TR CLASS="c"><TD CLASS="l">1056</TD><TD>            result = ValueString.get(repeat(v0.getString(), count));</TD></TR><TR CLASS="c"><TD CLASS="l">1057</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1058</TD><TD>        }</TD></TR><TR><TD CLASS="l">1059</TD><TD>        case REPLACE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1060</TD><TD>            String s0 = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1061</TD><TD>            String s1 = v1.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1062</TD><TD>            String s2 = (v2 == null) ? &#34;&#34; : v2.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1063</TD><TD>            result = ValueString.get(replace(s0, s1, s2));</TD></TR><TR CLASS="c"><TD CLASS="l">1064</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1065</TD><TD>        }</TD></TR><TR><TD CLASS="l">1066</TD><TD>        case RIGHT:</TD></TR><TR CLASS="c"><TD CLASS="l">1067</TD><TD>            result = ValueString.get(right(v0.getString(), v1.getInt()));</TD></TR><TR CLASS="c"><TD CLASS="l">1068</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1069</TD><TD>        case LTRIM:</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="86% line coverage (12 out of 14 instructions)">1070</TD><TD TITLE="86% line coverage (12 out of 14 instructions)">            result = ValueString.get(StringUtils.trim(v0.getString(), true, false, v1 == null ? &#34; &#34; : v1.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">1071</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1072</TD><TD>        case TRIM:</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="86% line coverage (12 out of 14 instructions)">1073</TD><TD TITLE="86% line coverage (12 out of 14 instructions)">            result = ValueString.get(StringUtils.trim(v0.getString(), true, true, v1 == null ? &#34; &#34; : v1.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">1074</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1075</TD><TD>        case RTRIM:</TD></TR><TR CLASS="c"><TD CLASS="l">1076</TD><TD>            result = ValueString.get(StringUtils.trim(v0.getString(), false, true, v1 == null ? &#34; &#34; : v1.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">1077</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1078</TD><TD>        case SUBSTR:</TD></TR><TR><TD CLASS="l">1079</TD><TD>        case SUBSTRING: {</TD></TR><TR CLASS="c"><TD CLASS="l">1080</TD><TD>            String s = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1081</TD><TD>            int offset = v1.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">1082</TD><TD>            if (offset &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1083</TD><TD>                offset = s.length() + offset + 1;</TD></TR><TR><TD CLASS="l">1084</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1085</TD><TD>            int length = v2 == null ? s.length() : v2.getInt();</TD></TR><TR CLASS="c"><TD CLASS="l">1086</TD><TD>            result = ValueString.get(substring(s, offset, length));</TD></TR><TR CLASS="c"><TD CLASS="l">1087</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1088</TD><TD>        }</TD></TR><TR><TD CLASS="l">1089</TD><TD>        case POSITION:</TD></TR><TR CLASS="c"><TD CLASS="l">1090</TD><TD>            result = ValueInt.get(locate(v0.getString(), v1.getString(), 0));</TD></TR><TR CLASS="c"><TD CLASS="l">1091</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1092</TD><TD>        case XMLATTR:</TD></TR><TR CLASS="c"><TD CLASS="l">1093</TD><TD>            result = ValueString.get(StringUtils.xmlAttr(v0.getString(), v1.getString()));</TD></TR><TR CLASS="c"><TD CLASS="l">1094</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1095</TD><TD>        case XMLNODE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1096</TD><TD>            String attr = v1 == null ? null : v1 == ValueNull.INSTANCE ? null : v1.getString();</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="87% line coverage (13 out of 15 instructions)">1097</TD><TD TITLE="87% line coverage (13 out of 15 instructions)">            String content = v2 == null ? null : v2 == ValueNull.INSTANCE ? null : v2.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1098</TD><TD>            boolean indent = v3 == null ? true : v3.getBoolean();</TD></TR><TR CLASS="c"><TD CLASS="l">1099</TD><TD>            result = ValueString.get(StringUtils.xmlNode(v0.getString(), attr, content, indent));</TD></TR><TR CLASS="c"><TD CLASS="l">1100</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1101</TD><TD>        }</TD></TR><TR><TD CLASS="l">1102</TD><TD>        case REGEXP_REPLACE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1103</TD><TD>            String regexp = v1.getString();</TD></TR><TR><TD CLASS="l">1104</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1105</TD><TD>                result = ValueString.get(v0.getString().replaceAll(regexp, v2.getString()));</TD></TR><TR CLASS="z"><TD CLASS="l">1106</TD><TD>            } catch (PatternSyntaxException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1107</TD><TD>                throw DbException.get(ErrorCode.LIKE_ESCAPE_ERROR_1, e, regexp);</TD></TR><TR CLASS="c"><TD CLASS="l">1108</TD><TD>            }</TD></TR><TR><TD CLASS="l">1109</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1110</TD><TD>        }</TD></TR><TR><TD CLASS="l">1111</TD><TD>        case RPAD:</TD></TR><TR CLASS="z"><TD CLASS="l">1112</TD><TD>            result = ValueString.get(StringUtils.pad(v0.getString(), v1.getInt(), v2 == null ? null : v2.getString(), true));</TD></TR><TR CLASS="z"><TD CLASS="l">1113</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1114</TD><TD>        case LPAD:</TD></TR><TR CLASS="z"><TD CLASS="l">1115</TD><TD>            result = ValueString.get(StringUtils.pad(v0.getString(), v1.getInt(), v2 == null ? null : v2.getString(), false));</TD></TR><TR CLASS="z"><TD CLASS="l">1116</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1117</TD><TD>            // date</TD></TR><TR><TD CLASS="l">1118</TD><TD>        case DATE_ADD:</TD></TR><TR CLASS="c"><TD CLASS="l">1119</TD><TD>            result = ValueTimestamp.get(dateadd(v0.getString(), v1.getInt(), v2.getTimestamp()));</TD></TR><TR CLASS="c"><TD CLASS="l">1120</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1121</TD><TD>        case DATE_DIFF:</TD></TR><TR CLASS="c"><TD CLASS="l">1122</TD><TD>            result = ValueLong.get(datediff(v0.getString(), v1.getTimestamp(), v2.getTimestamp()));</TD></TR><TR CLASS="c"><TD CLASS="l">1123</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1124</TD><TD>        case EXTRACT: {</TD></TR><TR CLASS="c"><TD CLASS="l">1125</TD><TD>            int field = getDatePart(v0.getString());</TD></TR><TR CLASS="c"><TD CLASS="l">1126</TD><TD>            result = ValueInt.get(DateTimeUtils.getDatePart(v1.getTimestamp(), field));</TD></TR><TR CLASS="c"><TD CLASS="l">1127</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1128</TD><TD>        }</TD></TR><TR><TD CLASS="l">1129</TD><TD>        case FORMATDATETIME: {</TD></TR><TR CLASS="c"><TD CLASS="l">1130</TD><TD>            if (v0 == ValueNull.INSTANCE || v1 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1131</TD><TD>                result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">1132</TD><TD>            } else {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="86% line coverage (12 out of 14 instructions)">1133</TD><TD TITLE="86% line coverage (12 out of 14 instructions)">                String locale = v2 == null ? null : v2 == ValueNull.INSTANCE ? null : v2.getString();</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="91% line coverage (21 out of 23 instructions)">1134</TD><TD TITLE="91% line coverage (21 out of 23 instructions)">                String tz = v3 == null ? null : v3 == ValueNull.INSTANCE ? null : v3.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1135</TD><TD>                result = ValueString.get(DateTimeUtils.formatDateTime(v0.getTimestamp(), v1.getString(), locale, tz));</TD></TR><TR><TD CLASS="l">1136</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1137</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1138</TD><TD>        }</TD></TR><TR><TD CLASS="l">1139</TD><TD>        case PARSEDATETIME: {</TD></TR><TR CLASS="c"><TD CLASS="l">1140</TD><TD>            if (v0 == ValueNull.INSTANCE || v1 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="z"><TD CLASS="l">1141</TD><TD>                result = ValueNull.INSTANCE;</TD></TR><TR><TD CLASS="l">1142</TD><TD>            } else {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="86% line coverage (12 out of 14 instructions)">1143</TD><TD TITLE="86% line coverage (12 out of 14 instructions)">                String locale = v2 == null ? null : v2 == ValueNull.INSTANCE ? null : v2.getString();</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="93% line coverage (27 out of 29 instructions)">1144</TD><TD TITLE="93% line coverage (27 out of 29 instructions)">                String tz = v3 == null ? null : v3 == ValueNull.INSTANCE ? null : v3.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1145</TD><TD>                java.util.Date d = DateTimeUtils.parseDateTime(v0.getString(), v1.getString(), locale, tz);</TD></TR><TR CLASS="c"><TD CLASS="l">1146</TD><TD>                result = ValueTimestamp.get(new Timestamp(d.getTime()));</TD></TR><TR><TD CLASS="l">1147</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1148</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1149</TD><TD>        }</TD></TR><TR><TD CLASS="l">1150</TD><TD>        case NULLIF:</TD></TR><TR CLASS="c"><TD CLASS="l">1151</TD><TD>            result = database.areEqual(v0, v1) ? ValueNull.INSTANCE : v0;</TD></TR><TR CLASS="c"><TD CLASS="l">1152</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1153</TD><TD>            // system</TD></TR><TR><TD CLASS="l">1154</TD><TD>        case NEXTVAL: {</TD></TR><TR CLASS="c"><TD CLASS="l">1155</TD><TD>            Sequence sequence = getSequence(session, v0, v1);</TD></TR><TR CLASS="c"><TD CLASS="l">1156</TD><TD>            SequenceValue value = new SequenceValue(sequence);</TD></TR><TR CLASS="c"><TD CLASS="l">1157</TD><TD>            result = value.getValue(session);</TD></TR><TR CLASS="c"><TD CLASS="l">1158</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1159</TD><TD>        }</TD></TR><TR><TD CLASS="l">1160</TD><TD>        case CURRVAL: {</TD></TR><TR CLASS="c"><TD CLASS="l">1161</TD><TD>            Sequence sequence = getSequence(session, v0, v1);</TD></TR><TR CLASS="c"><TD CLASS="l">1162</TD><TD>            result = ValueLong.get(sequence.getCurrentValue());</TD></TR><TR CLASS="c"><TD CLASS="l">1163</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1164</TD><TD>        }</TD></TR><TR><TD CLASS="l">1165</TD><TD>        case CSVREAD: {</TD></TR><TR CLASS="c"><TD CLASS="l">1166</TD><TD>            String fileName = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1167</TD><TD>            String columnList = v1 == null ? null : v1.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1168</TD><TD>            Csv csv = new Csv();</TD></TR><TR CLASS="c"><TD CLASS="l">1169</TD><TD>            String options = v2 == null ? null : v2.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1170</TD><TD>            String charset = null;</TD></TR><TR CLASS="c"><TD CLASS="l">1171</TD><TD>            if (options != null &amp;&amp; options.indexOf('=') &gt;= 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1172</TD><TD>                charset = csv.setOptions(options);</TD></TR><TR><TD CLASS="l">1173</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1174</TD><TD>                charset = options;</TD></TR><TR CLASS="c"><TD CLASS="l">1175</TD><TD>                String fieldSeparatorRead = v3 == null ? null : v3.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1176</TD><TD>                String fieldDelimiter = v4 == null ? null : v4.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1177</TD><TD>                String escapeCharacter = v5 == null ? null : v5.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1178</TD><TD>                Value v6 = getNullOrValue(session, args, values, 6);</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="91% line coverage (20 out of 22 instructions)">1179</TD><TD TITLE="91% line coverage (20 out of 22 instructions)">                String nullString = v6 == null ? null : v6.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1180</TD><TD>                setCsvDelimiterEscape(csv, fieldSeparatorRead, fieldDelimiter, escapeCharacter);</TD></TR><TR CLASS="c"><TD CLASS="l">1181</TD><TD>                csv.setNullString(nullString);</TD></TR><TR><TD CLASS="l">1182</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1183</TD><TD>            char fieldSeparator = csv.getFieldSeparatorRead();</TD></TR><TR CLASS="c"><TD CLASS="l">1184</TD><TD>            String[] columns = StringUtils.arraySplit(columnList, fieldSeparator, true);</TD></TR><TR><TD CLASS="l">1185</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1186</TD><TD>                ValueResultSet vr = ValueResultSet.get(csv.read(fileName, columns, charset));</TD></TR><TR CLASS="c"><TD CLASS="l">1187</TD><TD>                result = vr;</TD></TR><TR CLASS="z"><TD CLASS="l">1188</TD><TD>            } catch (SQLException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1189</TD><TD>                throw DbException.convert(e);</TD></TR><TR CLASS="c"><TD CLASS="l">1190</TD><TD>            }</TD></TR><TR><TD CLASS="l">1191</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1192</TD><TD>        }</TD></TR><TR><TD CLASS="l">1193</TD><TD>        case LINK_SCHEMA: {</TD></TR><TR CLASS="c"><TD CLASS="l">1194</TD><TD>            session.getUser().checkAdmin();</TD></TR><TR CLASS="c"><TD CLASS="l">1195</TD><TD>            Connection conn = session.createConnection(false);</TD></TR><TR CLASS="c"><TD CLASS="l">1196</TD><TD>            ResultSet rs = LinkSchema.linkSchema(conn, v0.getString(), v1.getString(), v2.getString(), v3.getString(),</TD></TR><TR><TD CLASS="l">1197</TD><TD>                    v4.getString(), v5.getString());</TD></TR><TR CLASS="c"><TD CLASS="l">1198</TD><TD>            result = ValueResultSet.get(rs);</TD></TR><TR CLASS="c"><TD CLASS="l">1199</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1200</TD><TD>        }</TD></TR><TR><TD CLASS="l">1201</TD><TD>        case CSVWRITE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1202</TD><TD>            session.getUser().checkAdmin();</TD></TR><TR CLASS="c"><TD CLASS="l">1203</TD><TD>            Connection conn = session.createConnection(false);</TD></TR><TR CLASS="c"><TD CLASS="l">1204</TD><TD>            Csv csv = new Csv();</TD></TR><TR CLASS="c"><TD CLASS="l">1205</TD><TD>            String options = v2 == null ? null : v2.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1206</TD><TD>            String charset = null;</TD></TR><TR CLASS="c"><TD CLASS="l">1207</TD><TD>            if (options != null &amp;&amp; options.indexOf('=') &gt;= 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1208</TD><TD>                charset = csv.setOptions(options);</TD></TR><TR><TD CLASS="l">1209</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1210</TD><TD>                charset = options;</TD></TR><TR CLASS="c"><TD CLASS="l">1211</TD><TD>                String fieldSeparatorWrite = v3 == null ? null : v3.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1212</TD><TD>                String fieldDelimiter = v4 == null ? null : v4.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1213</TD><TD>                String escapeCharacter = v5 == null ? null : v5.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1214</TD><TD>                Value v6 = getNullOrValue(session, args, values, 6);</TD></TR><TR CLASS="c"><TD CLASS="l">1215</TD><TD>                String nullString = v6 == null ? null : v6.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1216</TD><TD>                Value v7 = getNullOrValue(session, args, values, 7);</TD></TR><TR CLASS="c"><TD CLASS="l">1217</TD><TD>                String lineSeparator = v7 == null ? null : v7.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1218</TD><TD>                setCsvDelimiterEscape(csv, fieldSeparatorWrite, fieldDelimiter, escapeCharacter);</TD></TR><TR CLASS="c"><TD CLASS="l">1219</TD><TD>                csv.setNullString(nullString);</TD></TR><TR CLASS="c"><TD CLASS="l">1220</TD><TD>                if (lineSeparator != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1221</TD><TD>                    csv.setLineSeparator(lineSeparator);</TD></TR><TR><TD CLASS="l">1222</TD><TD>                }</TD></TR><TR><TD CLASS="l">1223</TD><TD>            }</TD></TR><TR><TD CLASS="l">1224</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1225</TD><TD>                int rows = csv.write(conn, v0.getString(), v1.getString(), charset);</TD></TR><TR CLASS="c"><TD CLASS="l">1226</TD><TD>                result = ValueInt.get(rows);</TD></TR><TR CLASS="z"><TD CLASS="l">1227</TD><TD>            } catch (SQLException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1228</TD><TD>                throw DbException.convert(e);</TD></TR><TR CLASS="c"><TD CLASS="l">1229</TD><TD>            }</TD></TR><TR><TD CLASS="l">1230</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1231</TD><TD>        }</TD></TR><TR><TD CLASS="l">1232</TD><TD>        case SET: {</TD></TR><TR CLASS="c"><TD CLASS="l">1233</TD><TD>            Variable var = (Variable) args[0];</TD></TR><TR CLASS="c"><TD CLASS="l">1234</TD><TD>            session.setVariable(var.getName(), v1);</TD></TR><TR CLASS="c"><TD CLASS="l">1235</TD><TD>            result = v1;</TD></TR><TR CLASS="c"><TD CLASS="l">1236</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1237</TD><TD>        }</TD></TR><TR><TD CLASS="l">1238</TD><TD>        case FILE_READ: {</TD></TR><TR CLASS="c"><TD CLASS="l">1239</TD><TD>            session.getUser().checkAdmin();</TD></TR><TR CLASS="c"><TD CLASS="l">1240</TD><TD>            String fileName = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1241</TD><TD>            boolean blob = args.length == 1;</TD></TR><TR><TD CLASS="l">1242</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1243</TD><TD>                InputStream in = new AutoCloseInputStream(FileUtils.newInputStream(fileName));</TD></TR><TR CLASS="c"><TD CLASS="l">1244</TD><TD>                if (blob) {</TD></TR><TR CLASS="c"><TD CLASS="l">1245</TD><TD>                    result = database.getLobStorage().createBlob(in, -1);</TD></TR><TR><TD CLASS="l">1246</TD><TD>                } else {</TD></TR><TR><TD CLASS="l">1247</TD><TD>                    Reader reader;</TD></TR><TR CLASS="c"><TD CLASS="l">1248</TD><TD>                    if (v1 == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">1249</TD><TD>                        reader = new InputStreamReader(in);</TD></TR><TR><TD CLASS="l">1250</TD><TD>                    } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1251</TD><TD>                        reader = new InputStreamReader(in, v1.getString());</TD></TR><TR><TD CLASS="l">1252</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">1253</TD><TD>                    result = database.getLobStorage().createClob(reader, -1);</TD></TR><TR><TD CLASS="l">1254</TD><TD>                }</TD></TR><TR CLASS="z"><TD CLASS="l">1255</TD><TD>            } catch (IOException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1256</TD><TD>                throw DbException.convertIOException(e, fileName);</TD></TR><TR CLASS="c"><TD CLASS="l">1257</TD><TD>            }</TD></TR><TR><TD CLASS="l">1258</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1259</TD><TD>        }</TD></TR><TR><TD CLASS="l">1260</TD><TD>        case TRUNCATE_VALUE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1261</TD><TD>            result = v0.convertPrecision(v1.getLong(), v2.getBoolean());</TD></TR><TR CLASS="c"><TD CLASS="l">1262</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1263</TD><TD>        }</TD></TR><TR><TD CLASS="l">1264</TD><TD>        case XMLTEXT:</TD></TR><TR CLASS="c"><TD CLASS="l">1265</TD><TD>            if (v1 == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1266</TD><TD>                result = ValueString.get(StringUtils.xmlText(v0.getString()));</TD></TR><TR><TD CLASS="l">1267</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1268</TD><TD>                result = ValueString.get(StringUtils.xmlText(v0.getString(), v1.getBoolean()));</TD></TR><TR><TD CLASS="l">1269</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1270</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1271</TD><TD>        default:</TD></TR><TR CLASS="z"><TD CLASS="l">1272</TD><TD>            throw DbException.throwInternalError(&#34;type=&#34; + info.type);</TD></TR><TR><TD CLASS="l">1273</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1274</TD><TD>        return result;</TD></TR><TR><TD CLASS="l"><A NAME="a">1275</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1276</TD><TD> </TD></TR><TR><TD CLASS="l">1277</TD><TD>    private Sequence getSequence(Session session, Value v0, Value v1) {</TD></TR><TR><TD CLASS="l">1278</TD><TD>        String schemaName, sequenceName;</TD></TR><TR CLASS="c"><TD CLASS="l">1279</TD><TD>        if (v1 == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1280</TD><TD>            Parser p = new Parser(session);</TD></TR><TR CLASS="c"><TD CLASS="l">1281</TD><TD>            String sql = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1282</TD><TD>            Expression expr = p.parseExpression(sql);</TD></TR><TR CLASS="c"><TD CLASS="l">1283</TD><TD>            if (expr instanceof ExpressionColumn) {</TD></TR><TR CLASS="c"><TD CLASS="l">1284</TD><TD>                ExpressionColumn seq = (ExpressionColumn) expr;</TD></TR><TR CLASS="c"><TD CLASS="l">1285</TD><TD>                schemaName = seq.getOriginalTableAliasName();</TD></TR><TR CLASS="c"><TD CLASS="l">1286</TD><TD>                if (schemaName == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1287</TD><TD>                    schemaName = session.getCurrentSchemaName();</TD></TR><TR CLASS="c"><TD CLASS="l">1288</TD><TD>                    sequenceName = sql;</TD></TR><TR><TD CLASS="l">1289</TD><TD>                } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1290</TD><TD>                    sequenceName = seq.getColumnName();</TD></TR><TR><TD CLASS="l">1291</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1292</TD><TD>            } else {</TD></TR><TR CLASS="z"><TD CLASS="l">1293</TD><TD>                throw DbException.getSyntaxError(sql, 1);</TD></TR><TR><TD CLASS="l">1294</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1295</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1296</TD><TD>            schemaName = v0.getString();</TD></TR><TR CLASS="c"><TD CLASS="l">1297</TD><TD>            sequenceName = v1.getString();</TD></TR><TR><TD CLASS="l">1298</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1299</TD><TD>        Schema s = database.findSchema(schemaName);</TD></TR><TR CLASS="c"><TD CLASS="l">1300</TD><TD>        if (s == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1301</TD><TD>            schemaName = StringUtils.toUpperEnglish(schemaName);</TD></TR><TR CLASS="z"><TD CLASS="l">1302</TD><TD>            s = database.getSchema(schemaName);</TD></TR><TR><TD CLASS="l">1303</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1304</TD><TD>        Sequence seq = s.findSequence(sequenceName);</TD></TR><TR CLASS="c"><TD CLASS="l">1305</TD><TD>        if (seq == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1306</TD><TD>            sequenceName = StringUtils.toUpperEnglish(sequenceName);</TD></TR><TR CLASS="c"><TD CLASS="l">1307</TD><TD>            seq = s.getSequence(sequenceName);</TD></TR><TR><TD CLASS="l">1308</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="33">1309</A></TD><TD>        return seq;</TD></TR><TR><TD CLASS="l">1310</TD><TD>    }</TD></TR><TR><TD CLASS="l">1311</TD><TD> </TD></TR><TR><TD CLASS="l">1312</TD><TD>    private static long length(Value v) {</TD></TR><TR CLASS="c"><TD CLASS="l">1313</TD><TD>        switch (v.getType()) {</TD></TR><TR><TD CLASS="l">1314</TD><TD>        case Value.BLOB:</TD></TR><TR><TD CLASS="l">1315</TD><TD>        case Value.CLOB:</TD></TR><TR><TD CLASS="l">1316</TD><TD>        case Value.BYTES:</TD></TR><TR><TD CLASS="l">1317</TD><TD>        case Value.JAVA_OBJECT:</TD></TR><TR CLASS="c"><TD CLASS="l">1318</TD><TD>            return v.getPrecision();</TD></TR><TR><TD CLASS="l">1319</TD><TD>        default:</TD></TR><TR CLASS="c"><TD CLASS="l">1320</TD><TD>            return v.getString().length();</TD></TR><TR><TD CLASS="l"><A NAME="29">1321</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">1322</TD><TD>    }</TD></TR><TR><TD CLASS="l">1323</TD><TD> </TD></TR><TR><TD CLASS="l">1324</TD><TD>    private static byte[] getPaddedArrayCopy(byte[] data, int blockSize) {</TD></TR><TR CLASS="c"><TD CLASS="l">1325</TD><TD>        int size = MathUtils.roundUpInt(data.length, blockSize);</TD></TR><TR CLASS="c"><TD CLASS="l">1326</TD><TD>        byte[] newData = Utils.newBytes(size);</TD></TR><TR CLASS="c"><TD CLASS="l">1327</TD><TD>        System.arraycopy(data, 0, newData, 0, data.length);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1f">1328</A></TD><TD>        return newData;</TD></TR><TR><TD CLASS="l">1329</TD><TD>    }</TD></TR><TR><TD CLASS="l">1330</TD><TD> </TD></TR><TR><TD CLASS="l">1331</TD><TD>    private static byte[] decrypt(String algorithm, byte[] key, byte[] data) {</TD></TR><TR CLASS="c"><TD CLASS="l">1332</TD><TD>        BlockCipher cipher = CipherFactory.getBlockCipher(algorithm);</TD></TR><TR CLASS="c"><TD CLASS="l">1333</TD><TD>        byte[] newKey = getPaddedArrayCopy(key, cipher.getKeyLength());</TD></TR><TR CLASS="c"><TD CLASS="l">1334</TD><TD>        cipher.setKey(newKey);</TD></TR><TR CLASS="c"><TD CLASS="l">1335</TD><TD>        byte[] newData = getPaddedArrayCopy(data, BlockCipher.ALIGN);</TD></TR><TR CLASS="c"><TD CLASS="l">1336</TD><TD>        cipher.decrypt(newData, 0, newData.length);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="20">1337</A></TD><TD>        return newData;</TD></TR><TR><TD CLASS="l">1338</TD><TD>    }</TD></TR><TR><TD CLASS="l">1339</TD><TD> </TD></TR><TR><TD CLASS="l">1340</TD><TD>    private static byte[] encrypt(String algorithm, byte[] key, byte[] data) {</TD></TR><TR CLASS="c"><TD CLASS="l">1341</TD><TD>        BlockCipher cipher = CipherFactory.getBlockCipher(algorithm);</TD></TR><TR CLASS="c"><TD CLASS="l">1342</TD><TD>        byte[] newKey = getPaddedArrayCopy(key, cipher.getKeyLength());</TD></TR><TR CLASS="c"><TD CLASS="l">1343</TD><TD>        cipher.setKey(newKey);</TD></TR><TR CLASS="c"><TD CLASS="l">1344</TD><TD>        byte[] newData = getPaddedArrayCopy(data, BlockCipher.ALIGN);</TD></TR><TR CLASS="c"><TD CLASS="l">1345</TD><TD>        cipher.encrypt(newData, 0, newData.length);</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="b">1346</A></TD><TD>        return newData;</TD></TR><TR><TD CLASS="l">1347</TD><TD>    }</TD></TR><TR><TD CLASS="l">1348</TD><TD> </TD></TR><TR><TD CLASS="l">1349</TD><TD>    private static byte[] getHash(String algorithm, byte[] bytes, int iterations) {</TD></TR><TR CLASS="c"><TD CLASS="l">1350</TD><TD>        if (!&#34;SHA256&#34;.equalsIgnoreCase(algorithm)) {</TD></TR><TR CLASS="z"><TD CLASS="l">1351</TD><TD>            throw DbException.getInvalidValueException(&#34;algorithm&#34;, algorithm);</TD></TR><TR><TD CLASS="l">1352</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1353</TD><TD>        for (int i = 0; i &lt; iterations; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1354</TD><TD>            bytes = SHA256.getHash(bytes, false);</TD></TR><TR><TD CLASS="l">1355</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1356</TD><TD>        return bytes;</TD></TR><TR><TD CLASS="l">1357</TD><TD>    }</TD></TR><TR><TD CLASS="l">1358</TD><TD> </TD></TR><TR><TD CLASS="l">1359</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1360</TD><TD>     * Check if a given string is a valid date part string.</TD></TR><TR><TD CLASS="l">1361</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="2f">1362</A></TD><TD>     * @param part the string</TD></TR><TR><TD CLASS="l">1363</TD><TD>     * @return true if it is</TD></TR><TR><TD CLASS="l">1364</TD><TD>     */</TD></TR><TR><TD CLASS="l">1365</TD><TD>    public static boolean isDatePart(String part) {</TD></TR><TR CLASS="c"><TD CLASS="l">1366</TD><TD>        Integer p = DATE_PART.get(StringUtils.toUpperEnglish(part));</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="6">1367</A></TD><TD>        return p != null;</TD></TR><TR><TD CLASS="l">1368</TD><TD>    }</TD></TR><TR><TD CLASS="l">1369</TD><TD> </TD></TR><TR><TD CLASS="l">1370</TD><TD>    private static int getDatePart(String part) {</TD></TR><TR CLASS="c"><TD CLASS="l">1371</TD><TD>        Integer p = DATE_PART.get(StringUtils.toUpperEnglish(part));</TD></TR><TR CLASS="c"><TD CLASS="l">1372</TD><TD>        if (p == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1373</TD><TD>            throw DbException.getInvalidValueException(&#34;date part&#34;, part);</TD></TR><TR><TD CLASS="l">1374</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="1e">1375</A></TD><TD>        return p.intValue();</TD></TR><TR><TD CLASS="l">1376</TD><TD>    }</TD></TR><TR><TD CLASS="l">1377</TD><TD> </TD></TR><TR><TD CLASS="l">1378</TD><TD>    private static Timestamp dateadd(String part, int count, Timestamp d) {</TD></TR><TR CLASS="c"><TD CLASS="l">1379</TD><TD>        int field = getDatePart(part);</TD></TR><TR CLASS="c"><TD CLASS="l">1380</TD><TD>        Calendar calendar = Calendar.getInstance();</TD></TR><TR CLASS="c"><TD CLASS="l">1381</TD><TD>        int nanos = d.getNanos() % 1000000;</TD></TR><TR CLASS="c"><TD CLASS="l">1382</TD><TD>        calendar.setTime(d);</TD></TR><TR CLASS="c"><TD CLASS="l">1383</TD><TD>        calendar.add(field, count);</TD></TR><TR CLASS="c"><TD CLASS="l">1384</TD><TD>        long t = calendar.getTime().getTime();</TD></TR><TR CLASS="c"><TD CLASS="l">1385</TD><TD>        Timestamp ts = new Timestamp(t);</TD></TR><TR CLASS="c"><TD CLASS="l">1386</TD><TD>        ts.setNanos(ts.getNanos() + nanos);</TD></TR><TR CLASS="c"><TD CLASS="l">1387</TD><TD>        return ts;</TD></TR><TR><TD CLASS="l">1388</TD><TD>    }</TD></TR><TR><TD CLASS="l">1389</TD><TD> </TD></TR><TR><TD CLASS="l">1390</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1391</TD><TD>     * Calculate the number of crossed unit boundaries between two timestamps.</TD></TR><TR><TD CLASS="l">1392</TD><TD>     * This method is supported for MS SQL Server compatibility.</TD></TR><TR><TD CLASS="l">1393</TD><TD>     * &lt;pre&gt;</TD></TR><TR><TD CLASS="l">1394</TD><TD>     * DATEDIFF(YEAR, '2004-12-31', '2005-01-01') = 1</TD></TR><TR><TD CLASS="l">1395</TD><TD>     * &lt;/pre&gt;</TD></TR><TR><TD CLASS="l">1396</TD><TD>     *</TD></TR><TR><TD CLASS="l">1397</TD><TD>     * @param part the part</TD></TR><TR><TD CLASS="l">1398</TD><TD>     * @param d1 the first date</TD></TR><TR><TD CLASS="l"><A NAME="15">1399</A></TD><TD>     * @param d2 the second date</TD></TR><TR><TD CLASS="l">1400</TD><TD>     * @return the number of crossed boundaries</TD></TR><TR><TD CLASS="l">1401</TD><TD>     */</TD></TR><TR><TD CLASS="l">1402</TD><TD>    private static long datediff(String part, Timestamp d1, Timestamp d2) {</TD></TR><TR CLASS="c"><TD CLASS="l">1403</TD><TD>        int field = getDatePart(part);</TD></TR><TR CLASS="c"><TD CLASS="l">1404</TD><TD>        Calendar calendar = Calendar.getInstance();</TD></TR><TR CLASS="c"><TD CLASS="l">1405</TD><TD>        long t1 = d1.getTime(), t2 = d2.getTime();</TD></TR><TR><TD CLASS="l">1406</TD><TD>        // need to convert to UTC, otherwise we get inconsistent results with</TD></TR><TR><TD CLASS="l">1407</TD><TD>        // certain time zones (those that are 30 minutes off)</TD></TR><TR CLASS="c"><TD CLASS="l">1408</TD><TD>        TimeZone zone = calendar.getTimeZone();</TD></TR><TR CLASS="c"><TD CLASS="l">1409</TD><TD>        calendar.setTime(d1);</TD></TR><TR CLASS="c"><TD CLASS="l">1410</TD><TD>        t1 += zone.getOffset(calendar.get(Calendar.ERA), calendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH),</TD></TR><TR><TD CLASS="l">1411</TD><TD>                calendar.get(Calendar.DAY_OF_MONTH), calendar.get(Calendar.DAY_OF_WEEK), calendar</TD></TR><TR><TD CLASS="l">1412</TD><TD>                        .get(Calendar.MILLISECOND));</TD></TR><TR CLASS="c"><TD CLASS="l">1413</TD><TD>        calendar.setTime(d2);</TD></TR><TR CLASS="c"><TD CLASS="l">1414</TD><TD>        t2 += zone.getOffset(calendar.get(Calendar.ERA), calendar.get(Calendar.YEAR), calendar.get(Calendar.MONTH),</TD></TR><TR><TD CLASS="l">1415</TD><TD>                calendar.get(Calendar.DAY_OF_MONTH), calendar.get(Calendar.DAY_OF_WEEK), calendar</TD></TR><TR><TD CLASS="l">1416</TD><TD>                        .get(Calendar.MILLISECOND));</TD></TR><TR CLASS="c"><TD CLASS="l">1417</TD><TD>        switch (field) {</TD></TR><TR><TD CLASS="l">1418</TD><TD>        case Calendar.MILLISECOND:</TD></TR><TR CLASS="c"><TD CLASS="l">1419</TD><TD>            return t2 - t1;</TD></TR><TR><TD CLASS="l">1420</TD><TD>        case Calendar.SECOND:</TD></TR><TR><TD CLASS="l">1421</TD><TD>        case Calendar.MINUTE:</TD></TR><TR><TD CLASS="l">1422</TD><TD>        case Calendar.HOUR_OF_DAY: {</TD></TR><TR><TD CLASS="l">1423</TD><TD>            // first 'normalize' the numbers so both are not negative</TD></TR><TR CLASS="c"><TD CLASS="l">1424</TD><TD>            long hour = 60 * 60 * 1000;</TD></TR><TR CLASS="c"><TD CLASS="l">1425</TD><TD>            long add = Math.min(t1 / hour * hour, t2 / hour * hour);</TD></TR><TR CLASS="c"><TD CLASS="l">1426</TD><TD>            t1 -= add;</TD></TR><TR CLASS="c"><TD CLASS="l">1427</TD><TD>            t2 -= add;</TD></TR><TR CLASS="c"><TD CLASS="l">1428</TD><TD>            switch (field) {</TD></TR><TR><TD CLASS="l">1429</TD><TD>            case Calendar.SECOND:</TD></TR><TR CLASS="c"><TD CLASS="l">1430</TD><TD>                return t2 / 1000 - t1 / 1000;</TD></TR><TR><TD CLASS="l">1431</TD><TD>            case Calendar.MINUTE:</TD></TR><TR CLASS="c"><TD CLASS="l">1432</TD><TD>                return t2 / (60 * 1000) - t1 / (60 * 1000);</TD></TR><TR><TD CLASS="l">1433</TD><TD>            case Calendar.HOUR_OF_DAY:</TD></TR><TR CLASS="c"><TD CLASS="l">1434</TD><TD>                return t2 / hour - t1 / hour;</TD></TR><TR><TD CLASS="l">1435</TD><TD>            default:</TD></TR><TR CLASS="z"><TD CLASS="l">1436</TD><TD>                throw DbException.throwInternalError(&#34;field:&#34; + field);</TD></TR><TR><TD CLASS="l">1437</TD><TD>            }</TD></TR><TR><TD CLASS="l">1438</TD><TD>        }</TD></TR><TR><TD CLASS="l">1439</TD><TD>        case Calendar.DATE:</TD></TR><TR CLASS="c"><TD CLASS="l">1440</TD><TD>            return t2 / (24 * 60 * 60 * 1000) - t1 / (24 * 60 * 60 * 1000);</TD></TR><TR><TD CLASS="l">1441</TD><TD>        default:</TD></TR><TR><TD CLASS="l">1442</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1443</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1444</TD><TD>        calendar.setTime(new Timestamp(t1));</TD></TR><TR CLASS="c"><TD CLASS="l">1445</TD><TD>        int year1 = calendar.get(Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">1446</TD><TD>        int month1 = calendar.get(Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">1447</TD><TD>        calendar.setTime(new Timestamp(t2));</TD></TR><TR CLASS="c"><TD CLASS="l">1448</TD><TD>        int year2 = calendar.get(Calendar.YEAR);</TD></TR><TR CLASS="c"><TD CLASS="l">1449</TD><TD>        int month2 = calendar.get(Calendar.MONTH);</TD></TR><TR CLASS="c"><TD CLASS="l">1450</TD><TD>        int result = year2 - year1;</TD></TR><TR CLASS="c"><TD CLASS="l">1451</TD><TD>        if (field == Calendar.MONTH) {</TD></TR><TR CLASS="c"><TD CLASS="l">1452</TD><TD>            result = 12 * result + (month2 - month1);</TD></TR><TR><TD CLASS="l">1453</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="11">1454</A></TD><TD>        return result;</TD></TR><TR><TD CLASS="l">1455</TD><TD>    }</TD></TR><TR><TD CLASS="l">1456</TD><TD> </TD></TR><TR><TD CLASS="l">1457</TD><TD>    private static String substring(String s, int start, int length) {</TD></TR><TR CLASS="c"><TD CLASS="l">1458</TD><TD>        int len = s.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1459</TD><TD>        start--;</TD></TR><TR CLASS="c"><TD CLASS="l">1460</TD><TD>        if (start &lt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1461</TD><TD>            start = 0;</TD></TR><TR><TD CLASS="l">1462</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1463</TD><TD>        if (length &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1464</TD><TD>            length = 0;</TD></TR><TR><TD CLASS="l">1465</TD><TD>        }</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="83% line coverage (10 out of 12 instructions)">1466</TD><TD TITLE="83% line coverage (10 out of 12 instructions)">        start = (start &gt; len) ? len : start;</TD></TR><TR CLASS="c"><TD CLASS="l">1467</TD><TD>        if (start + length &gt; len) {</TD></TR><TR CLASS="c"><TD CLASS="l">1468</TD><TD>            length = len - start;</TD></TR><TR><TD CLASS="l">1469</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="14">1470</A></TD><TD>        return s.substring(start, start + length);</TD></TR><TR><TD CLASS="l">1471</TD><TD>    }</TD></TR><TR><TD CLASS="l">1472</TD><TD> </TD></TR><TR><TD CLASS="l">1473</TD><TD>    private static String replace(String s, String replace, String with) {</TD></TR><TR CLASS="c"><TD CLASS="l">1474</TD><TD>        if (s == null || replace == null || with == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1475</TD><TD>            return null;</TD></TR><TR><TD CLASS="l">1476</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1477</TD><TD>        if (replace.length() == 0) {</TD></TR><TR><TD CLASS="l">1478</TD><TD>            // avoid out of memory</TD></TR><TR CLASS="z"><TD CLASS="l">1479</TD><TD>            return s;</TD></TR><TR><TD CLASS="l">1480</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1481</TD><TD>        StringBuilder buff = new StringBuilder(s.length());</TD></TR><TR CLASS="c"><TD CLASS="l">1482</TD><TD>        int start = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1483</TD><TD>        int len = replace.length();</TD></TR><TR><TD CLASS="l">1484</TD><TD>        while (true) {</TD></TR><TR CLASS="c"><TD CLASS="l">1485</TD><TD>            int i = s.indexOf(replace, start);</TD></TR><TR CLASS="c"><TD CLASS="l">1486</TD><TD>            if (i == -1) {</TD></TR><TR CLASS="c"><TD CLASS="l">1487</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1488</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1489</TD><TD>            buff.append(s.substring(start, i)).append(with);</TD></TR><TR CLASS="c"><TD CLASS="l">1490</TD><TD>            start = i + len;</TD></TR><TR CLASS="c"><TD CLASS="l">1491</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1492</TD><TD>        buff.append(s.substring(start));</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="38">1493</A></TD><TD>        return buff.toString();</TD></TR><TR><TD CLASS="l">1494</TD><TD>    }</TD></TR><TR><TD CLASS="l">1495</TD><TD> </TD></TR><TR><TD CLASS="l">1496</TD><TD>    private static String repeat(String s, int count) {</TD></TR><TR CLASS="c"><TD CLASS="l">1497</TD><TD>        StringBuilder buff = new StringBuilder(s.length() * count);</TD></TR><TR CLASS="c"><TD CLASS="l">1498</TD><TD>        while (count-- &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1499</TD><TD>            buff.append(s);</TD></TR><TR><TD CLASS="l">1500</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="37">1501</A></TD><TD>        return buff.toString();</TD></TR><TR><TD CLASS="l">1502</TD><TD>    }</TD></TR><TR><TD CLASS="l">1503</TD><TD> </TD></TR><TR><TD CLASS="l">1504</TD><TD>    private static String rawToHex(String s) {</TD></TR><TR CLASS="c"><TD CLASS="l">1505</TD><TD>        int length = s.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1506</TD><TD>        StringBuilder buff = new StringBuilder(4 * length);</TD></TR><TR CLASS="c"><TD CLASS="l">1507</TD><TD>        for (int i = 0; i &lt; length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1508</TD><TD>            String hex = Integer.toHexString(s.charAt(i) &amp; 0xffff);</TD></TR><TR CLASS="c"><TD CLASS="l">1509</TD><TD>            for (int j = hex.length(); j &lt; 4; j++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1510</TD><TD>                buff.append('0');</TD></TR><TR><TD CLASS="l">1511</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1512</TD><TD>            buff.append(hex);</TD></TR><TR><TD CLASS="l">1513</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="4">1514</A></TD><TD>        return buff.toString();</TD></TR><TR><TD CLASS="l">1515</TD><TD>    }</TD></TR><TR><TD CLASS="l">1516</TD><TD> </TD></TR><TR><TD CLASS="l">1517</TD><TD>    private static int locate(String search, String s, int start) {</TD></TR><TR CLASS="c"><TD CLASS="l">1518</TD><TD>        if (start &lt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1519</TD><TD>            int i = s.length() + start;</TD></TR><TR CLASS="z"><TD CLASS="l">1520</TD><TD>            return s.lastIndexOf(search, i) + 1;</TD></TR><TR><TD CLASS="l">1521</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1522</TD><TD>        int i = (start == 0) ? 0 : start - 1;</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="39">1523</A></TD><TD>        return s.indexOf(search, i) + 1;</TD></TR><TR><TD CLASS="l">1524</TD><TD>    }</TD></TR><TR><TD CLASS="l">1525</TD><TD> </TD></TR><TR><TD CLASS="l">1526</TD><TD>    private static String right(String s, int count) {</TD></TR><TR CLASS="c"><TD CLASS="l">1527</TD><TD>        if (count &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1528</TD><TD>            count = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1529</TD><TD>        } else if (count &gt; s.length()) {</TD></TR><TR CLASS="c"><TD CLASS="l">1530</TD><TD>            count = s.length();</TD></TR><TR><TD CLASS="l">1531</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="32">1532</A></TD><TD>        return s.substring(s.length() - count);</TD></TR><TR><TD CLASS="l">1533</TD><TD>    }</TD></TR><TR><TD CLASS="l">1534</TD><TD> </TD></TR><TR><TD CLASS="l">1535</TD><TD>    private static String left(String s, int count) {</TD></TR><TR CLASS="c"><TD CLASS="l">1536</TD><TD>        if (count &lt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1537</TD><TD>            count = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1538</TD><TD>        } else if (count &gt; s.length()) {</TD></TR><TR CLASS="c"><TD CLASS="l">1539</TD><TD>            count = s.length();</TD></TR><TR><TD CLASS="l">1540</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="12">1541</A></TD><TD>        return s.substring(0, count);</TD></TR><TR><TD CLASS="l">1542</TD><TD>    }</TD></TR><TR><TD CLASS="l">1543</TD><TD> </TD></TR><TR><TD CLASS="l">1544</TD><TD>    private static String insert(String s1, int start, int length, String s2) {</TD></TR><TR CLASS="c"><TD CLASS="l">1545</TD><TD>        if (s1 == null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1546</TD><TD>            return s2;</TD></TR><TR><TD CLASS="l">1547</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1548</TD><TD>        if (s2 == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1549</TD><TD>            return s1;</TD></TR><TR><TD CLASS="l">1550</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1551</TD><TD>        int len1 = s1.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1552</TD><TD>        int len2 = s2.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1553</TD><TD>        start--;</TD></TR><TR CLASS="c"><TD CLASS="l">1554</TD><TD>        if (start &lt; 0 || length &lt;= 0 || len2 == 0 || start &gt; len1) {</TD></TR><TR CLASS="c"><TD CLASS="l">1555</TD><TD>            return s1;</TD></TR><TR><TD CLASS="l">1556</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1557</TD><TD>        if (start + length &gt; len1) {</TD></TR><TR CLASS="z"><TD CLASS="l">1558</TD><TD>            length = len1 - start;</TD></TR><TR><TD CLASS="l">1559</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1560</TD><TD>        return s1.substring(0, start) + s2 + s1.substring(start + length);</TD></TR><TR><TD CLASS="l"><A NAME="c">1561</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1562</TD><TD> </TD></TR><TR><TD CLASS="l">1563</TD><TD>    private static String hexToRaw(String s) {</TD></TR><TR><TD CLASS="l">1564</TD><TD>        // TODO function hextoraw compatibility with oracle</TD></TR><TR CLASS="c"><TD CLASS="l">1565</TD><TD>        int len = s.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1566</TD><TD>        if (len % 4 != 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1567</TD><TD>            throw DbException.get(ErrorCode.DATA_CONVERSION_ERROR_1, s);</TD></TR><TR><TD CLASS="l">1568</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1569</TD><TD>        StringBuilder buff = new StringBuilder(len / 4);</TD></TR><TR CLASS="c"><TD CLASS="l">1570</TD><TD>        for (int i = 0; i &lt; len; i += 4) {</TD></TR><TR><TD CLASS="l">1571</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">1572</TD><TD>                char raw = (char) Integer.parseInt(s.substring(i, i + 4), 16);</TD></TR><TR CLASS="c"><TD CLASS="l">1573</TD><TD>                buff.append(raw);</TD></TR><TR CLASS="z"><TD CLASS="l">1574</TD><TD>            } catch (NumberFormatException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">1575</TD><TD>                throw DbException.get(ErrorCode.DATA_CONVERSION_ERROR_1, s);</TD></TR><TR CLASS="c"><TD CLASS="l">1576</TD><TD>            }</TD></TR><TR><TD CLASS="l">1577</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1578</TD><TD>        return buff.toString();</TD></TR><TR><TD CLASS="l"><A NAME="23">1579</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">1580</TD><TD> </TD></TR><TR><TD CLASS="l">1581</TD><TD>    private static int getDifference(String s1, String s2) {</TD></TR><TR><TD CLASS="l">1582</TD><TD>        // TODO function difference: compatibility with SQL Server and HSQLDB</TD></TR><TR CLASS="c"><TD CLASS="l">1583</TD><TD>        s1 = getSoundex(s1);</TD></TR><TR CLASS="c"><TD CLASS="l">1584</TD><TD>        s2 = getSoundex(s2);</TD></TR><TR CLASS="c"><TD CLASS="l">1585</TD><TD>        int e = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1586</TD><TD>        for (int i = 0; i &lt; 4; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1587</TD><TD>            if (s1.charAt(i) == s2.charAt(i)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1588</TD><TD>                e++;</TD></TR><TR><TD CLASS="l">1589</TD><TD>            }</TD></TR><TR><TD CLASS="l">1590</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="d">1591</A></TD><TD>        return e;</TD></TR><TR><TD CLASS="l">1592</TD><TD>    }</TD></TR><TR><TD CLASS="l">1593</TD><TD> </TD></TR><TR><TD CLASS="l">1594</TD><TD>    private static double roundmagic(double d) {</TD></TR><TR CLASS="c"><TD CLASS="l">1595</TD><TD>        if ((d &lt; 0.0000000000001) &amp;&amp; (d &gt; -0.0000000000001)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1596</TD><TD>            return 0.0;</TD></TR><TR><TD CLASS="l">1597</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1598</TD><TD>        if ((d &gt; 1000000000000.) || (d &lt; -1000000000000.)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1599</TD><TD>            return d;</TD></TR><TR><TD CLASS="l">1600</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1601</TD><TD>        StringBuilder s = new StringBuilder();</TD></TR><TR CLASS="c"><TD CLASS="l">1602</TD><TD>        s.append(d);</TD></TR><TR CLASS="c"><TD CLASS="l">1603</TD><TD>        if (s.toString().indexOf(&#34;E&#34;) &gt;= 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1604</TD><TD>            return d;</TD></TR><TR><TD CLASS="l">1605</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1606</TD><TD>        int len = s.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1607</TD><TD>        if (len &lt; 16) {</TD></TR><TR CLASS="c"><TD CLASS="l">1608</TD><TD>            return d;</TD></TR><TR><TD CLASS="l">1609</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1610</TD><TD>        if (s.toString().indexOf(&#34;.&#34;) &gt; len - 3) {</TD></TR><TR CLASS="z"><TD CLASS="l">1611</TD><TD>            return d;</TD></TR><TR><TD CLASS="l">1612</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1613</TD><TD>        s.delete(len - 2, len);</TD></TR><TR CLASS="c"><TD CLASS="l">1614</TD><TD>        len -= 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1615</TD><TD>        char c1 = s.charAt(len - 2);</TD></TR><TR CLASS="c"><TD CLASS="l">1616</TD><TD>        char c2 = s.charAt(len - 3);</TD></TR><TR CLASS="c"><TD CLASS="l">1617</TD><TD>        char c3 = s.charAt(len - 4);</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="83% line coverage (29 out of 35 instructions)">1618</TD><TD TITLE="83% line coverage (29 out of 35 instructions)">        if ((c1 == '0') &amp;&amp; (c2 == '0') &amp;&amp; (c3 == '0')) {</TD></TR><TR CLASS="z"><TD CLASS="l">1619</TD><TD>            s.setCharAt(len - 1, '0');</TD></TR><TR CLASS="c"><TD CLASS="l">1620</TD><TD>        } else if ((c1 == '9') &amp;&amp; (c2 == '9') &amp;&amp; (c3 == '9')) {</TD></TR><TR CLASS="c"><TD CLASS="l">1621</TD><TD>            s.setCharAt(len - 1, '9');</TD></TR><TR CLASS="c"><TD CLASS="l">1622</TD><TD>            s.append('9');</TD></TR><TR CLASS="c"><TD CLASS="l">1623</TD><TD>            s.append('9');</TD></TR><TR CLASS="c"><TD CLASS="l">1624</TD><TD>            s.append('9');</TD></TR><TR><TD CLASS="l">1625</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="17">1626</A></TD><TD>        return Double.valueOf(s.toString()).doubleValue();</TD></TR><TR><TD CLASS="l">1627</TD><TD>    }</TD></TR><TR><TD CLASS="l">1628</TD><TD> </TD></TR><TR><TD CLASS="l">1629</TD><TD>    private static String getSoundex(String s) {</TD></TR><TR CLASS="c"><TD CLASS="l">1630</TD><TD>        int len = s.length();</TD></TR><TR CLASS="c"><TD CLASS="l">1631</TD><TD>        char[] chars = { '0', '0', '0', '0' };</TD></TR><TR CLASS="c"><TD CLASS="l">1632</TD><TD>        char lastDigit = '0';</TD></TR><TR CLASS="c"><TD CLASS="l">1633</TD><TD>        for (int i = 0, j = 0; i &lt; len &amp;&amp; j &lt; 4; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1634</TD><TD>            char c = s.charAt(i);</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="88% line coverage (14 out of 16 instructions)">1635</TD><TD TITLE="88% line coverage (14 out of 16 instructions)">            char newDigit = c &gt; SOUNDEX_INDEX.length ? 0 : SOUNDEX_INDEX[c];</TD></TR><TR CLASS="c"><TD CLASS="l">1636</TD><TD>            if (newDigit != 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1637</TD><TD>                if (j == 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">1638</TD><TD>                    chars[j++] = c;</TD></TR><TR CLASS="c"><TD CLASS="l">1639</TD><TD>                    lastDigit = newDigit;</TD></TR><TR CLASS="c"><TD CLASS="l">1640</TD><TD>                } else if (newDigit &lt;= '6') {</TD></TR><TR CLASS="c"><TD CLASS="l">1641</TD><TD>                    if (newDigit != lastDigit) {</TD></TR><TR CLASS="c"><TD CLASS="l">1642</TD><TD>                        chars[j++] = newDigit;</TD></TR><TR CLASS="c"><TD CLASS="l">1643</TD><TD>                        lastDigit = newDigit;</TD></TR><TR><TD CLASS="l">1644</TD><TD>                    }</TD></TR><TR CLASS="c"><TD CLASS="l">1645</TD><TD>                } else if (newDigit == '7') {</TD></TR><TR CLASS="c"><TD CLASS="l">1646</TD><TD>                    lastDigit = newDigit;</TD></TR><TR><TD CLASS="l">1647</TD><TD>                }</TD></TR><TR><TD CLASS="l">1648</TD><TD>            }</TD></TR><TR><TD CLASS="l">1649</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2d">1650</A></TD><TD>        return new String(chars);</TD></TR><TR><TD CLASS="l">1651</TD><TD>    }</TD></TR><TR><TD CLASS="l">1652</TD><TD> </TD></TR><TR><TD CLASS="l">1653</TD><TD>    public int getType() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="35">1654</A></TD><TD>        return dataType;</TD></TR><TR><TD CLASS="l">1655</TD><TD>    }</TD></TR><TR><TD CLASS="l">1656</TD><TD> </TD></TR><TR><TD CLASS="l">1657</TD><TD>    public void mapColumns(ColumnResolver resolver, int level) {</TD></TR><TR CLASS="c"><TD CLASS="l">1658</TD><TD>        for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">1659</TD><TD>            e.mapColumns(resolver, level);</TD></TR><TR><TD CLASS="l">1660</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1661</TD><TD>    }</TD></TR><TR><TD CLASS="l">1662</TD><TD> </TD></TR><TR><TD CLASS="l">1663</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1664</TD><TD>     * Check if the parameter count is correct.</TD></TR><TR><TD CLASS="l">1665</TD><TD>     *</TD></TR><TR><TD CLASS="l"><A NAME="f">1666</A></TD><TD>     * @param len the number of parameters set</TD></TR><TR><TD CLASS="l">1667</TD><TD>     * @throws DbException if the parameter count is incorrect</TD></TR><TR><TD CLASS="l">1668</TD><TD>     */</TD></TR><TR><TD CLASS="l">1669</TD><TD>    protected void checkParameterCount(int len) {</TD></TR><TR CLASS="c"><TD CLASS="l">1670</TD><TD>        int min = 0, max = Integer.MAX_VALUE;</TD></TR><TR CLASS="c"><TD CLASS="l">1671</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">1672</TD><TD>        case COALESCE:</TD></TR><TR><TD CLASS="l">1673</TD><TD>        case CSVREAD:</TD></TR><TR><TD CLASS="l">1674</TD><TD>        case LEAST:</TD></TR><TR><TD CLASS="l">1675</TD><TD>        case GREATEST:</TD></TR><TR CLASS="c"><TD CLASS="l">1676</TD><TD>            min = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1677</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1678</TD><TD>        case NOW:</TD></TR><TR><TD CLASS="l">1679</TD><TD>        case CURRENT_TIMESTAMP:</TD></TR><TR><TD CLASS="l">1680</TD><TD>        case RAND:</TD></TR><TR CLASS="c"><TD CLASS="l">1681</TD><TD>            max = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1682</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1683</TD><TD>        case COMPRESS:</TD></TR><TR><TD CLASS="l">1684</TD><TD>        case LTRIM:</TD></TR><TR><TD CLASS="l">1685</TD><TD>        case RTRIM:</TD></TR><TR><TD CLASS="l">1686</TD><TD>        case TRIM:</TD></TR><TR><TD CLASS="l">1687</TD><TD>        case FILE_READ:</TD></TR><TR><TD CLASS="l">1688</TD><TD>        case ROUND:</TD></TR><TR><TD CLASS="l">1689</TD><TD>        case XMLTEXT:</TD></TR><TR CLASS="c"><TD CLASS="l">1690</TD><TD>            min = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1691</TD><TD>            max = 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1692</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1693</TD><TD>        case REPLACE:</TD></TR><TR><TD CLASS="l">1694</TD><TD>        case LOCATE:</TD></TR><TR><TD CLASS="l">1695</TD><TD>        case INSTR:</TD></TR><TR><TD CLASS="l">1696</TD><TD>        case SUBSTR:</TD></TR><TR><TD CLASS="l">1697</TD><TD>        case SUBSTRING:</TD></TR><TR><TD CLASS="l">1698</TD><TD>        case LPAD:</TD></TR><TR><TD CLASS="l">1699</TD><TD>        case RPAD:</TD></TR><TR CLASS="c"><TD CLASS="l">1700</TD><TD>            min = 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1701</TD><TD>            max = 3;</TD></TR><TR CLASS="c"><TD CLASS="l">1702</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1703</TD><TD>        case CASE:</TD></TR><TR><TD CLASS="l">1704</TD><TD>        case CONCAT:</TD></TR><TR><TD CLASS="l">1705</TD><TD>        case CONCAT_WS:</TD></TR><TR><TD CLASS="l">1706</TD><TD>        case CSVWRITE:</TD></TR><TR CLASS="c"><TD CLASS="l">1707</TD><TD>            min = 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1708</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1709</TD><TD>        case XMLNODE:</TD></TR><TR CLASS="c"><TD CLASS="l">1710</TD><TD>            min = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1711</TD><TD>            max = 4;</TD></TR><TR CLASS="c"><TD CLASS="l">1712</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1713</TD><TD>        case FORMATDATETIME:</TD></TR><TR><TD CLASS="l">1714</TD><TD>        case PARSEDATETIME:</TD></TR><TR CLASS="c"><TD CLASS="l">1715</TD><TD>            min = 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1716</TD><TD>            max = 4;</TD></TR><TR CLASS="c"><TD CLASS="l">1717</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1718</TD><TD>        case CURRVAL:</TD></TR><TR><TD CLASS="l">1719</TD><TD>        case NEXTVAL:</TD></TR><TR CLASS="c"><TD CLASS="l">1720</TD><TD>            min = 1;</TD></TR><TR CLASS="c"><TD CLASS="l">1721</TD><TD>            max = 2;</TD></TR><TR CLASS="c"><TD CLASS="l">1722</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1723</TD><TD>        case DECODE:</TD></TR><TR CLASS="c"><TD CLASS="l">1724</TD><TD>            min = 3;</TD></TR><TR CLASS="c"><TD CLASS="l">1725</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1726</TD><TD>        default:</TD></TR><TR CLASS="z"><TD CLASS="l">1727</TD><TD>            DbException.throwInternalError(&#34;type=&#34; + info.type);</TD></TR><TR><TD CLASS="l">1728</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1729</TD><TD>        boolean ok = (len &gt;= min) &amp;&amp; (len &lt;= max);</TD></TR><TR CLASS="c"><TD CLASS="l">1730</TD><TD>        if (!ok) {</TD></TR><TR CLASS="c"><TD CLASS="l">1731</TD><TD>            throw DbException.get(ErrorCode.INVALID_PARAMETER_COUNT_2, info.name, min + &#34;..&#34; + max);</TD></TR><TR><TD CLASS="l">1732</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1733</TD><TD>    }</TD></TR><TR><TD CLASS="l">1734</TD><TD> </TD></TR><TR><TD CLASS="l">1735</TD><TD>    /**</TD></TR><TR><TD CLASS="l">1736</TD><TD>     * This method is called after all the parameters have been set.</TD></TR><TR><TD CLASS="l">1737</TD><TD>     * It checks if the parameter count is correct.</TD></TR><TR><TD CLASS="l"><A NAME="5">1738</A></TD><TD>     *</TD></TR><TR><TD CLASS="l">1739</TD><TD>     * @throws DbException if the parameter count is incorrect.</TD></TR><TR><TD CLASS="l">1740</TD><TD>     */</TD></TR><TR><TD CLASS="l">1741</TD><TD>    public void doneWithParameters() {</TD></TR><TR CLASS="c"><TD CLASS="l">1742</TD><TD>        if (info.parameterCount == VAR_ARGS) {</TD></TR><TR CLASS="c"><TD CLASS="l">1743</TD><TD>            int len = varArgs.size();</TD></TR><TR CLASS="c"><TD CLASS="l">1744</TD><TD>            checkParameterCount(len);</TD></TR><TR CLASS="c"><TD CLASS="l">1745</TD><TD>            args = new Expression[len];</TD></TR><TR CLASS="c"><TD CLASS="l">1746</TD><TD>            varArgs.toArray(args);</TD></TR><TR CLASS="c"><TD CLASS="l">1747</TD><TD>            varArgs = null;</TD></TR><TR CLASS="c"><TD CLASS="l">1748</TD><TD>        } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1749</TD><TD>            int len = args.length;</TD></TR><TR CLASS="c"><TD CLASS="l">1750</TD><TD>            if (len &gt; 0 &amp;&amp; args[len - 1] == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">1751</TD><TD>                throw DbException</TD></TR><TR><TD CLASS="l">1752</TD><TD>                        .get(ErrorCode.INVALID_PARAMETER_COUNT_2, info.name, &#34;&#34; + len);</TD></TR><TR><TD CLASS="l">1753</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="3a">1754</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1755</TD><TD>    }</TD></TR><TR><TD CLASS="l">1756</TD><TD> </TD></TR><TR><TD CLASS="l">1757</TD><TD>    public void setDataType(Column col) {</TD></TR><TR CLASS="c"><TD CLASS="l">1758</TD><TD>        dataType = col.getType();</TD></TR><TR CLASS="c"><TD CLASS="l">1759</TD><TD>        precision = col.getPrecision();</TD></TR><TR CLASS="c"><TD CLASS="l">1760</TD><TD>        displaySize = col.getDisplaySize();</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="36">1761</A></TD><TD>        scale = col.getScale();</TD></TR><TR CLASS="c"><TD CLASS="l">1762</TD><TD>    }</TD></TR><TR><TD CLASS="l">1763</TD><TD> </TD></TR><TR><TD CLASS="l">1764</TD><TD>    public Expression optimize(Session session) {</TD></TR><TR CLASS="c"><TD CLASS="l">1765</TD><TD>        boolean allConst = info.deterministic;</TD></TR><TR CLASS="c"><TD CLASS="l">1766</TD><TD>        for (int i = 0; i &lt; args.length; i++) {</TD></TR><TR CLASS="c"><TD CLASS="l">1767</TD><TD>            Expression e = args[i].optimize(session);</TD></TR><TR CLASS="c"><TD CLASS="l">1768</TD><TD>            args[i] = e;</TD></TR><TR CLASS="c"><TD CLASS="l">1769</TD><TD>            if (!e.isConstant()) {</TD></TR><TR CLASS="c"><TD CLASS="l">1770</TD><TD>                allConst = false;</TD></TR><TR><TD CLASS="l">1771</TD><TD>            }</TD></TR><TR><TD CLASS="l">1772</TD><TD>        }</TD></TR><TR><TD CLASS="l">1773</TD><TD>        int t, s, d;</TD></TR><TR><TD CLASS="l">1774</TD><TD>        long p;</TD></TR><TR CLASS="c"><TD CLASS="l">1775</TD><TD>        Expression p0 = args.length &lt; 1 ? null : args[0];</TD></TR><TR CLASS="c"><TD CLASS="l">1776</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">1777</TD><TD>        case IFNULL:</TD></TR><TR><TD CLASS="l">1778</TD><TD>        case NULLIF:</TD></TR><TR><TD CLASS="l">1779</TD><TD>        case COALESCE:</TD></TR><TR><TD CLASS="l">1780</TD><TD>        case LEAST:</TD></TR><TR><TD CLASS="l">1781</TD><TD>        case GREATEST:</TD></TR><TR><TD CLASS="l">1782</TD><TD>        case DECODE: {</TD></TR><TR CLASS="c"><TD CLASS="l">1783</TD><TD>            t = Value.UNKNOWN;</TD></TR><TR CLASS="c"><TD CLASS="l">1784</TD><TD>            s = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1785</TD><TD>            p = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1786</TD><TD>            d = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1787</TD><TD>            int i = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1788</TD><TD>            for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">1789</TD><TD>                if (info.type == DECODE) {</TD></TR><TR CLASS="c"><TD CLASS="l">1790</TD><TD>                    if (i &lt; 2 || ((i % 2 == 1) &amp;&amp; (i != args.length - 1))) {</TD></TR><TR><TD CLASS="l">1791</TD><TD>                        // decode(a, b, whenB)</TD></TR><TR><TD CLASS="l">1792</TD><TD>                        // decode(a, b, whenB, else)</TD></TR><TR><TD CLASS="l">1793</TD><TD>                        // decode(a, b, whenB, c, whenC)</TD></TR><TR><TD CLASS="l">1794</TD><TD>                        // decode(a, b, whenB, c, whenC, end)</TD></TR><TR CLASS="c"><TD CLASS="l">1795</TD><TD>                        i++;</TD></TR><TR CLASS="c"><TD CLASS="l">1796</TD><TD>                        continue;</TD></TR><TR><TD CLASS="l">1797</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1798</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1799</TD><TD>                if (e != ValueExpression.getNull()) {</TD></TR><TR CLASS="c"><TD CLASS="l">1800</TD><TD>                    int type = e.getType();</TD></TR><TR CLASS="c"><TD CLASS="l">1801</TD><TD>                    if (type != Value.UNKNOWN &amp;&amp; type != Value.NULL) {</TD></TR><TR CLASS="c"><TD CLASS="l">1802</TD><TD>                        t = Value.getHigherOrder(t, type);</TD></TR><TR CLASS="c"><TD CLASS="l">1803</TD><TD>                        s = Math.max(s, e.getScale());</TD></TR><TR CLASS="c"><TD CLASS="l">1804</TD><TD>                        p = Math.max(p, e.getPrecision());</TD></TR><TR CLASS="c"><TD CLASS="l">1805</TD><TD>                        d = Math.max(d, e.getDisplaySize());</TD></TR><TR><TD CLASS="l">1806</TD><TD>                    }</TD></TR><TR><TD CLASS="l">1807</TD><TD>                }</TD></TR><TR CLASS="c"><TD CLASS="l">1808</TD><TD>                i++;</TD></TR><TR><TD CLASS="l">1809</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1810</TD><TD>            if (t == Value.UNKNOWN) {</TD></TR><TR CLASS="c"><TD CLASS="l">1811</TD><TD>                t = Value.STRING;</TD></TR><TR CLASS="c"><TD CLASS="l">1812</TD><TD>                s = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1813</TD><TD>                p = Integer.MAX_VALUE;</TD></TR><TR CLASS="c"><TD CLASS="l">1814</TD><TD>                d = Integer.MAX_VALUE;</TD></TR><TR><TD CLASS="l">1815</TD><TD>            }</TD></TR><TR><TD CLASS="l">1816</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1817</TD><TD>        }</TD></TR><TR><TD CLASS="l">1818</TD><TD>        case CASEWHEN:</TD></TR><TR CLASS="c"><TD CLASS="l">1819</TD><TD>            t = Value.getHigherOrder(args[1].getType(), args[2].getType());</TD></TR><TR CLASS="c"><TD CLASS="l">1820</TD><TD>            p = Math.max(args[1].getPrecision(), args[2].getPrecision());</TD></TR><TR CLASS="c"><TD CLASS="l">1821</TD><TD>            d = Math.max(args[1].getDisplaySize(), args[2].getDisplaySize());</TD></TR><TR CLASS="c"><TD CLASS="l">1822</TD><TD>            s = Math.max(args[1].getScale(), args[2].getScale());</TD></TR><TR CLASS="c"><TD CLASS="l">1823</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1824</TD><TD>        case NVL2:</TD></TR><TR CLASS="c"><TD CLASS="l">1825</TD><TD>            switch (args[1].getType()) {</TD></TR><TR><TD CLASS="l">1826</TD><TD>            case Value.STRING:</TD></TR><TR><TD CLASS="l">1827</TD><TD>            case Value.CLOB:</TD></TR><TR><TD CLASS="l">1828</TD><TD>            case Value.STRING_FIXED:</TD></TR><TR><TD CLASS="l">1829</TD><TD>            case Value.STRING_IGNORECASE:</TD></TR><TR CLASS="c"><TD CLASS="l">1830</TD><TD>                t = args[1].getType();</TD></TR><TR CLASS="c"><TD CLASS="l">1831</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1832</TD><TD>            default:</TD></TR><TR CLASS="c"><TD CLASS="l">1833</TD><TD>                t = Value.getHigherOrder(args[1].getType(), args[2].getType());</TD></TR><TR><TD CLASS="l">1834</TD><TD>                break;</TD></TR><TR><TD CLASS="l">1835</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1836</TD><TD>            p = Math.max(args[1].getPrecision(), args[2].getPrecision());</TD></TR><TR CLASS="c"><TD CLASS="l">1837</TD><TD>            d = Math.max(args[1].getDisplaySize(), args[2].getDisplaySize());</TD></TR><TR CLASS="c"><TD CLASS="l">1838</TD><TD>            s = Math.max(args[1].getScale(), args[2].getScale());</TD></TR><TR CLASS="c"><TD CLASS="l">1839</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1840</TD><TD>        case CAST:</TD></TR><TR><TD CLASS="l">1841</TD><TD>        case CONVERT:</TD></TR><TR><TD CLASS="l">1842</TD><TD>        case TRUNCATE_VALUE:</TD></TR><TR><TD CLASS="l">1843</TD><TD>            // data type, precision and scale is already set</TD></TR><TR CLASS="c"><TD CLASS="l">1844</TD><TD>            t = dataType;</TD></TR><TR CLASS="c"><TD CLASS="l">1845</TD><TD>            p = precision;</TD></TR><TR CLASS="c"><TD CLASS="l">1846</TD><TD>            s = scale;</TD></TR><TR CLASS="c"><TD CLASS="l">1847</TD><TD>            d = displaySize;</TD></TR><TR CLASS="c"><TD CLASS="l">1848</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1849</TD><TD>        case ABS:</TD></TR><TR><TD CLASS="l">1850</TD><TD>        case FLOOR:</TD></TR><TR><TD CLASS="l">1851</TD><TD>        case RADIANS:</TD></TR><TR><TD CLASS="l">1852</TD><TD>        case ROUND:</TD></TR><TR><TD CLASS="l">1853</TD><TD>        case TRUNCATE:</TD></TR><TR><TD CLASS="l">1854</TD><TD>        case POWER:</TD></TR><TR CLASS="c"><TD CLASS="l">1855</TD><TD>            t = p0.getType();</TD></TR><TR CLASS="c"><TD CLASS="l">1856</TD><TD>            s = p0.getScale();</TD></TR><TR CLASS="c"><TD CLASS="l">1857</TD><TD>            p = p0.getPrecision();</TD></TR><TR CLASS="c"><TD CLASS="l">1858</TD><TD>            d = p0.getDisplaySize();</TD></TR><TR CLASS="c"><TD CLASS="l">1859</TD><TD>            if (t == Value.NULL) {</TD></TR><TR CLASS="c"><TD CLASS="l">1860</TD><TD>                t = Value.INT;</TD></TR><TR CLASS="c"><TD CLASS="l">1861</TD><TD>                p = ValueInt.PRECISION;</TD></TR><TR CLASS="c"><TD CLASS="l">1862</TD><TD>                d = ValueInt.DISPLAY_SIZE;</TD></TR><TR CLASS="c"><TD CLASS="l">1863</TD><TD>                s = 0;</TD></TR><TR><TD CLASS="l">1864</TD><TD>            }</TD></TR><TR><TD CLASS="l">1865</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1866</TD><TD>        case SET: {</TD></TR><TR CLASS="c"><TD CLASS="l">1867</TD><TD>            Expression p1 = args[1];</TD></TR><TR CLASS="c"><TD CLASS="l">1868</TD><TD>            t = p1.getType();</TD></TR><TR CLASS="c"><TD CLASS="l">1869</TD><TD>            p = p1.getPrecision();</TD></TR><TR CLASS="c"><TD CLASS="l">1870</TD><TD>            s = p1.getScale();</TD></TR><TR CLASS="c"><TD CLASS="l">1871</TD><TD>            d = p1.getDisplaySize();</TD></TR><TR CLASS="c"><TD CLASS="l">1872</TD><TD>            if (!(p0 instanceof Variable)) {</TD></TR><TR CLASS="c"><TD CLASS="l">1873</TD><TD>                throw DbException.get(ErrorCode.CAN_ONLY_ASSIGN_TO_VARIABLE_1, p0.getSQL());</TD></TR><TR><TD CLASS="l">1874</TD><TD>            }</TD></TR><TR><TD CLASS="l">1875</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1876</TD><TD>        }</TD></TR><TR><TD CLASS="l">1877</TD><TD>        case FILE_READ: {</TD></TR><TR CLASS="c"><TD CLASS="l">1878</TD><TD>            if (args.length == 1) {</TD></TR><TR CLASS="c"><TD CLASS="l">1879</TD><TD>                t = Value.BLOB;</TD></TR><TR><TD CLASS="l">1880</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">1881</TD><TD>                t = Value.CLOB;</TD></TR><TR><TD CLASS="l">1882</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1883</TD><TD>            p = Integer.MAX_VALUE;</TD></TR><TR CLASS="c"><TD CLASS="l">1884</TD><TD>            s = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1885</TD><TD>            d = Integer.MAX_VALUE;</TD></TR><TR CLASS="c"><TD CLASS="l">1886</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1887</TD><TD>        }</TD></TR><TR><TD CLASS="l">1888</TD><TD>        case SUBSTRING:</TD></TR><TR><TD CLASS="l">1889</TD><TD>        case SUBSTR: {</TD></TR><TR CLASS="c"><TD CLASS="l">1890</TD><TD>            t = info.dataType;</TD></TR><TR CLASS="c"><TD CLASS="l">1891</TD><TD>            p = args[0].getPrecision();</TD></TR><TR CLASS="c"><TD CLASS="l">1892</TD><TD>            s = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1893</TD><TD>            if (args[1].isConstant()) {</TD></TR><TR><TD CLASS="l">1894</TD><TD>                // if only two arguments are used,</TD></TR><TR><TD CLASS="l">1895</TD><TD>                // subtract offset from first argument length</TD></TR><TR CLASS="c"><TD CLASS="l">1896</TD><TD>                p -= args[1].getValue(session).getLong() - 1;</TD></TR><TR><TD CLASS="l">1897</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1898</TD><TD>            if (args.length == 3 &amp;&amp; args[2].isConstant()) {</TD></TR><TR><TD CLASS="l">1899</TD><TD>                // if the third argument is constant it is at most this value</TD></TR><TR CLASS="c"><TD CLASS="l">1900</TD><TD>                p = Math.min(p, args[2].getValue(session).getLong());</TD></TR><TR><TD CLASS="l">1901</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1902</TD><TD>            p = Math.max(0, p);</TD></TR><TR CLASS="c"><TD CLASS="l">1903</TD><TD>            d = MathUtils.convertLongToInt(p);</TD></TR><TR CLASS="c"><TD CLASS="l">1904</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1905</TD><TD>        }</TD></TR><TR><TD CLASS="l">1906</TD><TD>        default:</TD></TR><TR CLASS="c"><TD CLASS="l">1907</TD><TD>            t = info.dataType;</TD></TR><TR CLASS="c"><TD CLASS="l">1908</TD><TD>            DataType type = DataType.getDataType(t);</TD></TR><TR CLASS="c"><TD CLASS="l">1909</TD><TD>            p = PRECISION_UNKNOWN;</TD></TR><TR CLASS="c"><TD CLASS="l">1910</TD><TD>            d = 0;</TD></TR><TR CLASS="c"><TD CLASS="l">1911</TD><TD>            s = type.defaultScale;</TD></TR><TR><TD CLASS="l">1912</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1913</TD><TD>        dataType = t;</TD></TR><TR CLASS="c"><TD CLASS="l">1914</TD><TD>        precision = p;</TD></TR><TR CLASS="c"><TD CLASS="l">1915</TD><TD>        scale = s;</TD></TR><TR CLASS="c"><TD CLASS="l">1916</TD><TD>        displaySize = d;</TD></TR><TR CLASS="c"><TD CLASS="l">1917</TD><TD>        if (allConst) {</TD></TR><TR CLASS="c"><TD CLASS="l">1918</TD><TD>            Value v = getValue(session);</TD></TR><TR CLASS="c"><TD CLASS="l">1919</TD><TD>            if (v == ValueNull.INSTANCE) {</TD></TR><TR CLASS="c"><TD CLASS="l">1920</TD><TD>                if (info.type == CAST || info.type == CONVERT) {</TD></TR><TR CLASS="c"><TD CLASS="l">1921</TD><TD>                    return this;</TD></TR><TR><TD CLASS="l">1922</TD><TD>                }</TD></TR><TR><TD CLASS="l">1923</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">1924</TD><TD>            return ValueExpression.get(v);</TD></TR><TR><TD CLASS="l">1925</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="3b">1926</A></TD><TD>        return this;</TD></TR><TR><TD CLASS="l">1927</TD><TD>    }</TD></TR><TR><TD CLASS="l">1928</TD><TD> </TD></TR><TR><TD CLASS="l">1929</TD><TD>    public void setEvaluatable(TableFilter tableFilter, boolean b) {</TD></TR><TR CLASS="c"><TD CLASS="l">1930</TD><TD>        for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">1931</TD><TD>            if (e != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">1932</TD><TD>                e.setEvaluatable(tableFilter, b);</TD></TR><TR><TD CLASS="l">1933</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="2c">1934</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">1935</TD><TD>    }</TD></TR><TR><TD CLASS="l">1936</TD><TD> </TD></TR><TR><TD CLASS="l">1937</TD><TD>    public int getScale() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2b">1938</A></TD><TD>        return scale;</TD></TR><TR><TD CLASS="l">1939</TD><TD>    }</TD></TR><TR><TD CLASS="l">1940</TD><TD> </TD></TR><TR><TD CLASS="l">1941</TD><TD>    public long getPrecision() {</TD></TR><TR CLASS="c"><TD CLASS="l">1942</TD><TD>        if (precision == PRECISION_UNKNOWN) {</TD></TR><TR CLASS="c"><TD CLASS="l">1943</TD><TD>            calculatePrecisionAndDisplaySize();</TD></TR><TR><TD CLASS="l">1944</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="9">1945</A></TD><TD>        return precision;</TD></TR><TR><TD CLASS="l">1946</TD><TD>    }</TD></TR><TR><TD CLASS="l">1947</TD><TD> </TD></TR><TR><TD CLASS="l">1948</TD><TD>    public int getDisplaySize() {</TD></TR><TR CLASS="c"><TD CLASS="l">1949</TD><TD>        if (precision == PRECISION_UNKNOWN) {</TD></TR><TR CLASS="z"><TD CLASS="l">1950</TD><TD>            calculatePrecisionAndDisplaySize();</TD></TR><TR><TD CLASS="l">1951</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2">1952</A></TD><TD>        return displaySize;</TD></TR><TR><TD CLASS="l">1953</TD><TD>    }</TD></TR><TR><TD CLASS="l">1954</TD><TD> </TD></TR><TR><TD CLASS="l">1955</TD><TD>    private void calculatePrecisionAndDisplaySize() {</TD></TR><TR CLASS="c"><TD CLASS="l">1956</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">1957</TD><TD>        case ENCRYPT:</TD></TR><TR><TD CLASS="l">1958</TD><TD>        case DECRYPT:</TD></TR><TR CLASS="z"><TD CLASS="l">1959</TD><TD>            precision = args[2].getPrecision();</TD></TR><TR CLASS="z"><TD CLASS="l">1960</TD><TD>            displaySize = args[2].getDisplaySize();</TD></TR><TR CLASS="z"><TD CLASS="l">1961</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1962</TD><TD>        case COMPRESS:</TD></TR><TR CLASS="z"><TD CLASS="l">1963</TD><TD>            precision = args[0].getPrecision();</TD></TR><TR CLASS="z"><TD CLASS="l">1964</TD><TD>            displaySize = args[0].getDisplaySize();</TD></TR><TR CLASS="z"><TD CLASS="l">1965</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1966</TD><TD>        case CHAR:</TD></TR><TR CLASS="z"><TD CLASS="l">1967</TD><TD>            precision = 1;</TD></TR><TR CLASS="z"><TD CLASS="l">1968</TD><TD>            displaySize = 1;</TD></TR><TR CLASS="z"><TD CLASS="l">1969</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1970</TD><TD>        case CONCAT:</TD></TR><TR CLASS="z"><TD CLASS="l">1971</TD><TD>            precision = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1972</TD><TD>            displaySize = 0;</TD></TR><TR CLASS="z"><TD CLASS="l">1973</TD><TD>            for (Expression e : args) {</TD></TR><TR CLASS="z"><TD CLASS="l">1974</TD><TD>                precision += e.getPrecision();</TD></TR><TR CLASS="z"><TD CLASS="l">1975</TD><TD>                displaySize = MathUtils.convertLongToInt((long) displaySize + e.getDisplaySize());</TD></TR><TR CLASS="z"><TD CLASS="l">1976</TD><TD>                if (precision &lt; 0) {</TD></TR><TR CLASS="z"><TD CLASS="l">1977</TD><TD>                    precision = Long.MAX_VALUE;</TD></TR><TR><TD CLASS="l">1978</TD><TD>                }</TD></TR><TR><TD CLASS="l">1979</TD><TD>            }</TD></TR><TR CLASS="z"><TD CLASS="l">1980</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1981</TD><TD>        case HEXTORAW:</TD></TR><TR CLASS="z"><TD CLASS="l">1982</TD><TD>            precision = (args[0].getPrecision() + 3) / 4;</TD></TR><TR CLASS="z"><TD CLASS="l">1983</TD><TD>            displaySize = MathUtils.convertLongToInt(precision);</TD></TR><TR CLASS="z"><TD CLASS="l">1984</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1985</TD><TD>        case LCASE:</TD></TR><TR><TD CLASS="l">1986</TD><TD>        case LTRIM:</TD></TR><TR><TD CLASS="l">1987</TD><TD>        case RIGHT:</TD></TR><TR><TD CLASS="l">1988</TD><TD>        case RTRIM:</TD></TR><TR><TD CLASS="l">1989</TD><TD>        case UCASE:</TD></TR><TR><TD CLASS="l">1990</TD><TD>        case LOWER:</TD></TR><TR><TD CLASS="l">1991</TD><TD>        case UPPER:</TD></TR><TR><TD CLASS="l">1992</TD><TD>        case TRIM:</TD></TR><TR><TD CLASS="l">1993</TD><TD>        case STRINGDECODE:</TD></TR><TR><TD CLASS="l">1994</TD><TD>        case UTF8TOSTRING:</TD></TR><TR CLASS="z"><TD CLASS="l">1995</TD><TD>            precision = args[0].getPrecision();</TD></TR><TR CLASS="z"><TD CLASS="l">1996</TD><TD>            displaySize = args[0].getDisplaySize();</TD></TR><TR CLASS="z"><TD CLASS="l">1997</TD><TD>            break;</TD></TR><TR><TD CLASS="l">1998</TD><TD>        case RAWTOHEX:</TD></TR><TR CLASS="z"><TD CLASS="l">1999</TD><TD>            precision = args[0].getPrecision() * 4;</TD></TR><TR CLASS="z"><TD CLASS="l">2000</TD><TD>            displaySize = MathUtils.convertLongToInt(precision);</TD></TR><TR CLASS="z"><TD CLASS="l">2001</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2002</TD><TD>        case SOUNDEX:</TD></TR><TR CLASS="z"><TD CLASS="l">2003</TD><TD>            precision = 4;</TD></TR><TR CLASS="z"><TD CLASS="l">2004</TD><TD>            displaySize = (int) precision;</TD></TR><TR CLASS="z"><TD CLASS="l">2005</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2006</TD><TD>        case DAY_NAME:</TD></TR><TR><TD CLASS="l">2007</TD><TD>        case MONTH_NAME:</TD></TR><TR><TD CLASS="l">2008</TD><TD>            // day and month names may be long in some languages</TD></TR><TR CLASS="z"><TD CLASS="l">2009</TD><TD>            precision = 20;</TD></TR><TR CLASS="z"><TD CLASS="l">2010</TD><TD>            displaySize = (int) precision;</TD></TR><TR CLASS="z"><TD CLASS="l">2011</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2012</TD><TD>        default:</TD></TR><TR CLASS="c"><TD CLASS="l">2013</TD><TD>            DataType type = DataType.getDataType(dataType);</TD></TR><TR CLASS="c"><TD CLASS="l">2014</TD><TD>            precision = type.defaultPrecision;</TD></TR><TR CLASS="c"><TD CLASS="l">2015</TD><TD>            displaySize = type.defaultDisplaySize;</TD></TR><TR><TD CLASS="l"><A NAME="8">2016</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2017</TD><TD>    }</TD></TR><TR><TD CLASS="l">2018</TD><TD> </TD></TR><TR><TD CLASS="l">2019</TD><TD>    public String getSQL() {</TD></TR><TR CLASS="c"><TD CLASS="l">2020</TD><TD>        StatementBuilder buff = new StatementBuilder(info.name);</TD></TR><TR CLASS="c"><TD CLASS="l">2021</TD><TD>        buff.append('(');</TD></TR><TR CLASS="c"><TD CLASS="l">2022</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">2023</TD><TD>        case CAST: {</TD></TR><TR CLASS="c"><TD CLASS="l">2024</TD><TD>            buff.append(args[0].getSQL()).append(&#34; AS &#34;).</TD></TR><TR><TD CLASS="l">2025</TD><TD>                append(new Column(null, dataType, precision, scale, displaySize).getCreateSQL());</TD></TR><TR CLASS="c"><TD CLASS="l">2026</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2027</TD><TD>        }</TD></TR><TR><TD CLASS="l">2028</TD><TD>        case CONVERT: {</TD></TR><TR CLASS="z"><TD CLASS="l">2029</TD><TD>            buff.append(args[0].getSQL()).append(',').</TD></TR><TR><TD CLASS="l">2030</TD><TD>                append(new Column(null, dataType, precision, scale, displaySize).getCreateSQL());</TD></TR><TR CLASS="z"><TD CLASS="l">2031</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2032</TD><TD>        }</TD></TR><TR><TD CLASS="l">2033</TD><TD>        case EXTRACT: {</TD></TR><TR CLASS="c"><TD CLASS="l">2034</TD><TD>            ValueString v = (ValueString) ((ValueExpression) args[0]).getValue(null);</TD></TR><TR CLASS="c"><TD CLASS="l">2035</TD><TD>            buff.append(v.getString()).append(&#34; FROM &#34;).append(args[1].getSQL());</TD></TR><TR CLASS="c"><TD CLASS="l">2036</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2037</TD><TD>        }</TD></TR><TR><TD CLASS="l">2038</TD><TD>        default: {</TD></TR><TR CLASS="c"><TD CLASS="l">2039</TD><TD>            for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">2040</TD><TD>                buff.appendExceptFirst(&#34;, &#34;);</TD></TR><TR CLASS="c"><TD CLASS="l">2041</TD><TD>                buff.append(e.getSQL());</TD></TR><TR><TD CLASS="l">2042</TD><TD>            }</TD></TR><TR><TD CLASS="l">2043</TD><TD>        }</TD></TR><TR><TD CLASS="l">2044</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="3c">2045</A></TD><TD>        return buff.append(')').toString();</TD></TR><TR><TD CLASS="l">2046</TD><TD>    }</TD></TR><TR><TD CLASS="l">2047</TD><TD> </TD></TR><TR><TD CLASS="l">2048</TD><TD>    public void updateAggregate(Session session) {</TD></TR><TR CLASS="c"><TD CLASS="l">2049</TD><TD>        for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">2050</TD><TD>            if (e != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">2051</TD><TD>                e.updateAggregate(session);</TD></TR><TR><TD CLASS="l">2052</TD><TD>            }</TD></TR><TR><TD CLASS="l"><A NAME="26">2053</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2054</TD><TD>    }</TD></TR><TR><TD CLASS="l">2055</TD><TD> </TD></TR><TR><TD CLASS="l">2056</TD><TD>    public int getFunctionType() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="27">2057</A></TD><TD>        return info.type;</TD></TR><TR><TD CLASS="l">2058</TD><TD>    }</TD></TR><TR><TD CLASS="l">2059</TD><TD> </TD></TR><TR><TD CLASS="l">2060</TD><TD>    public String getName() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="2a">2061</A></TD><TD>        return info.name;</TD></TR><TR><TD CLASS="l">2062</TD><TD>    }</TD></TR><TR><TD CLASS="l">2063</TD><TD> </TD></TR><TR><TD CLASS="l">2064</TD><TD>    public int getParameterCount() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="e">2065</A></TD><TD>        return args.length;</TD></TR><TR><TD CLASS="l">2066</TD><TD>    }</TD></TR><TR><TD CLASS="l">2067</TD><TD> </TD></TR><TR><TD CLASS="l">2068</TD><TD>    public ValueResultSet getValueForColumnList(Session session, Expression[] argList) {</TD></TR><TR CLASS="c"><TD CLASS="l">2069</TD><TD>        switch (info.type) {</TD></TR><TR><TD CLASS="l">2070</TD><TD>        case CSVREAD: {</TD></TR><TR CLASS="c"><TD CLASS="l">2071</TD><TD>            String fileName = argList[0].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2072</TD><TD>            if (fileName == null) {</TD></TR><TR CLASS="z"><TD CLASS="l">2073</TD><TD>                throw DbException.get(ErrorCode.PARAMETER_NOT_SET_1, &#34;fileName&#34;);</TD></TR><TR><TD CLASS="l">2074</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">2075</TD><TD>            String columnList = argList.length &lt; 2 ? null : argList[1].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2076</TD><TD>            Csv csv = new Csv();</TD></TR><TR CLASS="c"><TD CLASS="l">2077</TD><TD>            String options = argList.length &lt; 3 ? null : argList[2].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2078</TD><TD>            String charset = null;</TD></TR><TR CLASS="c"><TD CLASS="l">2079</TD><TD>            if (options != null &amp;&amp; options.indexOf('=') &gt;= 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">2080</TD><TD>                charset = csv.setOptions(options);</TD></TR><TR><TD CLASS="l">2081</TD><TD>            } else {</TD></TR><TR CLASS="c"><TD CLASS="l">2082</TD><TD>                charset = options;</TD></TR><TR CLASS="c"><TD CLASS="l">2083</TD><TD>                String fieldSeparatorRead = argList.length &lt; 4 ? null : argList[3].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2084</TD><TD>                String fieldDelimiter = argList.length &lt; 5 ? null : argList[4].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2085</TD><TD>                String escapeCharacter = argList.length &lt; 6 ? null : argList[5].getValue(session).getString();</TD></TR><TR CLASS="c"><TD CLASS="l">2086</TD><TD>                setCsvDelimiterEscape(csv, fieldSeparatorRead, fieldDelimiter, escapeCharacter);</TD></TR><TR><TD CLASS="l">2087</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">2088</TD><TD>            char fieldSeparator = csv.getFieldSeparatorRead();</TD></TR><TR CLASS="c"><TD CLASS="l">2089</TD><TD>            String[] columns = StringUtils.arraySplit(columnList, fieldSeparator, true);</TD></TR><TR CLASS="c"><TD CLASS="l">2090</TD><TD>            ResultSet rs = null;</TD></TR><TR><TD CLASS="l">2091</TD><TD>            ValueResultSet x;</TD></TR><TR><TD CLASS="l">2092</TD><TD>            try {</TD></TR><TR CLASS="c"><TD CLASS="l">2093</TD><TD>                rs = csv.read(fileName, columns, charset);</TD></TR><TR CLASS="c"><TD CLASS="l">2094</TD><TD>                x = ValueResultSet.getCopy(rs, 0);</TD></TR><TR CLASS="z"><TD CLASS="l">2095</TD><TD>            } catch (SQLException e) {</TD></TR><TR CLASS="z"><TD CLASS="l">2096</TD><TD>                throw DbException.convert(e);</TD></TR><TR><TD CLASS="l">2097</TD><TD>            } finally {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="82% line coverage (23 out of 28 instructions)">2098</TD><TD TITLE="82% line coverage (23 out of 28 instructions)">                JdbcUtils.closeSilently(rs);</TD></TR><TR CLASS="c"><TD CLASS="l">2099</TD><TD>            }</TD></TR><TR CLASS="c"><TD CLASS="l">2100</TD><TD>            return x;</TD></TR><TR><TD CLASS="l">2101</TD><TD>        }</TD></TR><TR><TD CLASS="l">2102</TD><TD>        default:</TD></TR><TR><TD CLASS="l">2103</TD><TD>            break;</TD></TR><TR><TD CLASS="l">2104</TD><TD>        }</TD></TR><TR CLASS="z"><TD CLASS="l">2105</TD><TD>        return (ValueResultSet) getValueWithArgs(session, argList);</TD></TR><TR><TD CLASS="l"><A NAME="16">2106</A></TD><TD>    }</TD></TR><TR><TD CLASS="l">2107</TD><TD> </TD></TR><TR><TD CLASS="l">2108</TD><TD>    private static void setCsvDelimiterEscape(Csv csv, String fieldSeparator,</TD></TR><TR><TD CLASS="l">2109</TD><TD>            String fieldDelimiter, String escapeCharacter) {</TD></TR><TR CLASS="c"><TD CLASS="l">2110</TD><TD>        if (fieldSeparator != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">2111</TD><TD>            csv.setFieldSeparatorWrite(fieldSeparator);</TD></TR><TR CLASS="c"><TD CLASS="l">2112</TD><TD>            if (fieldSeparator.length() &gt; 0) {</TD></TR><TR CLASS="c"><TD CLASS="l">2113</TD><TD>                char fs = fieldSeparator.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">2114</TD><TD>                csv.setFieldSeparatorRead(fs);</TD></TR><TR><TD CLASS="l">2115</TD><TD>            }</TD></TR><TR><TD CLASS="l">2116</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2117</TD><TD>        if (fieldDelimiter != null) {</TD></TR><TR CLASS="c"><TD CLASS="l">2118</TD><TD>            char fd = fieldDelimiter.length() == 0 ? 0 : fieldDelimiter.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">2119</TD><TD>            csv.setFieldDelimiter(fd);</TD></TR><TR><TD CLASS="l">2120</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2121</TD><TD>        if (escapeCharacter != null) {</TD></TR><TR CLASS="p"><TD CLASS="l" TITLE="83% line coverage (10 out of 12 instructions)">2122</TD><TD TITLE="83% line coverage (10 out of 12 instructions)">            char ec = escapeCharacter.length() == 0 ? 0 : escapeCharacter.charAt(0);</TD></TR><TR CLASS="c"><TD CLASS="l">2123</TD><TD>            csv.setEscapeCharacter(ec);</TD></TR><TR><TD CLASS="l"><A NAME="21">2124</A></TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2125</TD><TD>    }</TD></TR><TR><TD CLASS="l">2126</TD><TD> </TD></TR><TR><TD CLASS="l">2127</TD><TD>    public Expression[] getArgs() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="7">2128</A></TD><TD>        return args;</TD></TR><TR><TD CLASS="l">2129</TD><TD>    }</TD></TR><TR><TD CLASS="l">2130</TD><TD> </TD></TR><TR><TD CLASS="l">2131</TD><TD>    public boolean isEverything(ExpressionVisitor visitor) {</TD></TR><TR CLASS="c"><TD CLASS="l">2132</TD><TD>        for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">2133</TD><TD>            if (e != null &amp;&amp; !e.isEverything(visitor)) {</TD></TR><TR CLASS="c"><TD CLASS="l">2134</TD><TD>                return false;</TD></TR><TR><TD CLASS="l">2135</TD><TD>            }</TD></TR><TR><TD CLASS="l">2136</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l">2137</TD><TD>        switch (visitor.getType()) {</TD></TR><TR><TD CLASS="l">2138</TD><TD>        case ExpressionVisitor.DETERMINISTIC:</TD></TR><TR><TD CLASS="l">2139</TD><TD>        case ExpressionVisitor.QUERY_COMPARABLE:</TD></TR><TR><TD CLASS="l">2140</TD><TD>        case ExpressionVisitor.READONLY:</TD></TR><TR CLASS="c"><TD CLASS="l">2141</TD><TD>            return info.deterministic;</TD></TR><TR><TD CLASS="l">2142</TD><TD>        case ExpressionVisitor.EVALUATABLE:</TD></TR><TR><TD CLASS="l">2143</TD><TD>        case ExpressionVisitor.GET_DEPENDENCIES:</TD></TR><TR><TD CLASS="l">2144</TD><TD>        case ExpressionVisitor.INDEPENDENT:</TD></TR><TR><TD CLASS="l">2145</TD><TD>        case ExpressionVisitor.NOT_FROM_RESOLVER:</TD></TR><TR><TD CLASS="l">2146</TD><TD>        case ExpressionVisitor.OPTIMIZABLE_MIN_MAX_COUNT_ALL:</TD></TR><TR><TD CLASS="l">2147</TD><TD>        case ExpressionVisitor.SET_MAX_DATA_MODIFICATION_ID:</TD></TR><TR><TD CLASS="l">2148</TD><TD>        case ExpressionVisitor.GET_COLUMNS:</TD></TR><TR CLASS="c"><TD CLASS="l">2149</TD><TD>            return true;</TD></TR><TR><TD CLASS="l">2150</TD><TD>        default:</TD></TR><TR CLASS="z"><TD CLASS="l">2151</TD><TD>            throw DbException.throwInternalError(&#34;type=&#34; + visitor.getType());</TD></TR><TR><TD CLASS="l"><A NAME="22">2152</A></TD><TD>        }</TD></TR><TR><TD CLASS="l">2153</TD><TD>    }</TD></TR><TR><TD CLASS="l">2154</TD><TD> </TD></TR><TR><TD CLASS="l">2155</TD><TD>    public int getCost() {</TD></TR><TR CLASS="c"><TD CLASS="l">2156</TD><TD>        int cost = 3;</TD></TR><TR CLASS="c"><TD CLASS="l">2157</TD><TD>        for (Expression e : args) {</TD></TR><TR CLASS="c"><TD CLASS="l">2158</TD><TD>            cost += e.getCost();</TD></TR><TR><TD CLASS="l">2159</TD><TD>        }</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="30">2160</A></TD><TD>        return cost;</TD></TR><TR><TD CLASS="l">2161</TD><TD>    }</TD></TR><TR><TD CLASS="l">2162</TD><TD> </TD></TR><TR><TD CLASS="l">2163</TD><TD>    public boolean isDeterministic() {</TD></TR><TR CLASS="c"><TD CLASS="l"><A NAME="31">2164</A></TD><TD>        return info.deterministic;</TD></TR><TR><TD CLASS="l">2165</TD><TD>    }</TD></TR><TR><TD CLASS="l">2166</TD><TD> </TD></TR><TR><TD CLASS="l">2167</TD><TD>    public boolean isFast() {</TD></TR><TR CLASS="c"><TD CLASS="l">2168</TD><TD>        return info.fast;</TD></TR><TR><TD CLASS="l">2169</TD><TD>    }</TD></TR><TR><TD CLASS="l">2170</TD><TD> </TD></TR><TR><TD CLASS="l">2171</TD><TD>}</TD></TR></TABLE><P></P><TABLE CLASS="hdft" CELLSPACING="0" WIDTH="100%"><TR><TD CLASS="nv">[<A HREF="../index.html">all classes</A>][<A HREF="11.html">org.h2.expression</A>]</TD></TR><TR><TD CLASS="tl"><A HREF="http://sourceforge.net/projects/emma">EMMA 2.0.5312</A> (C) Vladimir Roubtsov</TD></TR></TABLE></BODY></HTML>